(()=>{"use strict";var e={7:e=>{var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var o=Number.isNaN||function(e){return e!=e};function r(){r.init.call(this)}e.exports=r,e.exports.once=function(e,t){return new Promise((function(n,i){function o(n){e.removeListener(t,r),i(n)}function r(){"function"==typeof e.removeListener&&e.removeListener("error",o),n([].slice.call(arguments))}f(e,t,r,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&f(e,"error",t,{once:!0})}(e,o)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var a=10;function s(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?r.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var o,r,a,c;if(s(n),void 0===(r=e._events)?(r=e._events=Object.create(null),e._eventsCount=0):(void 0!==r.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),r=e._events),a=r[t]),void 0===a)a=r[t]=n,++e._eventsCount;else if("function"==typeof a?a=r[t]=i?[n,a]:[a,n]:i?a.unshift(n):a.push(n),(o=l(e))>0&&a.length>o&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,c=d,console&&console.warn&&console.warn(c)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},o=d.bind(i);return o.listener=n,i.wrapFn=o,o}function h(e,t,n){var i=e._events;if(void 0===i)return[];var o=i[t];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(o):g(o,o.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function f(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function o(r){i.once&&e.removeEventListener(t,o),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||o(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},r.prototype.getMaxListeners=function(){return l(this)},r.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var o="error"===e,r=this._events;if(void 0!==r)o=o&&void 0===r.error;else if(!o)return!1;if(o){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var l=r[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,d=g(l,c);for(n=0;n<c;++n)i(d[n],this,t)}return!0},r.prototype.addListener=function(e,t){return c(this,e,t,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(e,t){return c(this,e,t,!0)},r.prototype.once=function(e,t){return s(t),this.on(e,u(this,e,t)),this},r.prototype.prependOnceListener=function(e,t){return s(t),this.prependListener(e,u(this,e,t)),this},r.prototype.removeListener=function(e,t){var n,i,o,r,a;if(s(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(o=-1,r=n.length-1;r>=0;r--)if(n[r]===t||n[r].listener===t){a=n[r].listener,o=r;break}if(o<0)return this;0===o?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,o),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,a||t)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var o,r=Object.keys(n);for(i=0;i<r.length;++i)"removeListener"!==(o=r[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},r.prototype.listeners=function(e){return h(this,e,!0)},r.prototype.rawListeners=function(e){return h(this,e,!1)},r.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},r.prototype.listenerCount=m,r.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},707:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#config-popup-container * {\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n  font-family: Arial, Helvetica, sans-serif;\r\n  color: black;\r\n}\r\n\r\n#config-popup-header {\r\n  margin-bottom: 24px;\r\n  text-shadow: 2px 2px 2px gray;\r\n}\r\n\r\n#config-popup-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  box-shadow: 0px 3px 8px 0px rgba(157, 157, 157, 0.4);\r\n  border-radius: 4px;\r\n  width: 350px;\r\n  max-width: 80%;\r\n  overflow: hidden;\r\n  background-color: antiquewhite;\r\n  border: 1px solid rgba(165, 125, 11, 1);\r\n  z-index: 100;\r\n  padding: 16px;\r\n}\r\n\r\n.input-wrapper {\r\n  display: grid;\r\n  grid-template-columns: auto 1fr;\r\n  justify-items: start;\r\n  column-gap: 8px;\r\n  row-gap: 8px;\r\n  align-items: center;\r\n  margin-top: 16px;\r\n  text-align: start;\r\n}\r\n\r\n.input-wrapper label {\r\n  background-color: none;\r\n}\r\n\r\n.expandable-section {\r\n  grid-column-start: 2;\r\n}\r\n\r\n#config-popup-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  border-radius: 4px;\r\n  gap: 8px;\r\n}\r\n\r\n#config-popup-content h1 {\r\n  font-weight: 500;\r\n  font-size: 1.7rem;\r\n  align-self: center;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.label-chevron {\r\n  display: flex;\r\n  align-items: center;\r\n  gap:8px\r\n}\r\n\r\n\r\n#button-panel {\r\n  align-self: flex-end;\r\n  margin-top: 20px;\r\n}\r\n\r\n#button-panel button {\r\n  padding: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\n#config-popup-container.minimized {\r\n  top: auto;\r\n  transform: none;\r\n  bottom: 50px;\r\n  left: 10px;\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  box-shadow: none;\r\n}\r\n\r\n\r\n.show-trigger {\r\n  display: none;\r\n}\r\n\r\n#close-popup {\r\n  cursor: pointer;\r\n  position: absolute;\r\n  right: 10px;\r\n  top: 10px;\r\n  transition-duration: 125ms;\r\n  color: tomato;\r\n  text-shadow: 0px 0px 2px black;\r\n}\r\n\r\n#close-popup:hover {\r\n  animation: freak 1s ease-in both infinite;\r\n}\r\n\r\n#config-popup-container.minimized #config-popup-content {\r\n  display: none;\r\n}\r\n\r\n#config-popup-container.minimized #config-popup-header {\r\n  display: none;\r\n}\r\n\r\n#config-popup-container.minimized {\r\n  padding: 0;\r\n}\r\n\r\n#config-popup-container.minimized .show-trigger {\r\n  cursor: pointer;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 0.7rem;\r\n  font-weight: 600;\r\n  text-shadow: 0px 1px 1px rgba(165, 125, 11, 1);\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  gap: 5px;\r\n}\r\n\r\n.section-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  gap: 4px;\r\n}\r\n\r\n.isle-container {\r\n  display: flex;\r\n  margin-left: 16px !important;\r\n  gap: 4px;\r\n  margin-top: 4px !important;\r\n}\r\n\r\n.arrow-down {\r\n  cursor: pointer;\r\n}\r\n\r\n.hidden {\r\n  display: none !important;\r\n}\r\n\r\n.rotate {\r\n  transform: rotate(180deg);\r\n}\r\n\r\n@keyframes freak {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n\r\n  33.33% {\r\n    transform: scale(0.8);\r\n  }\r\n\r\n  66.66% {\r\n    transform: scale(1.2);\r\n  }\r\n}"},13:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="config-popup-container" class="">\r\n  <div id="config-popup-header">\r\n    <h1>GPS config</h1>\r\n    <div id="close-popup">&#10006;</div>\r\n  </div>\r\n  <div id="config-popup-content">\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="city-switch" checked />\r\n      <label for="city-switch">Switch cities automatically</label>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="farm" checked />\r\n      <div class="label-chevron">\r\n        <label for="farm">\r\n          Farm manager\r\n        </label>\r\n        <svg xmlns="http://www.w3.org/2000/svg" class="arrow-down" width="16" height="16" fill="currentColor"\r\n          class="bi bi-chevron-down" viewBox="0 0 16 16">\r\n          <path fill-rule="evenodd"\r\n            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />\r\n        </svg>\r\n      </div>\r\n      <div class="expandable-section hidden">\r\n        <div class="section-header"></div>\r\n        <div class="section-content">\r\n          <div class="input-wapper">\r\n            <label>\r\n              Time interval\r\n            </label>\r\n            <select id="time-interval-select">\r\n            </select>\r\n          </div>\r\n          <div class="input-wapper">\r\n            <input type="checkbox" id="humanize-checkbox" />\r\n            <label for="humanize-checkbox">\r\n              Humanize\r\n            </label>\r\n          </div>\r\n          <div id="conflicting-cities-container" class="hidden">\r\n            <div class="section-header">\r\n              <span class="section-name">Conflicting cities</span>\r\n              <svg xmlns="http://www.w3.org/2000/svg" class="arrow-down" width="16" height="16"\r\n                fill="currentColor" class="bi bi-chevron-down" viewBox="0 0 16 16">\r\n                <path fill-rule="evenodd"\r\n                  d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />\r\n              </svg>\r\n            </div>\r\n            <div class="section-content hidden">\r\n              \x3c!-- <div class="isle-container">\r\n                <div class="isle-header">Isle 1</div>\r\n                <select name="isle1-cities" id="isle1-cities">\r\n                  <option value="city1">City 1</option>\r\n                  <option value="city2">City 2</option>\r\n                </select>\r\n              </div> --\x3e\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="builder" />\r\n      <label for="builder">Builder</label>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="guard" disabled />\r\n      <label for="guard">Guard (in progress)</label>\r\n    </div>\r\n\r\n    <div id="button-panel">\r\n      <button id="submit">Submit</button>\r\n      <button type="reset" id="cancel-all">Cancel all</button>\r\n    </div>\r\n  </div>\r\n  <div class="show-trigger">\r\n    GPS\r\n  </div>\r\n</div>'},165:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="build-container" class="hidden">\r\n  <div id="build-options">\r\n  </div>\r\n  <div id="additional-queue">\r\n\r\n  </div>\r\n</div>\r\n<button id="toggle-builder" class="hidden">Toggle builder</button>'},77:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#additional-queue {\r\n  display: flex;\r\n  gap: 8px;\r\n  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);\r\n  border-radius: 4px;\r\n  padding: 4px;\r\n  max-width: 568px;\r\n  width: fit-content;\r\n  overflow-y: auto;\r\n  font-family: Arial, Helvetica, sans-serif;\r\n}\r\n\r\n.queue-item {\r\n  flex-shrink: 0;\r\n  position: relative;\r\n  width: 45px;\r\n  height: 45px;\r\n  background-size: cover;\r\n  background-position: center;\r\n}\r\n\r\n.queue-item .up {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  font-weight: bold;\r\n  color: lightgreen;\r\n  text-align: end;\r\n  margin: 2px;\r\n  font-size: 12px;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n}\r\n\r\n.queue-item .cancel {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  font-weight: bold;\r\n  color: red;\r\n  cursor: pointer;\r\n  padding: 1px;\r\n  font-size: 10px;\r\n}\r\n\r\n.queue-item .cancel:hover {\r\n  transform: scale(1.4);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\nhidden {\r\n  display: none;\r\n}\r\n\r\n#build-container {\r\n  z-index: 2000;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 8px;\r\n  position: fixed;\r\n  bottom: 80px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  border: 1px solid darkgoldenrod;\r\n  border-radius: 4px;\r\n  padding: 4px;\r\n  overflow-x: auto;\r\n  max-width: 90%;\r\n  background-color: bisque;\r\n  width: fit-content;\r\n}\r\n\r\n#build-options {\r\n  display: flex;\r\n  gap: 4px;\r\n}\r\n\r\n.build-option {\r\n  position: relative;\r\n  width: 40px;\r\n  height: 40px;\r\n  background-size: cover;\r\n  background-position: center;\r\n  cursor: pointer;\r\n}\r\n\r\n.build-option:hover {\r\n  transform: scale(1.1);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.build-options-add {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: 50%;\r\n  transform: translate(50%, -50%);\r\n  font-weight: bold;\r\n  color: white;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n  user-select: none;\r\n}\r\n\r\n#toggle-builder {\r\n  cursor: pointer;\r\n  position: fixed;\r\n  bottom: 15px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  font-size: 12px;\r\n  z-index: 1000;\r\n  opacity: 0.6;\r\n}\r\n\r\n#toggle-builder:hover {\r\n  opacity: 1;\r\n}"},39:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#info-container {\r\n  z-index: 3000 !important;\r\n  font-family: 'Roboto', sans-serif;\r\n  font-size: 0.9em;\r\n  position: absolute;\r\n  top: 10%;\r\n  left: 50%;  \r\n  transform: translateX(-50%);\r\n  background-color: rgba(1, 11, 152, 0.6); /* Zmiana na rgba z opacity 0.8 */\r\n  color: #fff;\r\n  padding: 5px 20px;\r\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\r\n  display: block;\r\n}\r\n\r\n.info-title {\r\n  font-weight: bold;\r\n}\r\n\r\n#info-container.hidden {\r\n  display: block;\r\n  animation: slideOut 0.4s;\r\n  animation-fill-mode: forwards;\r\n}\r\n\r\n@keyframes slideIn {\r\n  0% {\r\n    opacity: 0;\r\n    transform: translateX(-50%) translateY(-100%);\r\n  }\r\n  80% {\r\n    transform: translateX(-50%) translateY(20%);\r\n  }\r\n  100% {\r\n    opacity: 1;\r\n    transform: translateX(-50%) translateY(0);\r\n  }\r\n}\r\n\r\n@keyframes slideOut {\r\n  0% {\r\n    display: block;\r\n    opacity: 1;\r\n  }\r\n  100% {\r\n    opacity: 0;\r\n    display: none;\r\n    transform: translateX(0%) translateY(0);\r\n  }\r\n} \r\n"},41:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="info-container" class="hidden">\r\n  <span class="info-title"></span>\r\n  <span class="info-text"></span>\r\n</div>'},813:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div style="margin-top: 8px;">\r\n  <input id="schedule-date" type="date" />\r\n  <input id="schedule-time" type="text" size="5" placeholder="hh:mm:ss" />\r\n  <button type="button" id="schedule-button">Schedule</button>\r\n  <p id="schedule-error" style="color: red;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;"></p>\r\n  <p id="schedule-info" style="color: green;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;"></p>\r\n</div>'},846:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="table-container" class="hidden">\r\n  <table id="scheduler-lookup-table">\r\n    <thead>\r\n      <tr>\r\n        <th id="operation-type">Operation Type</th>\r\n        <th class="source-city">Source City</th>\r\n        <th class="destination-city">Destination City</th>\r\n        <th class="departure-time">Departure Time</th>\r\n        <th class="arrival-time">Arrival Time</th>\r\n        <th class="actions">\r\n          <div class="close-icon">\r\n            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="display: block;">\r\n              <line x1="1" y1="1" x2="23" y2="23"></line>\r\n              <line x1="23" y1="1" x2="1" y2="23"></line>\r\n            </svg>\r\n          </div>\r\n        </th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td colspan="6" id="no-schedules">No schedules</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n<button id="scheduler-toggle-button">scheduler</button>'},218:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#table-container {\r\n  max-height: 50vh;\r\n  overflow-y: auto;\r\n  border: 1px solid #ddd;\r\n  width: fit-content;\r\n}\r\n\r\n#scheduler-lookup-table {\r\n  font-family: Arial, Helvetica, sans-serif;\r\n  border-collapse: collapse;\r\n  font-size: 18px;\r\n  text-align: left;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  z-index: 1000;\r\n  background-color: antiquewhite;\r\n}\r\n\r\n#no-schedules {\r\n  text-align: center;\r\n  height: 50px;\r\n}\r\n\r\n.attack {\r\n  font-weight: 600;\r\n  color: #d32f2f;\r\n}\r\n\r\n.support {\r\n  font-weight: 600;\r\n  color: #2979ff;\r\n}\r\n\r\n#scheduler-lookup-table * {\r\n  font-size: 14px;\r\n}\r\n\r\n#scheduler-lookup-table th,\r\n#scheduler-lookup-table td {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n}\r\n\r\n#scheduler-lookup-table th {\r\n  background-color: #f2f2f2;\r\n  font-weight: bold;\r\n}\r\n\r\n#scheduler-lookup-table td {\r\n  text-wrap: nowrap;\r\n}\r\n\r\n\r\n.cancel-button {\r\n  background-color: #f44336;\r\n  color: white;\r\n  border: none;\r\n  padding: 5px 10px;\r\n  cursor: pointer;\r\n  transition-duration: 150ms;\r\n}\r\n\r\n.cancel-button:hover {\r\n  background-color: #d32f2f;\r\n}\r\n\r\n#scheduler-toggle-button {\r\n  padding: 4px 8px;\r\n  font-size: 12px;\r\n  font-variant: small-caps;\r\n  cursor: pointer;\r\n  border-radius: 20px;\r\n  position: absolute;\r\n  bottom: 98px;\r\n  left: 10px;\r\n  margin: 0;\r\n  z-index: 1000;\r\n  transition-duration: 150ms;\r\n}\r\n\r\n#scheduler-toggle-button:hover {\r\n  background-color: #ddd;\r\n}\r\n\r\n.actions {\r\n  min-width: 22px;\r\n}\r\n\r\n.close-icon {\r\n  position: absolute;\r\n  cursor: pointer;\r\n  right: 5px;\r\n  top: 5px;\r\n  color: #000;\r\n}\r\n\r\n.close-icon:hover {\r\n  scale: 1.1;\r\n  transition-duration: 150ms;\r\n}\r\n\r\n.hidden {\r\n  display: none;\r\n}"},773:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.FarmTimeInterval=void 0,function(e){e[e.FirstOption=3e5]="FirstOption",e[e.SecondOption=12e5]="SecondOption",e[e.ThirdOption=54e5]="ThirdOption",e[e.FourthOption=144e5]="FourthOption"}(n||(t.FarmTimeInterval=n={}));const i={resources:{minPopulationBuffer:100,storeAlmostFullPercentage:.9},farmConfig:{farmInterval:n.FirstOption,humanize:!1,farmingCities:[]},general:{timeDifference:11500,antyTimingMs:1e4,applicationRefreshInterval:192e4,forcedRefresh:!1,switch:!0,farm:!0,builder:!0,guard:!1}};t.default=i},323:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(707)),a=o(n(13)),s=o(n(7)),l=o(n(639)),c=n(773),d=o(n(2));class u extends s.default{constructor(){super(),this.uniquelySelectedFarmingCitiesPerIsle={},this.isSwitchChecked=()=>this.switch,this.isFarmChecked=()=>this.farm,this.isBuilderChecked=()=>this.builder,this.isGuardChecked=()=>this.guard,this.getPlunderConfig=()=>{},this.getManagersFlags=()=>({farm:this.farm,builder:this.builder,guard:this.guard}),this.configManager=l.default.getInstance(),this.config=this.configManager.getConfig(),this.switch=this.config.general.switch,this.farm=this.config.general.farm,this.builder=this.config.general.builder,this.guard=this.config.general.guard,this.farmInterval=this.config.farmConfig.farmInterval,this.humanize=this.config.farmConfig.humanize}initEventListeners(){var e;const t=document.querySelector("#config-popup-container"),n=t.querySelector("#city-switch"),i=t.querySelector("#farm"),o=t.querySelector("#builder"),r=t.querySelector("#guard"),a=t.querySelector("#time-interval-select"),s=t.querySelector(".show-trigger"),l=t.querySelector("#close-popup"),d=t.querySelector("#humanize-checkbox");if(!t)throw new Error('"#config-popup-container" couldn\'t be found.');l.addEventListener("click",(()=>{t.classList.contains("minimized")||t.classList.add("minimized")})),t.querySelectorAll("#button-panel button").forEach((e=>e.addEventListener("click",(()=>{"reset"===e.type&&(n.checked=!1,this.switch=!1,i.checked=!1,this.farm=!1,o.checked=!1,this.builder=!1,r.checked=!1,this.guard=!1);const a=Object.keys(this.uniquelySelectedFarmingCitiesPerIsle).some((e=>{var t;return this.uniquelySelectedFarmingCitiesPerIsle[e].name!==(null===(t=this.config.farmConfig.farmingCities.find((t=>t.isleId===e)))||void 0===t?void 0:t.name)}));console.log("conflictingCitiesChanged",a),(this.config.farmConfig.farmInterval!==this.farmInterval||this.config.farmConfig.humanize!==this.humanize||this.config.general.switch!==this.switch||this.config.general.farm!==this.farm||this.config.general.builder!==this.builder||this.config.general.guard!==this.guard||a)&&(this.config.farmConfig.farmInterval=this.farmInterval,this.config.farmConfig.humanize=this.humanize,this.config.general.switch=this.switch,this.config.general.farm=this.farm,this.config.general.builder=this.builder,this.config.general.guard=this.guard,this.config.farmConfig.farmingCities=Object.values(this.uniquelySelectedFarmingCitiesPerIsle),this.configManager.persistConfig()),this.farmInterval===c.FarmTimeInterval.FourthOption&&alert("Farmienie ustawione na 4h/8h, odśwież stronę jeżeli to błąd!"),t.classList.add("minimized"),this.emit("managersChange")})))),s.addEventListener("click",(()=>{t.classList.contains("minimized")&&t.classList.remove("minimized")})),n.addEventListener("change",(()=>{this.switch=n.checked})),i.addEventListener("change",(()=>{this.farm=i.checked})),o.addEventListener("change",(()=>{this.builder=o.checked})),r.addEventListener("change",(()=>{this.guard=r.checked})),a.addEventListener("change",(()=>{this.farmInterval=Number(a.value),console.log("this.farmInterval changed to: ",this.farmInterval)}));const u=null===(e=t.querySelector("#farm"))||void 0===e?void 0:e.parentElement,h=u.querySelector(".expandable-section"),m=u.querySelector(".arrow-down");m.addEventListener("click",(()=>{h.classList.toggle("hidden"),m.classList.toggle("rotate")})),d.addEventListener("change",(()=>{this.humanize=d.checked}))}createInitialElements(){return i(this,void 0,void 0,(function*(){var e;const t=document.createElement("div");t.innerHTML=a.default,t.querySelector("#city-switch").checked=this.switch,t.querySelector("#farm").checked=this.farm,t.querySelector("#builder").checked=this.builder,t.querySelector("#guard").checked=this.guard;const n=t.querySelector("#time-interval-select"),i=Object.values(c.FarmTimeInterval);return i.slice(i.length/2).forEach((e=>{const t=document.createElement("option");t.value=e.toString(),t.textContent=this.mapTimeIntervalKeyToText(e),n.appendChild(t)})),t.querySelector("#time-interval-select").value=null!==(e=this.config.farmConfig.farmInterval.toString())&&void 0!==e?e:c.FarmTimeInterval.FirstOption.toString(),t.querySelector("#humanize-checkbox").checked=this.config.farmConfig.humanize,yield this.createConfictingCitiesSelects(t),t}))}createConfictingCitiesSelects(e){return i(this,void 0,void 0,(function*(){var t;const n=(yield d.default.getInstance()).getCityList(),i=Array.from(new Set(n.map((e=>e.isleId)))).map((e=>n.filter((t=>t.isleId===e)))),o=i.some((e=>e.length>1)),r=e.querySelector("#conflicting-cities-container"),a=r.querySelector(".arrow-down"),s=r.querySelector(".section-content");if(o){r.classList.remove("hidden");for(const e of i){if(1===e.length){this.uniquelySelectedFarmingCitiesPerIsle[e[0].isleId]=e[0];continue}const n=null!==(t=e.find((t=>{var n;return t.name===(null===(n=this.config.farmConfig.farmingCities.find((t=>t.isleId===e[0].isleId)))||void 0===n?void 0:n.name)})))&&void 0!==t?t:e[0];this.uniquelySelectedFarmingCitiesPerIsle[e[0].isleId]=n;const i=document.createElement("div");i.className="isle-container";const o=document.createElement("div");o.className="isle-header",o.textContent=`Isle ${e[0].isleId}`,i.appendChild(o);const r=document.createElement("select");r.name=`isle-${e[0].isleId}-cities`,r.id=`isle-${e[0].isleId}-cities`,i.appendChild(r),e.forEach((e=>{const t=document.createElement("option");t.value=e.name,t.textContent=e.name,r.appendChild(t)})),r.value=n.name,r.addEventListener("change",(()=>{const t=e.find((e=>e.name===r.value));t&&(this.uniquelySelectedFarmingCitiesPerIsle[e[0].isleId]=t,console.log("this.conflictingCities",this.uniquelySelectedFarmingCitiesPerIsle))})),s.appendChild(i)}}else r.classList.add("hidden"),this.uniquelySelectedFarmingCitiesPerIsle=n.reduce(((e,t)=>(e[t.isleId]=t,e)),{});a.addEventListener("click",(()=>{s.classList.toggle("hidden"),a.classList.toggle("rotate")}))}))}mapTimeIntervalKeyToText(e){switch(e){case c.FarmTimeInterval.FirstOption:return"5m/10m";case c.FarmTimeInterval.SecondOption:return"20m/40m";case c.FarmTimeInterval.ThirdOption:return"1h 30m/3h";case c.FarmTimeInterval.FourthOption:return"4h/8h";default:return"Unknown interval"}}addStyle(){const e=document.createElement("style");e.textContent=r.default,document.head.appendChild(e)}render(){return i(this,void 0,void 0,(function*(){this.addStyle();const e=yield this.createInitialElements();document.body.appendChild(e),this.initEventListeners()}))}minimize(){const e=document.querySelector("#config-popup-container");null==e||e.classList.add("minimized")}}t.default=u},927:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(299)),a=n(910);(0,n(396).onPageLoad)((()=>i(void 0,void 0,void 0,(function*(){console.log("VERY POLITE GPS v.0.5.0 MVP walikonie special edition (c) 2024");const e=window.location.href;/.*grepolis.com\/game\/.*/.test(e)?yield r.default.getInstance():e.includes("start?nosession")&&(console.log("will try to reconnect in 5 minutes"),setInterval((()=>{var e;(0,a.setCookie)("forceRestart",!0),null===(e=document.querySelector(".world_name.end_game_type_world_wonder"))||void 0===e||e.click()}),3e5))}))))},641:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.callback=null}static getInstance(){return n.instance||(n.instance=new n,n.instance.mountObserver()),n.instance}mountObserver(){const e=new MutationObserver((e=>{e.forEach((e=>{if("childList"===e.type)for(const t of e.addedNodes)if(t instanceof HTMLElement&&"unit_movements"===t.getAttribute("data-commandtype")&&"-1"!=t.getAttribute("data-cancelable")&&this.callback)return this.callback(t.id),void(this.callback=null)}))})),t=document.querySelector("#toolbar_activity_commands_list .content.js-dropdown-item-list");e.observe(t,{childList:!0,subtree:!1})}setCallback(e){this.callback=e}}t.default=n},147:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.buildings=t.buildingsSelectors=void 0;const o=n(396),r=e=>i(void 0,void 0,void 0,(function*(){const t=document.querySelector('[name="city_overview"]');(null==t?void 0:t.classList.contains("checked"))||null==t||t.click();const n=document.querySelector('[class="construction_queue_build_button"] div');n.classList.contains("active")||n.click(),yield(0,o.waitForElement)(e).then((e=>e.click()))}));t.buildingsSelectors={buildButton:".btn_build.build_button",currentLvl:'[class="twa_content js-content-area"] span:nth-of-type(3)',disabled:"disabled"},t.buildings={main:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/main.png)",elementSelector:".city_overview_overlay.main",currentLvlElSelector:'.city_overview_overlay.main [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Senate",buildAction:()=>r(".city_overview_overlay.main .btn_build.build_button")},hide:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/hide.png)",elementSelector:".city_overview_overlay.hide",currentLvlElSelector:'.city_overview_overlay.hide [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Cave",buildAction:()=>r(".city_overview_overlay.hide .btn_build.build_button")},lumber:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/lumber.png)",elementSelector:".city_overview_overlay.lumber",currentLvlElSelector:'.city_overview_overlay.lumber [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Lumber mill",buildAction:()=>r(".city_overview_overlay.lumber .btn_build.build_button")},stoner:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/stoner.png)",elementSelector:".city_overview_overlay.stoner",currentLvlElSelector:'.city_overview_overlay.stoner [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Quarry",buildAction:()=>r(".city_overview_overlay.stoner .btn_build.build_button")},ironer:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/ironer.png)",elementSelector:".city_overview_overlay.ironer",currentLvlElSelector:'.city_overview_overlay.ironer [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Silver mine",buildAction:()=>r(".city_overview_overlay.ironer .btn_build.build_button")},market:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/market.png)",elementSelector:".city_overview_overlay.market",currentLvlElSelector:'.city_overview_overlay.market [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Market",buildAction:()=>r(".city_overview_overlay.market .btn_build.build_button")},docks:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/docks.png)",elementSelector:".city_overview_overlay.docks",currentLvlElSelector:'.city_overview_overlay.docks [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Harbor",buildAction:()=>r(".city_overview_overlay.docks .btn_build.build_button")},barracks:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/barracks.png)",elementSelector:".city_overview_overlay.barracks",currentLvlElSelector:'.city_overview_overlay.barracks [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Barracks",buildAction:()=>r(".city_overview_overlay.barracks .btn_build.build_button")},wall:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/wall.png)",elementSelector:".city_overview_overlay.wall",currentLvlElSelector:'.city_overview_overlay.wall [class="twa_content js-content-area"] span:nth-of-type(3)',name:"City wall",buildAction:()=>r(".city_overview_overlay.wall .btn_build.build_button")},storage:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/storage.png)",elementSelector:".city_overview_overlay.storage",currentLvlElSelector:'.city_overview_overlay.storage [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Warehouse",buildAction:()=>r(".city_overview_overlay.storage .btn_build.build_button")},farm:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/farm.png)",elementSelector:".city_overview_overlay.farm",currentLvlElSelector:'.city_overview_overlay.farm [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Farm",buildAction:()=>r(".city_overview_overlay.farm .btn_build.build_button")},academy:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/academy.png)",elementSelector:".city_overview_overlay.academy",currentLvlElSelector:'.city_overview_overlay.academy [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Academy",buildAction:()=>r(".city_overview_overlay.academy .btn_build.build_button")},temple:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/temple.png)",elementSelector:".city_overview_overlay.temple",currentLvlElSelector:'.city_overview_overlay.temple [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Temple",buildAction:()=>r(".city_overview_overlay.temple .btn_build.build_button")}}},233:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(910),a=o(n(785)),s=n(396),l=o(n(77)),c=o(n(165)),d=n(147),u=o(n(254)),h=o(n(2)),m=o(n(715));class g{constructor(){this.allowUnsequentialBuilds=!1,this.allowCriticalBuilds=!0,this.RUN=!1,this.mainQueue=[]}static getInstance(){return i(this,void 0,void 0,(function*(){return g.instance||(g.instance=new g,g.instance.lock=a.default.getInstance(),g.instance.resourceManager=u.default.getInstance(),g.instance.citySwitchManager=yield h.default.getInstance(),g.instance.generalInfo=m.default.getInstance(),g.instance.addStyle(),g.instance.renderUI(),g.instance.loadQueueFromStorage(),g.instance.listenToCitySwitch()),g.instance}))}renderUI(){const e=document.createElement("div");e.innerHTML=c.default,document.body.appendChild(e),this.addBuildButtons(),this.initToggleButtonEvents()}initToggleButtonEvents(){document.getElementById(g.toggleBuilderButtonId).addEventListener("click",(()=>{const e=document.getElementById(g.buildContainerId);e.classList.toggle("hidden"),e.classList.contains("hidden")?this.tryExitBuildMode():this.tryGoToBuildMode("current")}))}listenToCitySwitch(){this.citySwitchManager.on("cityChange",(e=>{const t=this.mainQueue.find((t=>t.city===e));this.rerenderQueue(t)}))}getBuilderScheduleTimes(){return this.mainQueue.map((e=>e.scheduledDate))}addBuildButtons(){const e=document.getElementById(g.buildOptionsContainerId);Object.values(d.buildings).forEach((t=>{const n=document.createElement("div");n.className=g.buildOptionItemClass,n.style.backgroundImage=t.backgroundImageProp,e.appendChild(n);const i=document.createElement("div");i.className=g.buildOptionItemAddClass,i.innerHTML="+",n.appendChild(i),n.addEventListener("click",(()=>{this.onOptionBuildButtonClick(t)}))}))}tryGoToBuildMode(e){return i(this,void 0,void 0,(function*(){var t;"current"!==e&&(yield e.switchAction()),null===(t=document.querySelector('[name="city_overview"]'))||void 0===t||t.click();const n=yield(0,s.waitForElement)('[class="construction_queue_build_button"] div',2e3);n.classList.contains("active")||n.click()}))}tryExitBuildMode(){const e=document.querySelector('[class="construction_queue_build_button"] div');(null==e?void 0:e.classList.contains("active"))&&e.click()}onOptionBuildButtonClick(e){const t=this.citySwitchManager.getCurrentCity();let n=this.mainQueue.find((e=>e.city.name===t.name));n||(n={city:t,queue:[],schedule:null,scheduledDate:null},this.mainQueue.push(n)),this.addToQueue(e,n)}addBuldingToUIQueue(e,t="end",n){const i=document.getElementById("additional-queue"),o=document.createElement("div");o.className=g.queueItemClass,o.style.backgroundImage=e.building.backgroundImageProp,o.setAttribute("data-id",e.id),"start"===t?this.appendChildAtIndex(i,o,0):i.appendChild(o);const r=document.createElement("div");r.className=g.upButtonClass,r.textContent=`+${e.toLvl}`,o.appendChild(r);const a=document.createElement("div");return a.className=g.cancelButtonClass,a.innerHTML="&#x2715;",o.appendChild(a),a.addEventListener("click",(()=>{const t=n.queue.findIndex((t=>t.id===e.id));-1!==t?(0===t?(n.queue.shift(),n.schedule&&(clearInterval(n.schedule),clearTimeout(n.schedule),n.schedule=null,n.scheduledDate=null),this.revalidateQueueItemLevels(e.building,t,n),this.handleBuildSchedule(n)):(n.queue.splice(t,1),this.revalidateQueueItemLevels(e.building,t,n)),o.remove(),this.saveQueueToStorage()):console.log("Item not found in queue")})),console.log("queueItemEl",o),o}revalidateQueueItemLevels(e,t,n){console.log("--------revalidateQueueItemLevels",e,t),n.queue.filter(((n,i)=>i>=t&&n.building.name===e.name)).forEach((e=>{const t=e.toLvl-1,n=`${e.building.name}-${t}`,i=document.querySelector(`[data-id="${e.id}"]`);i&&(i.querySelector(".up").textContent=`+${t}`,i.setAttribute("data-id",n)),e.toLvl=t,e.id=n}))}addToQueue(e,t){return i(this,void 0,void 0,(function*(){let n;if(yield this.tryGoToBuildMode("current"),yield(0,s.waitForElement)(e.elementSelector,1e3).catch((()=>null))){const t=yield(0,s.waitForElement)(`${e.elementSelector} ${d.buildingsSelectors.currentLvl}`,1e3).then((e=>e.textContent)).catch((()=>null));n="max"!==t||null!==t?Number(t):1/0}else n=0;if(n===1/0)return;const i=t.queue.filter((t=>t.building.name===e.name)).length+1,o={id:`${e.name}-${n+i}`,building:e,toLvl:n+i};console.log("queueItem",o),this.addBuldingToUIQueue(o,"end",t),t.queue.push(o),this.saveQueueToStorage(),console.log("pushed to queue:",JSON.parse(JSON.stringify(t.queue))),this.buildOrSchedule(t)}))}buildOrSchedule(e){return i(this,void 0,void 0,(function*(){1===e.queue.length?(console.log("\t-queue has only one item, handling immediately"),e.schedule&&(clearInterval(e.schedule),clearTimeout(e.schedule),e.schedule=null,e.scheduledDate=null),yield this.handleBuildSchedule(e)):console.log("\t-queue has more than one item, waiting for its turn")}))}performBuildSchedule(e){return i(this,void 0,void 0,(function*(){if(e&&e.queue.length)if(console.log("performBuildSchedule with queue:",JSON.parse(JSON.stringify(e.queue))),yield this.isEmptySlot(e.city)){const t=e.queue[0];yield this.checkIfItemCanBeBuiltAndAddDeleteOrSchedule(e,t)}else yield this.setTimeoutForNextSpeedUpAndSchedule(e);else(yield this.isQueueEmpty(e.city))||(yield this.setTimeoutForNextSpeedUpAndSchedule(e))}))}setTimeoutForNextSpeedUpAndSchedule(e){return i(this,void 0,void 0,(function*(){const t=yield this.getTimeToCanSpeedUp(e.city).catch((()=>null));if(null===t)return console.log("\t-timeToSpeedUp is null, performing build schedule"),void(yield this.performBuildSchedule(e));t<=0?(console.log("\t-will speed up first build immediately"),yield this.speedUpFirstBuild(e.city),yield this.performBuildSchedule(e)):(console.log("\t-speed up will be scheduled at:",(0,r.getTimeInFuture)(t)),e.schedule=setTimeout((()=>i(this,void 0,void 0,(function*(){try{yield this.lock.acquire({method:e.city.name+" - setTimeoutForNextSpeedUpAndSchedule (inside timeout)",manager:"builder"}),yield this.speedUpFirstBuild(e.city),yield this.performBuildSchedule(e)}catch(t){console.warn("CityBuilder.setTimeoutForNextSpeedUpAndSchedule().catch",t),console.log("\t-retrying setTimeoutForNextSpeedUpAndSchedule"),this.setTimeoutForNextSpeedUpAndSchedule(e)}finally{e.description=void 0,e.operation=void 0,console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue))),this.lock.release()}}))),t),e.scheduledDate=new Date(Date.now()+t),e.description="Waiting for speed up",e.operation="speedUp",console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue))))}))}checkIfItemCanBeBuiltAndAddDeleteOrSchedule(e,t){return i(this,arguments,void 0,(function*(e,t,n=!1){const i=t.building;console.log("check if can build item:",t);const o=yield this.canBuild(i,e.city);if(console.log("\t-canBuild:",o),!0===o){console.log("\t-canBuild is true, building...");const n=this.getEmptySlotsCount();yield i.buildAction(),yield this.untilEmptyslotsAreEqual(n-1),yield this.shiftQueueCleanScheduleAndTryNext(t,e)}else if("maxed"===o)console.log("\t-canBuild is maxed or not possible at the moment, shifting queue"),n?(this.clearUIQueueItem(e.queue[1]),e.queue.splice(1,1),yield this.shiftQueueCleanScheduleAndTryNext(t,e)):yield this.shiftQueueCleanScheduleAndTryNext(t,e);else if("impossible"===o)(yield this.isQueueEmpty(e.city))?(console.log("\t-canBuild is impossible, and queue is empty, element must be deleted"),yield this.shiftQueueCleanScheduleAndTryNext(t,e)):(console.log("\t-canBuild is impossible, but queue is not empty, scheduling build because maybe after that it will be possible"),yield this.setTimeoutForNextSpeedUpAndSchedule(e));else{const n=yield this.areResourcesStackable(i,e.city);if(!0===n.areStackable)console.log("\t-areResourcesStackable is true, scheduling build"),yield this.handleResourcesStackableFlow(i,e,n.requiredResources,t);else if("population"===n.areStackable&&this.allowCriticalBuilds){console.log("\t\t-areResourcesStackable is population, adding farm to queue");const t=d.buildings.farm,n=yield this.getBuildingCurrentLvl(t),o={id:`${t.name}-${n}`,building:i,toLvl:n+1};e.queue.unshift(o),this.addBuldingToUIQueue(o,"start",e),yield this.performBuildSchedule(e)}else if("storage"===n.areStackable&&this.allowCriticalBuilds){console.log("\t\t-areResourcesStackable is storage, adding storage to queue");const t=d.buildings.storage,n=yield this.getBuildingCurrentLvl(t),o={id:`${t.name}-${n}`,building:i,toLvl:n+1};e.queue.unshift(o),this.addBuldingToUIQueue(o,"start",e),yield this.performBuildSchedule(e)}else"alreadyStacked"!==n.areStackable||(yield this.isQueueEmpty(e.city))?(console.log("Item cannot be scheduled, because it has not met requirements"),yield this.shiftQueueCleanScheduleAndTryNext(t,e)):(console.log("\t\t-areResourcesStackable is alreadyStacked, scheduling build"),yield this.setTimeoutForNextSpeedUpAndSchedule(e))}}))}handleResourcesStackableFlow(e,t,n,o){return i(this,void 0,void 0,(function*(){const r=()=>i(this,void 0,void 0,(function*(){return yield this.resourceManager.hasEnoughResources(n,t.city)})),a=()=>i(this,void 0,void 0,(function*(){if(!0===(yield this.canBuild(e,t.city))){const n=this.getEmptySlotsCount();yield e.buildAction(),yield this.untilEmptyslotsAreEqual(n-1),yield this.shiftQueueCleanScheduleAndTryNext(o,t)}else yield this.shiftQueueCleanScheduleAndTryNext(o,t)})),s=(yield this.isQueueEmpty(t.city))?null:yield this.getTimeToCanSpeedUp(t.city).catch((()=>null));if(!s)return t.schedule=setInterval((()=>i(this,void 0,void 0,(function*(){try{t.scheduledDate=new Date(Date.now()+g.BUILD_RETRY_INTERVAL),yield this.lock.acquire({method:t.city.name+" - checkIfItemCanBeBuiltAndAddDeleteOrSchedule (inside interval)",manager:"builder"}),(yield r())&&(yield a())}catch(e){console.warn("CityBuilder.handleResourcesStackable().catch",e)}finally{this.lock.release()}}))),g.BUILD_RETRY_INTERVAL),void(t.scheduledDate=new Date(Date.now()+g.BUILD_RETRY_INTERVAL));s<g.BUILD_RETRY_INTERVAL?(t.schedule=setTimeout((()=>i(this,void 0,void 0,(function*(){try{yield this.lock.acquire({method:t.city.name+" - handleResourcesStackable (inside checking timeout)",manager:"builder"}),yield this.speedUpFirstBuild(t.city),(yield r())?yield a():yield this.handleResourcesStackableFlow(e,t,n,o)}catch(e){console.warn("CityBuilder.handleResourcesStackable().catch",e)}finally{t.description=void 0,t.operation=void 0,console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue))),this.lock.release()}}))),s),t.scheduledDate=new Date(Date.now()+s),t.description="Speeding up first build, then checking if can build, else comparing times for next schedule",t.operation="speedUpAndCheck",console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue)))):(t.schedule=setTimeout((()=>i(this,void 0,void 0,(function*(){try{yield this.lock.acquire({method:t.city.name+" - handleResourcesStackable (inside checking timeout)",manager:"builder"}),(yield r())?yield a():yield this.handleResourcesStackableFlow(e,t,n,o)}catch(e){console.warn("CityBuilder.handleResourcesStackable().catch",e)}finally{t.description=void 0,t.operation=void 0,console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue))),this.lock.release()}}))),g.BUILD_RETRY_INTERVAL),t.scheduledDate=new Date(Date.now()+g.BUILD_RETRY_INTERVAL),t.description="Checking if can build, then checking if next speed up time is shorter than standard interval",t.operation="buildCheck",console.log("mainQueue:",JSON.parse(JSON.stringify(this.mainQueue))))}))}getBuildingCurrentLvl(e){return i(this,void 0,void 0,(function*(){const t=(yield(0,s.waitForElement)(`${e.elementSelector} ${d.buildingsSelectors.currentLvl}`)).textContent;return"max"!==t?Number(t):1/0}))}clearUIQueueItem(e){const t=document.querySelector(`[data-id="${e.id}"]`);t&&t.remove()}getEmptySlotsCount(){return document.querySelectorAll(".construction_queue_order_container.instant_buy .js-queue-item.empty_slot").length}untilEmptyslotsAreEqual(e){return i(this,void 0,void 0,(function*(){return new Promise((t=>{const n=setInterval((()=>{this.getEmptySlotsCount()===e&&(console.log("\t-emptyslotsAreEqual:",e),clearInterval(n),t())}),333)}))}))}shiftQueueCleanScheduleAndTryNext(e,t){return i(this,void 0,void 0,(function*(){t.queue.shift(),this.saveQueueToStorage(),t.schedule&&(clearInterval(t.schedule),clearTimeout(t.schedule),t.schedule=null,t.scheduledDate=null),this.clearUIQueueItem(e),yield this.performBuildSchedule(t)}))}goToCityView(){const e=document.querySelector('[name="city_overview"]');null==e||e.click()}handleBuildSchedule(e){return i(this,void 0,void 0,(function*(){try{yield this.lock.acquire({method:e.city.name+" - handleBuildSchedule",manager:"builder"}),this.generalInfo.showInfo("Builder:",`Obsługa kolejki w mieście: ${e.city.name}`),yield this.performBuildSchedule(e)}catch(e){console.warn("CityBuilder.doQueueOperation().catch",e)}finally{console.log("handleBuildSchedule, release lock",e.city.name),this.generalInfo.hideInfo(),this.lock.release()}}))}speedUpFirstBuild(e){return i(this,void 0,void 0,(function*(){yield this.tryGoToBuildMode(e);const t=yield(0,s.waitForElement)('[data-order_index="0"] .type_free',2e3).catch((()=>null));if(!t)throw new Error("No free button found");{const e=this.getEmptySlotsCount();t.click(),yield this.untilEmptyslotsAreEqual(e+1)}}))}canBuild(e,t){return i(this,void 0,void 0,(function*(){if(yield this.tryGoToBuildMode(t),!(yield(0,s.waitForElement)(e.elementSelector,2e3).catch((()=>null))))return"impossible";const n=yield(0,s.waitForElement)(`${e.elementSelector} ${d.buildingsSelectors.buildButton}`,1e3).catch((()=>null));return n?!n.classList.contains(d.buildingsSelectors.disabled):"maxed"}))}areResourcesStackable(e,t){return i(this,void 0,void 0,(function*(){console.log("areResourcesStackable"),yield this.tryGoToBuildMode(t);let n=0;do{(0,s.triggerHover)(document.querySelector(`${e.elementSelector} ${d.buildingsSelectors.buildButton}`)),yield(0,r.addDelay)(333),n++}while(!(yield(0,s.waitForElement)('#popup_div img[src*="images/game/res/wood.png"]',500).catch((()=>!1)))&&n<4);if(4===n)return console.warn("No popup content found, had to try 4 times. Returning false"),{areStackable:!1,requiredResources:{wood:0,stone:0,iron:0}};const i=Number((yield(0,s.waitForElement)('#popup_div img[src*="images/game/res/wood.png"]',3e3)).nextSibling.textContent),o=Number((yield(0,s.waitForElement)('#popup_div img[src*="images/game/res/stone.png"]',0)).nextSibling.textContent),a=Number((yield(0,s.waitForElement)('#popup_div img[src*="images/game/res/iron.png"]',0)).nextSibling.textContent),l=Number((yield(0,s.waitForElement)('#popup_div img[src*="images/game/res/pop.png"]',0)).nextSibling.textContent);(0,s.cancelHover)(document.querySelector(`${e.elementSelector} ${d.buildingsSelectors.buildButton}`));const c=yield this.resourceManager.getResourcesInfo();console.log(`Resource requirements:\n      \t- Required population: ${l}\n      \t- Current population: ${this.resourceManager.getPopulation()}\n      \t- Store capacity: ${yield this.resourceManager.getStoreCapacity()}\n      \t- Required wood: ${i}\n      \t- Required stone: ${o}\n      \t- Required iron: ${a}`),console.log("Current resources:",c);const u={wood:i,stone:o,iron:a};return l>c.population.amount?(yield this.isBuildingInRealQueue(e))?{areStackable:"waiting",requiredResources:u}:{areStackable:"population",requiredResources:u}:[i,o,a].reduce(((e,t)=>t>e?t:e),0)>c.storeMaxSize?(yield this.isBuildingInRealQueue(e))?{areStackable:"waiting",requiredResources:u}:{areStackable:"storage",requiredResources:u}:i<=c.wood.amount&&o<=c.stone.amount&&a<=c.iron.amount&&l<=c.population.amount?{areStackable:"alreadyStacked",requiredResources:u}:{areStackable:!0,requiredResources:u}}))}addStyle(){const e=document.createElement("style");e.textContent=l.default,document.head.appendChild(e)}isBuildingInRealQueue(e,t){return i(this,void 0,void 0,(function*(){t&&(yield t.switchAction());const n=e.elementSelector.split(".")[2];for(const e of document.querySelectorAll(".type_building_queue .queued_building_order"))if(e.classList.contains(n))return!0;return!1}))}isEmptySlot(e){return i(this,void 0,void 0,(function*(){return this.goToCityView(),yield e.switchAction(),yield(0,r.addDelay)(1e3),yield(0,s.waitForElement)(".construction_queue_order_container.instant_buy .js-queue-item.empty_slot",1e3).then((()=>!0)).catch((()=>!1))}))}getTimeToCanSpeedUp(e){return i(this,void 0,void 0,(function*(){this.goToCityView(),yield e.switchAction(),yield(0,r.addDelay)(1e3);const t=yield(0,s.waitForElement)('[data-order_index="0"] .countdown.js-item-countdown',3e3).catch((()=>null));if(t)return(0,r.textToMs)(t.textContent)-3e5;throw new Error("No item in the queue.")}))}loadQueueFromStorage(){this.mainQueue=this.citySwitchManager.getCityList().map((e=>({city:e,queue:[],schedule:null,scheduledDate:null})));const e=localStorage.getItem("cityBuilderQueue");e&&JSON.parse(e).forEach((e=>{const t=this.citySwitchManager.getCityByName(e.city.name);if(!t)return;const n=e.queue.map((e=>{const t=Object.values(d.buildings).find((t=>t.name===e.building.name));return Object.assign(Object.assign({},e),{building:t})}));this.mainQueue.find((e=>e.city===t)).queue=n}));const t=this.citySwitchManager.getCurrentCity(),n=this.mainQueue.find((e=>e.city===t));n&&n.queue.forEach((e=>{this.addBuldingToUIQueue(e,"end",n)}))}saveQueueToStorage(){localStorage.setItem("cityBuilderQueue",JSON.stringify(this.mainQueue))}isQueueEmpty(e){return i(this,void 0,void 0,(function*(){return yield e.switchAction(),this.goToCityView(),new Promise((e=>setTimeout((()=>null!=e(document.querySelector(".empty_queue"))),0)))}))}start(){return i(this,void 0,void 0,(function*(){this.RUN=!0,document.getElementById(g.toggleBuilderButtonId).classList.remove("hidden");for(const e of this.mainQueue)yield this.handleBuildSchedule(e)}))}stop(){console.log("Stopping"),this.RUN=!1,this.mainQueue.forEach((e=>{e.schedule&&(clearInterval(e.schedule),clearTimeout(e.schedule),e.schedule=null,e.scheduledDate=null)})),document.getElementById(g.toggleBuilderButtonId).classList.add("hidden")}isRunning(){return this.RUN}appendChildAtIndex(e,t,n){e.insertBefore(t,e.children[n])}rerenderQueue(e){document.getElementById("additional-queue").innerHTML="",e&&e.queue.forEach((t=>{this.addBuldingToUIQueue(t,"end",e)}))}}g.queueContainerId="additional-queue",g.queueItemClass="queue-item",g.cancelButtonClass="cancel",g.upButtonClass="up",g.buildOptionsContainerId="build-options",g.buildOptionItemClass="build-option",g.buildOptionItemAddClass="build-options-add",g.buildContainerId="build-container",g.toggleBuilderButtonId="toggle-builder",g.BUILD_RETRY_INTERVAL=6e5,t.default=g},2:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(7)),a=n(396),s=n(910),l=o(n(715));class c extends r.default{constructor(){super(),this.RUN=!1,this.cityList=[]}static getInstance(){return i(this,void 0,void 0,(function*(){return c.instance||(c.instance=new c,c.instance.generalInfo=l.default.getInstance(),c.instance.cityList=yield c.instance.initCityList(),c.instance.mountObserver()),c.instance}))}mountObserver(){new MutationObserver((e=>{for(const t of e)t.addedNodes.length&&(this.emit("cityChange",this.getCurrentCity()),console.log("cityChange:",this.getCurrentCity()))})).observe(document.querySelector(".town_name_area .town_name.js-rename-caption"),{childList:!0})}initCityList(){return i(this,void 0,void 0,(function*(){var e,t,n,o,r;let l;for(this.generalInfo.showInfo("City Switch Manager:","Inicjalizacja listy miast"),(yield(0,a.waitForElement)(".town_groups_dropdown.btn_toggle_town_groups_menu")).click();!(l=yield(0,a.waitForElement)(".group_towns",1e3).catch((()=>null)));)document.querySelector(".btn_toggle_town_groups_menu").click(),yield(0,s.addDelay)(100);const c=l.querySelectorAll("span.town_name"),d=[];for(const l of c){console.log("initCityList.town:",l);const c=l.parentElement.getAttribute("data-townid");console.log("\t-cityId:",c),yield this.openTownList(),console.log("\t-openTownList");for(const e of Array.from(yield(0,a.waitForElements)(".group_towns span.town_name",3e3)))if(console.log("\t\t-element to match, element searched:",e.textContent,l.textContent),e.textContent===l.textContent){console.log("\t\t\t-found matched element:",e,"click it"),e.click();break}yield(0,s.addDelay)(100),document.querySelector(".btn_jump_to_town.circle_button.jump_to_town").click(),console.log("\t-click",document.querySelector(".btn_jump_to_town.circle_button.jump_to_town"));const u=null!==(r=null===(o=null===(n=Array.from(null!==(t=null===(e=yield(0,a.waitForElement)(`#town_${c}`,3e3))||void 0===e?void 0:e.classList)&&void 0!==t?t:[]).find((e=>e.match(/town_\d+_\d+_\d+/))))||void 0===n?void 0:n.match(/town_(\d+_\d+)_\d+/))||void 0===o?void 0:o[1])&&void 0!==r?r:"",h=l.textContent;d.push({name:h,cityId:c,isleId:u,switchAction:()=>i(this,void 0,void 0,(function*(){try{if(document.querySelector("div.town_name").textContent!==h){let e=document.querySelector(".group_towns");if(!e)do{yield(0,a.waitForElement)(".town_groups_dropdown.btn_toggle_town_groups_menu",1e3).then((e=>e.click())).catch((()=>null)),yield(0,s.addDelay)(333)}while(!(e=yield(0,a.waitForElement)(".group_towns",1500).catch((()=>null))));Array.from(e.querySelectorAll("span.town_name")).find((e=>e.textContent===h)).click();do{yield(0,s.addDelay)(100)}while(document.querySelector("div.town_name").textContent!==h)}document.querySelector(".btn_jump_to_town.circle_button.jump_to_town").click(),yield(0,s.addDelay)(100)}catch(e){console.warn("switchAction.catch:",e)}}))})}return console.log("CitySwitchManager.cityList.initialized:",d),yield this.goBackToFirstTown(),this.generalInfo.hideInfo(),d}))}openTownList(){return i(this,void 0,void 0,(function*(){(yield(0,a.waitForElement)(".group_towns",1e3).catch((()=>null)))||(yield(0,a.waitForElement)(".town_groups_dropdown.btn_toggle_town_groups_menu")).click()}))}goBackToFirstTown(){return i(this,void 0,void 0,(function*(){document.querySelector(".btn_next_town.button_arrow.right").click(),document.querySelector(".btn_jump_to_town.circle_button.jump_to_town").click()}))}clickArrowUntilCityFound(e){return i(this,void 0,void 0,(function*(){const t=document.querySelector(".town_name_area"),n=t.querySelector(".btn_prev_town.button_arrow.left"),i=t.querySelector(".btn_next_town.button_arrow.right");do{if(i.click(),yield(0,s.addDelay)(1500),document.querySelector("div.town_name").textContent===e)return}while(i.classList.contains("disabled"));do{if(n.click(),yield(0,s.addDelay)(1500),document.querySelector("div.town_name").textContent===e)return}while(!n.classList.contains("disabled"))}))}getCurrentCity(){var e,t;const n=null!==(t=null===(e=document.querySelector("div.town_name"))||void 0===e?void 0:e.textContent)&&void 0!==t?t:"";return this.getCityByName(n)}getCityByName(e){return this.cityList.find((t=>t.name===e))}getCityList(){return this.cityList}isRunning(){return this.RUN}run(){this.RUN=!0}stop(){this.RUN=!1}}t.default=c},543:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.FarmingSolution=void 0;const r=o(n(7)),a=n(773),s=o(n(639)),l=n(910),c=o(n(785)),d=n(396),u=o(n(2)),h=o(n(715)),m=n(388);var g;!function(e){e[e.Captain=0]="Captain",e[e.Manual=1]="Manual"}(g||(t.FarmingSolution=g={}));class f extends r.default{constructor(){super(),this.schedulerArray=[],this.captainScheduler=null,this.messageDialogObserver=null,this.humanMessageDialogObserver=null,this.farmSolution=g.Manual,this.RUN=!1,this.scheduleNextFarmingOperationForCity=(e,t)=>{const n={scheduledDate:new Date(Date.now()+e),timeout:null,city:t},o=setTimeout((()=>i(this,void 0,void 0,(function*(){this.schedulerArray=this.schedulerArray.filter((e=>e!==n)),this.farmVillages(t)}))),e);n.timeout=o,this.schedulerArray.push(n),console.log("scheduler:",this.schedulerArray)},this.mountMessageDialogsObservers=e=>i(this,void 0,void 0,(function*(){if(!this.messageDialogObserver){const e=new MutationObserver((e=>i(this,void 0,void 0,(function*(){for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)if(e instanceof HTMLElement&&"window_curtain ui-front show_curtain is_modal_window"===e.getAttribute("class"))return yield(0,l.addDelay)(100),void e.querySelector(".btn_confirm.button_new").click()}))));this.messageDialogObserver=e,this.messageDialogObserver.observe(document.body,{childList:!0})}if(!this.humanMessageDialogObserver&&e){const t=new MutationObserver((n=>i(this,void 0,void 0,(function*(){for(const i of n)"childList"===i.type&&(t.disconnect(),yield e.switchAction())}))));this.humanMessageDialogObserver=t,t.observe(document.querySelector("#human_message"),{childList:!0,subtree:!0})}this.messageDialogObserver.observe(document.body,{childList:!0})}))}static getInstance(){return i(this,void 0,void 0,(function*(){return f.instance||(f.instance=new f,f.instance.generalInfo=h.default.getInstance(),f.instance.citySwitch=yield u.default.getInstance(),f.instance.config=s.default.getInstance().getConfig(),f.instance.lock=c.default.getInstance(),yield f.instance.setFarmSolution()),f.instance}))}setFarmSolution(){return i(this,void 0,void 0,(function*(){const e=yield(0,d.waitForElement)(".advisor_frame.captain .advisor",4e3).then((e=>e.classList.contains("captain_active"))).catch((()=>!1));this.farmSolution=e?g.Captain:g.Manual}))}getFarmSolution(){return this.farmSolution}getFarmScheduleTimes(){var e;return this.farmSolution===g.Captain?[null===(e=this.captainScheduler)||void 0===e?void 0:e.scheduledDate]:this.schedulerArray.map((e=>e.scheduledDate))}farmWithCaptain(){return i(this,arguments,void 0,(function*(e=!1){var t,n,o,r,a,s,c,u;let h=[];try{if(yield this.lock.acquire({method:"farmWithCaptain",manager:"farmManager"}),this.generalInfo.showInfo("Farm Manager:","Farmienie z kapitanem."),console.log("farmWithCaptain at ",new Date),this.mountMessageDialogsObservers(),h=Array.from(document.querySelectorAll('[role="dialog"]')),document.querySelector('[name="farm_town_overview"]').click(),this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100),!e){let e=yield(0,d.waitForElementInterval)(".ribbon_wrapper",{retries:4,interval:400}).catch((()=>{throw new m.InfoError("cooldownWrapper not found, cannot proceed",{browserState:(0,l.getBrowserStateSnapshot)(),elementState:(0,l.getElementStateSnapshot)(document.querySelector(".ribbon_wrapper"))})}));if(!e.classList.contains("hidden")){let i;for(console.log("cooldownWrapper found, not hidden");!(i=null===(t=e.querySelector(".ribbon_locked .unlock_time"))||void 0===t?void 0:t.textContent);)yield(0,l.addDelay)(333);const o=null===(n=i.match(/\d{2}:\d{2}:\d{2}/))||void 0===n?void 0:n[0],r=(0,l.calculateTimeToNextOccurrence)(o)+this.config.general.timeDifference+1e3,a=new Date(Date.now()+r);console.log("schedule next farming operation for captain on:",a);const s=setTimeout((()=>{console.log("performing scheduled farming operation for captain, at:",(0,l.formatDateToSimpleString)(new Date)),this.farmWithCaptain(!0)}),r);return void(this.captainScheduler={scheduledDate:a,timeout:s})}}for(;null===(o=document.querySelector("#fto_town_wrapper .button.button_new"))||void 0===o?void 0:o.classList.contains("disabled");)yield(0,l.addDelay)(500);console.log("clicked select all"),yield(0,d.waitForElementInterval)("#fto_town_wrapper .checkbox.select_all",{retries:4,interval:500}).then((e=>e.click())).then((()=>i(this,void 0,void 0,(function*(){for(var e;!(null===(e=document.querySelector("#fto_town_wrapper .checkbox.select_all"))||void 0===e?void 0:e.classList.contains("checked"));)yield(0,l.addDelay)(500)})))),this.config.farmConfig.humanize&&(yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)));const g=document.querySelectorAll("#fto_town_wrapper .gp_town_link");for(const e of this.config.farmConfig.farmingCities)for(const t of g)if(t.textContent===e.name){const n=t.parentElement.querySelector(".checkbox.town_checkbox");if(!n.classList.contains("checked")){console.log("clicking town checkbox",e.name),n.click(),yield(0,l.addDelay)(100);break}}console.log("select farm options"),yield(0,l.addDelay)(500);const f=document.querySelectorAll(".fto_time_checkbox"),p=this.getFarmOptionIndex();let y;!f[p].classList.contains("checked")&&f[p].click(),this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100),!(null===(r=f[p+4])||void 0===r?void 0:r.classList.contains("checked"))&&(null===(a=f[p+4])||void 0===a||a.click()),this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100),console.log("collecting resources"),document.querySelector("#fto_claim_button").click(),this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100),console.log("finding new cooldown");let v=0;for(;!(y=null===(u=null===(c=null===(s=document.querySelector(".ribbon_wrapper .ribbon_locked .unlock_time"))||void 0===s?void 0:s.textContent)||void 0===c?void 0:c.trim().match(/\d{2}:\d{2}:\d{2}/))||void 0===u?void 0:u[0])&&v<5;)yield(0,l.addDelay)(333),v++;if(5===v)throw new Error("new cooldown not found, cannot schedule properly");const b=(0,l.calculateTimeToNextOccurrence)(y)+this.config.general.timeDifference+1e3,w=new Date(Date.now()+b);console.log("schedule next farming operation for captain on:",w);const S=setTimeout((()=>{console.log("performing scheduled farming operation for captain, at:",(0,l.formatDateToSimpleString)(new Date)),this.farmWithCaptain(!0)}),b);this.captainScheduler={scheduledDate:w,timeout:S},console.log("farmManager.farmWithCaptain.succesfullSnapchot",(0,l.getBrowserStateSnapshot)())}catch(e){e instanceof m.InfoError?console.warn("FarmManager.farmWithCaptain().catch",e.message,e.details,"will reschedule in 2 minutes"):console.warn("FarmManager.farmWithCaptain().catch",e,"will reschedule in 2 minutes"),this.captainScheduler={timeout:setTimeout((()=>{this.farmWithCaptain()}),12e4),scheduledDate:new Date(Date.now()+12e4)}}finally{console.log("captain scheduler:",this.captainScheduler),this.tryCloseCurrentDialog(Array.from(h)),this.disconnectObservers(),this.generalInfo.hideInfo(),this.lock.release()}}))}start(){return i(this,void 0,void 0,(function*(){this.RUN||(console.log("FarmManager started"),this.RUN=!0,yield this.initFarmAllVillages())}))}tryCloseCurrentDialog(e){var t;const n=document.querySelectorAll('[role="dialog"]'),i=Array.from(n).find((t=>!e.includes(t)));null===(t=null==i?void 0:i.querySelector(".ui-dialog-titlebar-close"))||void 0===t||t.click()}ensureAllChecbkoxesUnchecked(){return i(this,void 0,void 0,(function*(){const e=yield(0,d.waitForElementInterval)("#fto_town_wrapper .checkbox.select_all",{timeout:2e3,interval:400});e.classList.contains("checked")&&(e.click(),yield(0,l.addDelay)(100));const t=yield(0,d.waitForElementsInterval)("#fto_town_wrapper .checkbox.town_checkbox",{timeout:2e3,interval:400});for(const e of t)e.classList.contains("checked")&&(e.click(),yield(0,l.addDelay)(100))}))}farmVillages(e){return i(this,void 0,void 0,(function*(){try{console.log("farmVillages, wait for lock",e.name),yield this.lock.acquire(),this.generalInfo.showInfo("Farm Manager:",`farmienie w mieście: ${e.name}`),console.log("farmVillages, take lock",e.name),yield this.farmVillagesFlow(e)}catch(e){console.warn("FarmManager.farmVillages().catch",e)}finally{this.disconnectObservers(),console.log("farmVillages, release lock",e.name),this.generalInfo.hideInfo(),this.lock.release(),this.emit("farmingFinished")}}))}farmVillagesFlow(e){return i(this,arguments,void 0,(function*(e,t=!1){var n;try{console.log("farmVillagesFlow, switch to city",e.name,new Date),yield e.switchAction();let t=this.config.farmConfig.farmInterval;this.config.farmConfig.humanize?(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(333);const i=yield(0,d.waitForElementsInterval)('a.owned.farm_town[data-same_island="true"]',{timeout:3e3}).catch((()=>null));if(console.log("\t-villages to farm:",null==i?void 0:i.length),!i||0===i.length)return;const o=Array.from(i).map((e=>`[style="${e.getAttribute("style")}"]`)),r=o.length;this.mountMessageDialogsObservers(e);for(const[i,a]of o.entries()){console.log(`\t-checking village: ${i}, from town: ${e.name}`);let o=0;do{if(console.log("\t-clicking village element on the map",o),yield(0,d.performComplexClick)(document.querySelector(a)),console.log("\t-clicked village element on the map",o),yield(0,l.addDelay)(100),3===o)throw new Error("Farm villages dialog didn't show up");o++}while(!(yield(0,d.waitForElementInterval)(".farm_towns",{retries:3,interval:500}).catch((()=>!1))));this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100);const s=this.getFarmOptionIndex();o=0;do{if(console.log("\t-clicking farm button",o),yield(0,d.waitForElements)(".btn_claim_resources.button.button_new",500).then((e=>e[s].click())).catch((()=>{})),console.log("\t-clicked farm button",o),3===o)throw new Error("Farm button not found");o++,yield(0,l.addDelay)(100)}while(!(yield(0,d.waitForElement)(".actions_locked_banner.cooldown",1500).catch((()=>!1))));this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100),i===r-1&&(t=null!==(n=yield this.getUnlockTimeOrNull(yield(0,d.waitForElement)(".farm_towns"),2e3))&&void 0!==n?n:this.config.farmConfig.farmInterval),console.log("\t-closing village window"),yield(0,d.waitForElement)(".btn_wnd.close",2e3).then((e=>e.click())).catch((()=>{})),console.log("\t-closed village window"),this.config.farmConfig.humanize?yield(0,l.addDelay)((0,l.getRandomMs)(400,1200)):(0,l.addDelay)(100)}this.disconnectObservers(),this.scheduleNextFarmingOperationForCity(t+1e3,e)}catch(t){console.warn("FarmManager.farmVillagesFlow().catch",t),yield this.forceRepeatFarming(e)}}))}initFarmAllVillages(){return i(this,void 0,void 0,(function*(){var e;if(this.farmSolution===g.Captain)yield this.farmWithCaptain();else{const t=this.config.farmConfig.farmingCities.map((e=>this.citySwitch.getCityList().find((t=>t.name===e.name))));try{console.log("initFarmAllVillages, wait for lock",new Date),yield this.lock.acquire({method:"initFarmAllVillages",manager:"farmManager"}),this.generalInfo.showInfo("Farm Manager:","Inicjalizacja/farmienie wszystkich wiosek."),console.log("initFarmAllVillages, take lock",new Date);for(const e of t)yield this.farmVillagesFlow(e);1!==t.length&&(yield t[0].switchAction())}catch(e){console.warn("FarmManager.initFarmAllVillages().catch",e)}finally{this.generalInfo.hideInfo(),this.lock.release(),null===(e=this.messageDialogObserver)||void 0===e||e.disconnect(),this.emit("farmingFinished")}}}))}forceRepeatFarming(e){return i(this,void 0,void 0,(function*(){yield e.switchAction(),yield this.farmVillagesFlow(e,!0)}))}disconnectObservers(){var e,t;null===(e=this.messageDialogObserver)||void 0===e||e.disconnect(),null===(t=this.humanMessageDialogObserver)||void 0===t||t.disconnect()}getUnlockTimeOrNull(e,t){return i(this,void 0,void 0,(function*(){const n=yield(0,d.waitForElementFromNode)(e,".actions_locked_banner.cooldown",null!=t?t:500).catch((()=>null));if(n){const e=n.querySelector(".pb_bpv_unlock_time");return new Promise(((t,n)=>{let i=0;const o=setInterval((()=>{(null==e?void 0:e.textContent)?(clearInterval(o),console.log("next unlock time:",e.textContent),t((0,l.textToMs)(e.textContent))):10===i&&(clearInterval(o),console.warn("nie znaleziono czasu odblokowania"),t(null)),i++}),100)}))}return null}))}getFarmOptionIndex(){switch(this.config.farmConfig.farmInterval){case a.FarmTimeInterval.FirstOption:return 0;case a.FarmTimeInterval.SecondOption:return 1;case a.FarmTimeInterval.ThirdOption:return 2;case a.FarmTimeInterval.FourthOption:return 3;default:return 0}}getFarmOptionTimeRegex(){switch(this.config.farmConfig.farmInterval){case a.FarmTimeInterval.FirstOption:return/(5|10)/;case a.FarmTimeInterval.SecondOption:return/^(20|40)/;case a.FarmTimeInterval.ThirdOption:return/^(1.*30|3\D+)/;case a.FarmTimeInterval.FourthOption:return/^(4|8)h/;default:return/^(5|10)/}}getFarmOption(){return Array.from(document.querySelectorAll(".btn_claim_resources.button.button_new")).find((e=>{var t;return this.getFarmOptionTimeRegex().test(null!==(t=e.textContent)&&void 0!==t?t:"")}))}stop(){this.RUN=!1,console.log("FarmManager stopped"),this.schedulerArray.forEach((e=>{clearTimeout(e.timeout)})),this.schedulerArray=[],this.captainScheduler&&clearTimeout(this.captainScheduler.timeout),this.captainScheduler=null}isRunning(){return this.RUN}}t.default=f},299:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(773),a=o(n(323)),s=o(n(639)),l=n(910),c=o(n(233)),d=o(n(2)),u=o(n(543)),h=o(n(567)),m=o(n(715));class g{constructor(){this.pausedManagersSnapshot={farmManager:!1,switchManager:!1,scheduler:!1,builder:!1}}static getInstance(){return i(this,void 0,void 0,(function*(){return g.instance||(g.instance=new g,g.instance.generalInfo=m.default.getInstance(),g.instance.config=s.default.getInstance().getConfig(),g.instance.switchManager=yield d.default.getInstance(),g.instance.farmManager=yield u.default.getInstance(),g.instance.scheduler=yield h.default.getInstance(),g.instance.builder=yield c.default.getInstance(),g.instance.initCaptchaPrevention(),g.instance.initRefreshUtility(),g.instance.initConfigDialog()),g.instance}))}initRefreshUtility(e){setTimeout((()=>i(this,void 0,void 0,(function*(){const t=yield h.default.getInstance(),n=!t.isRunning()||t.canSafelyRefresh();n?(console.log("canRefresh, will refresh",n),console.log("timeout ?? this.config.general.applicationRefreshInterval",null!=e?e:this.config.general.applicationRefreshInterval),console.log("this.config.general.applicationRefreshInterval",this.config.general.applicationRefreshInterval),this.config.general.forcedRefresh=!0,s.default.getInstance().persistConfig(),yield(0,l.addDelay)(1e4),window.location.reload()):(console.log("canRefresh",n),this.initRefreshUtility(3e5))}))),null!=e?e:1e3*(this.config.general.applicationRefreshInterval+(Math.floor(121*Math.random())-60)))}initCaptchaPrevention(){new MutationObserver((e=>i(this,void 0,void 0,(function*(){for(const t of e)if("childList"===t.type){const e=document.querySelector("#recaptcha_window"),t=document.querySelector("#captcha_curtain");if(e){const t=e.querySelector('[class="recaptcha-checkbox-border"]');if(t){yield(0,l.addDelay)(4e3),t.click();const n=e.querySelector('#recaptcha_window [class="caption js-caption"]');n&&(yield(0,l.addDelay)(4e3),n.click())}}else if(t){const e=t.querySelector('[class="captcha-checkbox-border"]');if(e){yield(0,l.addDelay)(2e3),e.click();const n=t.querySelector('#captcha_curtain [class="caption js-caption"]');n&&(yield(0,l.addDelay)(2e3),n.click())}}}})))).observe(document.body,{childList:!0})}runManagersFromConfig(){return i(this,void 0,void 0,(function*(){this.configMenuWindow.isSwitchChecked()?this.switchManager.isRunning()||(console.log("switchManager will be started..."),this.switchManager.run()):this.switchManager.isRunning()&&(console.log("switchManager will be stopped..."),this.switchManager.stop()),this.configMenuWindow.isBuilderChecked()?this.builder.isRunning()||(console.log("Builder will be started..."),this.builder.start()):this.builder.isRunning()&&(console.log("Builder will be stopped..."),this.builder.stop()),this.configMenuWindow.isFarmChecked()?this.farmManager.isRunning()||(console.log("FarmManager will be started..."),yield this.farmManager.start()):this.farmManager.isRunning()&&(console.log("FarmManager will be stopped..."),this.farmManager.stop())}))}initConfigDialog(){return i(this,void 0,void 0,(function*(){this.configMenuWindow=new a.default,this.configMenuWindow.addListener("managersChange",(()=>i(this,void 0,void 0,(function*(){yield this.runManagersFromConfig()})))),yield this.configMenuWindow.render(),(this.config.general.forcedRefresh||(0,l.getCookie)("forceRestart"))&&(console.log("forcedRefresh/forceRestart",this.config.general.forcedRefresh,(0,l.getCookie)("forceRestart")),this.config.general.forcedRefresh=!1,(0,l.setCookie)("forceRestart",!1),this.config.farmConfig.farmInterval=r.FarmTimeInterval.FirstOption,s.default.getInstance().persistConfig(),this.configMenuWindow.minimize(),yield this.runManagersFromConfig())}))}run(){this.runManagersFromConfig()}pauseRunningManagers(e){console.log("pauseRunningManagers",this.pausedManagersSnapshot),!e.includes("farmManager")&&this.farmManager.isRunning()&&(this.farmManager.stop(),this.pausedManagersSnapshot.farmManager=!0),!e.includes("switchManager")&&this.switchManager.isRunning()&&(this.switchManager.stop(),this.pausedManagersSnapshot.switchManager=!0),!e.includes("scheduler")&&this.scheduler.isRunning()&&(this.scheduler.stop(),this.pausedManagersSnapshot.scheduler=!0),!e.includes("builder")&&this.builder.isRunning()&&(this.builder.stop(),this.pausedManagersSnapshot.builder=!0),console.log("pauseRunningManagers",this.pausedManagersSnapshot)}pauseRunningManagersIfNeeded(e,t){console.log("pauseRunningManagers",this.pausedManagersSnapshot),!t.includes("farmManager")&&this.farmManager.isRunning()&&this.farmManager.getFarmScheduleTimes().some((t=>t&&t.getTime()<=e&&Math.abs(t.getTime()-e)<=2e4))&&(this.farmManager.stop(),this.pausedManagersSnapshot.farmManager=!0),!t.includes("switchManager")&&this.switchManager.isRunning()&&(this.switchManager.stop(),this.pausedManagersSnapshot.switchManager=!0),!t.includes("scheduler")&&this.scheduler.isRunning()&&(this.scheduler.stop(),this.pausedManagersSnapshot.scheduler=!0),!t.includes("builder")&&this.builder.isRunning()&&this.builder.getBuilderScheduleTimes().some((t=>t&&t.getTime()<=e&&Math.abs(t.getTime()-e)<=2e4))&&(this.builder.stop(),this.pausedManagersSnapshot.builder=!0),console.log("pauseRunningManagers",this.pausedManagersSnapshot)}resumeRunningManagers(e){console.log("resumeRunningManagers",this.pausedManagersSnapshot),Object.entries(this.pausedManagersSnapshot).forEach((([t,n])=>{switch(t){case"farmManager":n&&!e.includes("farmManager")&&this.farmManager.start();break;case"switchManager":n&&!e.includes("switchManager")&&this.switchManager.run();break;case"scheduler":n&&!e.includes("scheduler")&&this.scheduler.run();break;case"builder":n&&!e.includes("builder")&&this.builder.start()}})),Object.keys(this.pausedManagersSnapshot).forEach((t=>{e.includes(t)&&(this.pausedManagersSnapshot[t]=!1)}))}forceRefresh(){this.config.general.forcedRefresh=!0,s.default.getInstance().persistConfig(),window.location.reload()}stopAll(){this.farmManager.stop(),this.switchManager.stop(),this.scheduler.stop(),this.builder.stop()}}t.default=g},715:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(39)),r=i(n(41));class a{constructor(){this.initInfoContainer()}static getInstance(){return a.instance||(a.instance=new a),a.instance}initInfoContainer(){console.log("initInfoContainer");const e=document.createElement("style");e.innerHTML=o.default,document.head.appendChild(e);const t=document.createElement("div");t.innerHTML=r.default,document.body.appendChild(t)}showInfo(e,t){const n=document.getElementById("info-container");n.querySelector(".info-title").textContent=e,n.querySelector(".info-text").textContent=t,n.classList.remove("hidden")}hideInfo(){document.getElementById("info-container").classList.add("hidden")}}t.default=a},254:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(639)),a=n(910),s=n(396);class l{constructor(){var e,t,n,i,o,a;this.configManager=r.default.getInstance(),this.minPopulationBuffer=null!==(n=null===(t=null===(e=this.configManager.getConfig())||void 0===e?void 0:e.resources)||void 0===t?void 0:t.minPopulationBuffer)&&void 0!==n?n:100,this.storeAlmostFullPercentage=null!==(a=null===(o=null===(i=this.configManager.getConfig())||void 0===i?void 0:i.resources)||void 0===o?void 0:o.storeAlmostFullPercentage)&&void 0!==a?a:.9}static getInstance(){return l.instance||(l.instance=new l),this.instance}start(){return i(this,void 0,void 0,(function*(){}))}stop(){}getStoreCapacity(){return i(this,void 0,void 0,(function*(){var e,t;(0,s.triggerHover)(document.querySelector('[data-type="wood"] .amount.ui-game-selectable'));const n=yield(0,s.waitForElement)(".island_resource_info span:nth-of-type(2)"),i=parseInt((null===(t=null===(e=null==n?void 0:n.textContent)||void 0===e?void 0:e.match(/\d+/))||void 0===t?void 0:t[0])||"0");return(0,s.cancelHover)(document.querySelector('[data-type="wood"] .amount.ui-game-selectable')),i}))}getPopulation(){return Number(document.querySelector('[data-type="population"] .amount.ui-game-selectable').textContent)}getResourcesInfo(){return i(this,void 0,void 0,(function*(){var e;const t=Number((yield(0,s.waitForElement)('[data-type="wood"] .amount.ui-game-selectable')).textContent),n=Number((yield(0,s.waitForElement)('[data-type="stone"] .amount.ui-game-selectable')).textContent),i=Number((yield(0,s.waitForElement)('[data-type="iron"] .amount.ui-game-selectable')).textContent),o=Number((yield(0,s.waitForElement)('[data-type="population"] .amount.ui-game-selectable')).textContent),r=yield(0,s.waitForElement)('[data-type="wood"] .amount.ui-game-selectable');let l=null;do{(0,s.triggerHover)(r),yield(0,a.addDelay)(333)}while(!(l=document.querySelector(".island_resource_info span:nth-of-type(2)")));const c=l.textContent,d=parseInt((null===(e=null==c?void 0:c.match(/\d+/))||void 0===e?void 0:e[0])||"0");return(0,s.cancelHover)(r),{wood:{amount:t,isAlmostFull:t>this.storeAlmostFullPercentage*d,isFull:t===d},stone:{amount:n,isAlmostFull:n>this.storeAlmostFullPercentage*d,isFull:n===d},iron:{amount:i,isAlmostFull:i>this.storeAlmostFullPercentage*d,isFull:i===d},population:{amount:o,isLow:o<this.minPopulationBuffer},storeMaxSize:d}}))}hasEnoughResources(e,t){return i(this,void 0,void 0,(function*(){yield t.switchAction();const n=Number(document.querySelector('[data-type="wood"] .amount.ui-game-selectable').textContent),i=Number(document.querySelector('[data-type="stone"] .amount.ui-game-selectable').textContent),o=Number(document.querySelector('[data-type="iron"] .amount.ui-game-selectable').textContent);return n>=e.wood&&i>=e.stone&&o>=e.iron}))}}t.default=l},567:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=o(n(639)),a=n(388),s=n(910),l=o(n(785)),c=n(396),d=o(n(641)),u=o(n(2)),h=o(n(299)),m=o(n(715)),g=o(n(813)),f=o(n(846)),p=o(n(218));var y;!function(e){e[e.ARMY_ATTACK=0]="ARMY_ATTACK",e[e.ARMY_SUPPORT=1]="ARMY_SUPPORT",e[e.ARMY_WITHDRAW=2]="ARMY_WITHDRAW",e[e.RESOURCE_SHIPMENT=3]="RESOURCE_SHIPMENT"}(y||(y={}));class v{constructor(){this.isLockTakenByScheduler=!1,this.scheduler=[],this._error=null,this._hydrationError=null,this._info=null,this.RUN=!0}privateconstructor(){}static getInstance(){return i(this,void 0,void 0,(function*(){return v.instance||(v.instance=new v,v.instance.lock=l.default.getInstance(),v.instance.generalInfo=m.default.getInstance(),v.instance.armyMovement=d.default.getInstance(),v.instance.masterManager=yield h.default.getInstance(),v.instance.citySwitchManager=yield u.default.getInstance(),v.instance.config=r.default.getInstance().getConfig(),v.instance.addUIExtenstion(),v.instance.addSchedulerListConfigWindow(),v.instance.synchronizeSchedulerWithStorage()),v.instance}))}addUIExtenstion(){return i(this,void 0,void 0,(function*(){yield this.mountCityDialogObserver()}))}run(){return i(this,void 0,void 0,(function*(){this.RUN=!0}))}stop(){return i(this,void 0,void 0,(function*(){this.RUN=!1}))}isRunning(){return this.RUN}undoArmyMovement(e,t){return i(this,void 0,void 0,(function*(){var n;yield e.switchAction(),yield(0,s.addDelay)(100);const i=document.querySelector("#toolbar_activity_commands");(0,c.triggerHover)(i),null===(n=document.querySelector(`#${t}`))||void 0===n||n.click()}))}extendAttackSupportUI(e){return i(this,void 0,void 0,(function*(){const t=e.querySelector(".button_wrapper"),n=document.createElement("div");n.innerHTML=g.default,t.appendChild(n);const o=document.querySelector("#schedule-date");o.value=this.getFormattedInputValueFromDate(new Date),n.querySelector("#schedule-button").addEventListener("click",(()=>i(this,void 0,void 0,(function*(){var t,n,r;this.error=null;const a=e.querySelector(".way_duration").textContent.slice(1),l=(0,s.textToMs)(a),d=Array.from(e.querySelectorAll(".unit_input")).map((e=>({name:e.getAttribute("name"),value:e.value}))),u=null===(t=e.querySelector(".cbx_include_hero"))||void 0===t?void 0:t.classList.contains("checked"),h="attack"===e.firstElementChild.getAttribute("data-type")?y.ARMY_ATTACK:y.ARMY_SUPPORT,m=h===y.ARMY_ATTACK?`[data-attack='${null===(n=document.querySelector(".attack_type.checked"))||void 0===n?void 0:n.dataset.attack}']`:void 0,g=o.value,f=document.querySelector("#schedule-time").value,p=this.getDateFromDateTimeInputValues(g,f),v=new Date(p.getTime()-l),b=this.citySwitchManager.getCurrentCity(),w="#town_"+Array.from(e.classList).find((e=>e.match(/attack_support_tab_target_\d+/))).match(/\d+/)[0];if(!this.canAddSchedulerItem(v))return console.warn("unsafe operation, failed to be scheudled"),void(this.error="Schedule failed. Cannot safely schedule operation.");if(!d.some((e=>e.value)))return void(this.error="Schedule failed. All units are empty.");document.querySelector('[data-menu_name="Info"]').click(),yield(0,s.addDelay)(100);const S=yield(0,c.waitForElementInterval)("#towninfo_towninfo .game_header.bold",{interval:500,timeout:2e3}).then((e=>e.textContent.trim())),_=`${h}_${b.name}_${S}_${v.getTime()}`;yield(0,c.waitForElementInterval)(".info_jump_to_town",{interval:500,retries:3}).then((e=>e.click())).catch((()=>{this.error="Schedule failed. Failed to switch to the city for grids."})),(yield(0,c.waitForElements)(".minimized_windows_area .btn_wnd.close",2e3)).forEach((e=>e.click())),yield(0,s.addDelay)(500),null===(r=document.querySelector(".btn_save_location"))||void 0===r||r.click(),yield(0,s.addDelay)(100),yield(0,c.waitForElement)(".save_coordinates input",4e3).then((e=>{(0,c.setInputValue)(e,_),e.blur()})).catch((()=>{throw new Error("Failed to save coordinates")})),yield(0,s.addDelay)(100),yield(0,c.waitForElement)(".save_coordinates .btn_confirm",3e3).then((e=>e.click())).catch((()=>{throw new Error("Failed to confirm saving coordinates")}));const k={id:_,operationType:h,attackTypeSelector:m,targetDate:p,targetCityName:S,actionDate:v,realActionTime:v.getTime()+this.config.general.timeDifference,sourceCity:b,targetCitySelector:w,data:d,includeHero:u,timeoutStructure:{timeoutPreparation:null,timeoutPreAction:null,timeoutAction:null},movementId:null,undoMovementAction:null,cancelSchedule:()=>i(this,void 0,void 0,(function*(){return yield this.cancelSchedule(k)})),postActionCleanup:()=>i(this,void 0,void 0,(function*(){return yield this.postActionCleanup(k)}))};this.addActionTimeouts(k),this.scheduler.push(k),this.addSchedulerItemToUI(k),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.info="Operation scheduled",console.log("Scheduler.extendAttackSupportUI.schedulerItem",k)}))))}))}postActionCleanup(e){return i(this,void 0,void 0,(function*(){setTimeout((()=>{this.removeSchedulerItemFromUI(e),this.scheduler=this.scheduler.filter((t=>t!==e)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler))}),0),this.isLockTakenByScheduler&&this.lock.release(),this.isLockTakenByScheduler=!1,this.generalInfo.showInfo("Scheduler:","Czyszczenie cache po operacji."),yield this.removeSavedCoords(e.id),this.generalInfo.hideInfo(),this.tryRestoreManagers()}))}cancelSchedule(e){return i(this,void 0,void 0,(function*(){this.generalInfo.showInfo("Scheduler:","Anulowanie operacji.");const{timeoutStructure:t}=e;t.timeoutPreparation&&clearTimeout(t.timeoutPreparation),t.timeoutPreAction&&clearTimeout(t.timeoutPreAction),t.timeoutAction&&clearTimeout(t.timeoutAction),this.isLockTakenByScheduler&&(this.lock.release(),this.isLockTakenByScheduler=!1),this.scheduler=this.scheduler.filter((t=>t!==e)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.removeSchedulerItemFromUI(e),yield this.removeSavedCoords(e.id),this.generalInfo.hideInfo(),this.tryRestoreManagers()}))}removeSavedCoords(e){return i(this,void 0,void 0,(function*(){var t,n;null===(n=null===(t=Array.from(document.querySelectorAll(".content.js-dropdown-item-list .item.bookmark")).find((t=>{var n;return(null===(n=t.textContent)||void 0===n?void 0:n.trim())===e})))||void 0===t?void 0:t.querySelector(".remove"))||void 0===n||n.click(),yield(0,c.waitForElementInterval)(".confirmation .btn_confirm",{interval:500,timeout:2e3}).then((e=>e.click()))}))}readCords(){const e=document.querySelector('.coord.coord_x.js-coord-x input[type="text"]'),t=document.querySelector('.coord.coord_y.js-coord-y input[type="text"]');return[e.value,t.value]}addActionTimeouts(e){const{actionDate:t,realActionTime:n,timeoutStructure:o,targetCitySelector:r,data:l,operationType:d,attackTypeSelector:u}=e,h=n-(new Date).getTime()-v.TURN_OFF_MANAGERS_TIME_MS;o.timeoutPreparation=setTimeout((()=>{this.generalInfo.showInfo("Scheduler:","pauzowanie kolidujących managerów przed operacją."),this.masterManager.pauseRunningManagersIfNeeded(n,["scheduler"]);const t=n-(new Date).getTime()-v.PREPARATION_TIME_MS;o.timeoutPreAction=setTimeout((()=>i(this,void 0,void 0,(function*(){var t,h;try{yield this.lock.forceAcquire({manager:"scheduler"}),this.isLockTakenByScheduler=!0,this.generalInfo.showInfo("Scheduler:","przygotowanie do operacji."),yield e.sourceCity.switchAction(),null===(t=document.querySelector(".js-coord-button"))||void 0===t||t.click();const n=yield(0,c.waitForElement)(".content.js-dropdown-item-list",4e3),i=Array.from(n.querySelectorAll(".item.bookmark.option")).find((t=>{var n;return(null===(n=t.textContent)||void 0===n?void 0:n.trim())===e.id}));if(!i)throw new Error("Failed to find dropdown item");i.click(),yield(0,s.addDelay)(400),null===(h=document.querySelector(".ui-dialog-titlebar-close"))||void 0===h||h.click();const o=yield(0,c.waitForElementInterval)(r,{interval:500,retries:4}).catch((()=>{throw new a.InfoError("target city not found",{browserState:(0,s.getBrowserStateSnapshot)()})})),m=(0,s.getElementStateSnapshot)(o);let g=0;do{yield(0,c.performComplexClick)(o),g++,yield(0,s.addDelay)(333)}while(!document.querySelector("#context_menu")&&g<4);if(4===g){const e={browserState:(0,s.getBrowserStateSnapshot)(),elementState:m};throw new a.InfoError("target city not found",e)}d===y.ARMY_ATTACK?((yield(0,c.waitForElementInterval)("#attack",{interval:500,timeout:2e3})).click(),yield(0,c.waitForElementInterval)(u,{interval:500,timeout:2e3}).then((e=>e.click()))):(yield(0,c.waitForElementInterval)("#support",{interval:500,timeout:2e3})).click();for(const e of l)if(e.value){const t=yield(0,c.waitForElementInterval)(`input[name="${e.name}"]`,{interval:500,timeout:2e3});(0,c.setInputValue)(t,e.value),t.blur()}e.includeHero&&(yield(0,c.waitForElementInterval)(".cbx_include_hero")).click(),console.log("action is ready to be performed, snapshot:",{browserState:(0,s.getBrowserStateSnapshot)(),elementState:m})}catch(t){return t instanceof a.InfoError?console.warn("Error during 10 seconds before action:",t.message,t.details):console.error("Error during 10 seconds before action:",t),this.error="Schedule failed. Check console for more details.",this.generalInfo.hideInfo(),void e.cancelSchedule()}o.timeoutAction=setTimeout((()=>i(this,void 0,void 0,(function*(){var t;try{d===y.ARMY_ATTACK?(yield(0,c.waitForElement)("#btn_attack_town")).click():(yield(0,c.waitForElement)(".attack_support_window a .middle")).click(),this.armyMovement.setCallback((t=>{e.movementId=t,e.undoMovementAction=()=>this.undoArmyMovement(e.sourceCity,t)})),null===(t=document.querySelector(".ui-dialog-titlebar-close"))||void 0===t||t.click(),this.error=null}catch(t){e.cancelSchedule(),console.error("Error during action:",t),this.error="Schedule failed. Check console for more details."}finally{e.postActionCleanup()}}))),n-(new Date).getTime())}))),t)}),h)}goToCoords(e){const t=document.querySelector('.coord.coord_x.js-coord-x input[type="text"]'),n=document.querySelector('.coord.coord_y.js-coord-y input[type="text"]');(0,c.setInputValue)(t,e[0]),(0,c.setInputValue)(n,e[1]),document.querySelector(".btn_jump_to_coordination").click()}synchronizeSchedulerWithStorage(){JSON.parse(localStorage.getItem("scheduler")||"[]").forEach((e=>this.hydrateSchedulerItem(e))),this.handleIfSchedulerListIsEmpty()}hydrateSchedulerItem(e){if(e.operationType===y.ARMY_ATTACK||e.operationType===y.ARMY_SUPPORT){if(e.actionDate=new Date(e.actionDate),e.targetDate=new Date(e.targetDate),e.sourceCity=this.citySwitchManager.getCityByName(e.sourceCity.name),!this.canAddSchedulerItem(e.actionDate))return console.warn("unsafe operation, failed to be scheudled during hydration"),void(this.hydrationError=`${e.sourceCity.name} ${e.operationType===y.ARMY_ATTACK?"attack":"support"} operation  at '${e.targetDate}' on city "${e.targetCitySelector}" failed to be scheduled during hydration.`);e.cancelSchedule=()=>i(this,void 0,void 0,(function*(){return yield this.cancelSchedule(e)})),e.postActionCleanup=()=>i(this,void 0,void 0,(function*(){return yield this.postActionCleanup(e)})),this.addActionTimeouts(e),this.scheduler.push(e),this.addSchedulerItemToUI(e)}}set error(e){const t=document.querySelector("#schedule-error");e?t&&(t.textContent=e):t&&(t.textContent=""),this._error=e}set hydrationError(e){this._hydrationError=e}set info(e){const t=document.querySelector("#schedule-info");e?t&&(t.textContent=e,setTimeout((()=>{t.textContent=""}),4e3)):t&&(t.textContent=""),this._info=e}canAddSchedulerItem(e){return e.getTime()-(new Date).getTime()>1e4&&(0===this.scheduler.length||!this.scheduler.some((t=>Math.abs(t.actionDate.getTime()-e.getTime())<1e4?(console.log("Interlacing times:",t.actionDate,e),console.log("\t:",t.actionDate.getTime()-e.getTime(),(t.actionDate.getTime()-e.getTime())/1e3),!0):(console.log("Not interlacing times:",t.actionDate,e),!1))))}tryRestoreManagers(){if(0===this.scheduler.length)console.log("RESTORE MANAGERS"),this.masterManager.resumeRunningManagers(["scheduler"]);else{const e=new Date,t=this.scheduler.reduce(((t,n)=>n.actionDate<e||t&&t<n.actionDate?t:n.actionDate),null);if(t)return void(t.getTime()-(new Date).getTime()>6e4?(console.log("RESTORE MANAGERS"),this.masterManager.resumeRunningManagers(["scheduler"])):console.log("DO NOT RESTORE MANAGERS"));this.masterManager.resumeRunningManagers(["scheduler"])}}getDateFromDateTimeInputValues(e,t){const n=t.match(/(\d{2})\D*(\d{2})\D*(\d{2})/);if(!n||!e.match(/^\d{4}-\d{2}-\d{2}$/))throw new Error("Invalid time format");const[,i,o,r]=n;return new Date(`${e}T${i}:${o}:${r}`)}getFormattedInputValueFromDate(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}mountAttackSupportSubpageObserver(e){const t=new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("attack_support_window"))return void this.extendAttackSupportUI(e)}));return t.observe(e,{childList:!0,subtree:!0}),()=>t.disconnect()}mountCityDialogObserver(){return i(this,void 0,void 0,(function*(){let e=null;new MutationObserver((t=>{for(const n of t)if("childList"===n.type){for(const t of n.addedNodes)if(t.nodeType===Node.ELEMENT_NODE&&"ui-dialog ui-corner-all ui-widget ui-widget-content ui-front ui-draggable ui-resizable js-window-main-container"===t.getAttribute("class"))return void(e=this.mountAttackSupportSubpageObserver(t));for(const t of n.removedNodes)if(t.nodeType===Node.ELEMENT_NODE&&"dialog"===t.getAttribute("role")&&t.classList.contains("ui-dialog")&&t.classList.contains("js-window-main-container")&&e)return e(),void(e=null)}})).observe(document.body,{childList:!0})}))}addSchedulerListConfigWindow(){const e=document.createElement("style");e.textContent=p.default,document.head.appendChild(e);const t=document.createElement("div");t.innerHTML=f.default,document.body.appendChild(t),this.addSchedulerListConfigListeners()}addSchedulerListConfigListeners(){const e=document.querySelector("#scheduler-toggle-button"),t=document.querySelector("#table-container");null==e||e.addEventListener("click",(()=>{null==t||t.classList.toggle("hidden")}));const n=document.querySelector(".close-icon");null==n||n.addEventListener("click",(()=>{null==t||t.classList.add("hidden")}))}addSchedulerItemToUI(e){const t=document.querySelector("#scheduler-lookup-table tbody").insertRow(),n=this.getSchedulerItemId(e);t.setAttribute("data-scheduler-item-id",n);const i=t.insertCell();i.textContent=e.operationType===y.ARMY_ATTACK?"Attack":"Support",i.classList.add(e.operationType===y.ARMY_ATTACK?"attack":"support"),t.insertCell().textContent=e.sourceCity.name,t.insertCell().textContent=e.targetCityName,t.insertCell().textContent=e.actionDate.toLocaleTimeString(),t.insertCell().textContent=e.targetDate.toLocaleTimeString();const o=t.insertCell(),r=document.createElement("button");r.classList.add("cancel-button"),r.textContent="Cancel",r.addEventListener("click",(()=>{e.cancelSchedule(),this.removeSchedulerItemFromUI(e)})),o.appendChild(r),this.handleIfSchedulerListIsEmpty()}removeSchedulerItemFromUI(e){console.log("removeSchedulerItemFromUI",e);const t=document.querySelector("#scheduler-lookup-table tbody").querySelector(`[data-scheduler-item-id="${this.getSchedulerItemId(e)}"]`);console.log("row",t),t.remove(),this.handleIfSchedulerListIsEmpty()}getSchedulerItemId(e){return`${e.operationType}_${e.sourceCity.name}_${e.targetCityName}_${e.actionDate.getTime()}`}handleIfSchedulerListIsEmpty(){const e=document.querySelector("#no-schedules");0===this.scheduler.length?e.classList.remove("hidden"):e.classList.add("hidden")}canSafelyRefresh(){return 0===this.scheduler.length||this.scheduler.every((e=>e.actionDate>new Date((new Date).getTime()+12e4)))}}v.MIN_PRECEDENCE_TIME_MS=1e4,v.TURN_OFF_MANAGERS_TIME_MS=2e4,v.PREPARATION_TIME_MS=1e4,t.default=v},639:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(773)),r=i(n(16));class a{constructor(){}static getInstance(){return a.instance||(a.instance=new a,a.instance.storageManager=r.default.getInstance(),a.instance.config=a.instance.initConfig(),a.instance.setTimeDifference()),a.instance}setTimeDifference(){let e=document.querySelector(".server_time_area").textContent.split(" ")[0].split(":"),t=new Date;t.setHours(parseInt(e[0])),t.setMinutes(parseInt(e[1])),t.setSeconds(parseInt(e[2])),this.config.general.timeDifference=(new Date).getTime()-t.getTime(),console.log(`server time: ${t}\nreal time: ${new Date}\ndiff in [s]: ${this.config.general.timeDifference/1e3}`)}initConfig(){const e=this.storageManager.readFromLocalStorage("config");return e&&this.isConfigStructureEqual(e,o.default,["farmingCities"])?e:(this.storageManager.writeToLocalStorage("config",o.default),o.default)}isConfigStructureEqual(e,t,n=[]){return Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every((i=>i in t&&(n.includes(i)||"object"!=typeof e[i]||null===e[i]?typeof e[i]==typeof t[i]:this.isConfigStructureEqual(e[i],t[i],n))))}getConfig(){return this.config}persistConfig(){this.storageManager.writeToLocalStorage("config",this.config)}getConfigValue(e){return this.config[e]}}t.default=a},388:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InfoError=void 0;class n extends Error{constructor(e,t){super(e),this.details=t,this.name="InfoError"}}t.InfoError=n},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getElementStateSnapshot=t.getBrowserStateSnapshot=t.getCopyOf=t.getRandomMs=t.areGridsEqual=t.msToTimeString=t.formatDateToSimpleString=t.getTimeInFuture=t.addDelay=t.isVisible=t.textToMs=void 0,t.getRandomInt=function(e){return Math.floor(Math.random()*e)},t.areArraysContentsEqual=function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.shuffleArray=function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}},t.isMobile=function(){return navigator.userAgentData?navigator.userAgentData.mobile:!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i))},t.calculateTimeToNextOccurrence=function(e){console.log("timeString to calculate: ",e);const[t,n,i]=e.split(":").map(Number),o=new Date,r=new Date(o);return r.setHours(t,n,i,0),r<=o&&r.setDate(r.getDate()+1),r.getTime()-o.getTime()},t.getCookie=function(e){const t=document.cookie.split("; ");for(let n of t){const[t,i]=n.split("=");if(t===e)return JSON.parse(decodeURIComponent(i))}return null},t.setCookie=function(e,t,n={}){const{expires:i=new Date(Date.now()+864e5),path:o="/",domain:r=".grepolis.com",secure:a=!1,sameSite:s="Lax"}=n;let l=`${e}=${encodeURIComponent(JSON.stringify(t))}; path=${o}; SameSite=${s}`;i&&(l+=`; expires=${i.toUTCString()}`),r&&(l+=`; domain=${r}`),a&&(l+="; secure"),document.cookie=l},t.textToMs=e=>{const t=e.split(":").map((e=>parseInt(e)));return 1e3*t[0]*60*60+1e3*t[1]*60+1e3*t[2]},t.isVisible=e=>e.offsetParent,t.addDelay=(e=1e3)=>new Promise((t=>setTimeout(t,e))),t.getTimeInFuture=e=>{const t=new Date,n=new Date(t.getTime()+e);return`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`},t.formatDateToSimpleString=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`,t.msToTimeString=e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},t.areGridsEqual=(e,t)=>e[0]===t[0]&&e[1]===t[1],t.getRandomMs=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),t.getCopyOf=e=>JSON.parse(JSON.stringify(e)),t.getBrowserStateSnapshot=()=>({documentVisibility:document.visibilityState,windowFocus:document.hasFocus(),windowSize:{width:window.innerWidth,height:window.innerHeight}}),t.getElementStateSnapshot=e=>({elementVisibility:null!==e.offsetParent,elementPosition:e.getBoundingClientRect(),elementZIndex:window.getComputedStyle(e).zIndex,elementInViewport:e.getBoundingClientRect().top>=0&&e.getBoundingClientRect().bottom<=window.innerHeight,elementClickable:!!e.onclick})},16:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){}static getInstance(){return n.instance||(n.instance=new n),n.instance}readFromLocalStorage(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null}writeToLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}}t.default=n},785:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(910);class r{constructor(){this.lockQueueInfo=[],this.lockCheckInterval=null,this.isLocked=!1,this.queue=[]}static getInstance(){return this.instance||(this.instance=new r,this.instance.setLockCheckInterval()),this.instance}setLockCheckInterval(){this.lockCheckInterval=setInterval((()=>{this.isLocked&&Date.now()-this.isLocked.requestedAt.getTime()>r.LOCK_TIMEOUT&&(console.warn(`Lock: lock is taken for too long by ${this.isLocked.manager} "${this.isLocked.method}", releasing...`),this.release())}),r.LOCK_TIMEOUT)}acquire(e){return i(this,void 0,void 0,(function*(){const t={method:null==e?void 0:e.method,requestedAt:new Date,forced:!1,manager:null==e?void 0:e.manager};this.isLocked?(console.log("\t-lock is taken, add",this.mapToLogObj(t),"to queue:",(0,o.getCopyOf)(this.lockQueueInfo)),this.lockQueueInfo.push(t),yield new Promise((e=>{this.queue.push(e)}))):(t.acquiredAt=new Date,this.isLocked=t,console.log("Lock: acquire",this.mapToLogObj(this.isLocked)))}))}forceAcquire(e){return i(this,void 0,void 0,(function*(){const t={method:e.method,requestedAt:new Date,forced:!0,manager:e.manager};if(!this.isLocked)return t.acquiredAt=new Date,this.isLocked=t,void console.log("Lock: forceAcquire: ",this.mapToLogObj(t));console.log("Lock: forceAcquire by",this.mapToLogObj(t),"on current lock:",this.mapToLogObj(this.isLocked)),yield new Promise((e=>{this.lockQueueInfo.unshift(t),this.queue.unshift(e),this.release()}))}))}release(){var e;if(this.queue.length>0){const t=this.queue.shift();t&&(this.isLocked.releasedAt=new Date,console.log("Lock: release:",this.mapToLogObj(this.isLocked)),this.isLocked=null!==(e=this.lockQueueInfo.shift())&&void 0!==e?e:{},this.isLocked.acquiredAt=new Date,console.log("\t-next element in the queue takes the lock:",this.mapToLogObj(this.isLocked)),t())}else this.isLocked.releasedAt=new Date,console.log("Lock: release: ",this.mapToLogObj(this.isLocked)),this.isLocked=!1}mapToLogObj(e){const t=Object.assign({},e);return t.requestedAt=t.requestedAt.toLocaleString(),t.acquiredAt&&(t.acquiredAt=t.acquiredAt.toLocaleString()),t.releasedAt&&(t.releasedAt=t.releasedAt.toLocaleString()),(0,o.getCopyOf)(t)}isTaken(){return!!this.isLocked}}r.LOCK_TIMEOUT=3e5,r.instance=null,t.default=r},396:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.cancelHover=t.triggerHover=void 0,t.simulateClick=function(e){if(e){const t=e.getBoundingClientRect(),n=new MouseEvent("click",{clientX:t.left+t.width/2,clientY:t.top+t.height/2,bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(n)}},t.setInputValue=function(e,t){if(e&&"INPUT"===e.tagName){e.value="number"==typeof t?t.toString():t;const n=new Event("input",{bubbles:!0});e.dispatchEvent(n);const i=new Event("change",{bubbles:!0});e.dispatchEvent(i)}else console.warn(`setInputValue(${e.name}) unsuccessful`)},t.waitForElements=function(e,t=8e3){return new Promise(((n,i)=>{const o=document.querySelectorAll(e);if(o.length>0)n(o);else{let o=setTimeout((()=>{r.disconnect(),i(`waitForElements(${e}) - not found within timeout`)}),t);const r=new MutationObserver((t=>{for(const i of t)if("childList"===i.type){const t=document.querySelectorAll(e);t.length>0&&(r.disconnect(),clearTimeout(o),n(t))}}));r.observe(document.body,{childList:!0,subtree:!0})}}))},t.waitForElement=function(e,t=8e3){return new Promise(((n,i)=>{const o=document.querySelector(e);if(o)return n(o);{setTimeout((()=>{o.disconnect(),i(`${e} - not found within timeout`)}),t);const o=new MutationObserver((i=>{for(const r of i)if("childList"===r.type)for(const i of r.addedNodes)i.nodeType===Node.ELEMENT_NODE&&i.matches(e)&&(o.disconnect(),clearTimeout(t),n(i))}));o.observe(document.body,{childList:!0,subtree:!0})}}))},t.waitForElementInterval=function(e,t=r){const{timeout:n=8e3,fromNode:i=document,interval:o=333,retries:a}=t;return new Promise(((t,r)=>{const s=i.querySelector(e);if(s)t(s);else{const s=a?setTimeout((()=>{clearInterval(c),r(`${e} - not found within timeout`)}),n):void 0;let l=0;const c=setInterval((()=>{l++;const n=i.querySelector(e);n?(clearInterval(c),clearTimeout(s),t(n)):a&&l>=a&&(clearInterval(c),r(`${e} - not found within timeout`))}),o)}}))},t.waitForElementsInterval=function(e,t=r){const{timeout:n=8e3,fromNode:i=document,interval:o=333,retries:a}=t;return new Promise(((t,r)=>{const s=i.querySelectorAll(e);if(s.length>0)t(s);else{const s=a?setTimeout((()=>{clearInterval(c),r(`${e} - not found within timeout`)}),n):void 0;let l=0;const c=setInterval((()=>{l++;const n=i.querySelectorAll(e);n.length>0?(clearInterval(c),clearTimeout(s),t(n)):a&&l>=a&&(clearInterval(c),r(`${e} - not found within timeout`))}),o)}}))},t.waitForElementFromNode=function(e,t,n=8e3){return new Promise(((i,o)=>{const r=e.querySelector(t);if(r)return i(r);{const r=setTimeout((()=>{a.disconnect(),o(`${t} - not found within timeout`)}),n),a=new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)e.nodeType===Node.ELEMENT_NODE&&e.matches(t)&&(a.disconnect(),clearTimeout(r),i(e))}));a.observe(e instanceof Document?e.body:e,{childList:!0,subtree:!0})}}))},t.onPageLoad=function(e){const t=()=>{const t=setTimeout((()=>{clearTimeout(t),setTimeout(e,2e3)}),500)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()},t.mouseDownEvent=a,t.performComplexClick=function(e){return i(this,void 0,void 0,(function*(){console.log("performComplexClick() - window:",window),a(e),yield(0,o.addDelay)(50),s(e)}))},t.mouseUpEvent=s,t.triggerKeydown=function(e,t){const n=new KeyboardEvent("keydown",{key:t,bubbles:!0,cancelable:!0});e.dispatchEvent(n)},t.triggerPaste=function(e,t){const n=new ClipboardEvent("paste",{bubbles:!0,cancelable:!0,clipboardData:new DataTransfer});n.clipboardData?(n.clipboardData.setData("text/plain",t),e.dispatchEvent(n)):console.warn("triggerPaste() - clipboardData is null")},t.performComplexInput=function(e,t){e.focus();const n=new Event("focus",{bubbles:!0,cancelable:!0});e.dispatchEvent(n);for(let n of t){const t=new KeyboardEvent("keydown",{key:n,bubbles:!0,cancelable:!0});e.dispatchEvent(t);const i=new KeyboardEvent("keypress",{key:n,bubbles:!0,cancelable:!0});e.dispatchEvent(i),e.value+=n;const o=new Event("input",{bubbles:!0,cancelable:!0});e.dispatchEvent(o);const r=new KeyboardEvent("keyup",{key:n,bubbles:!0,cancelable:!0});e.dispatchEvent(r)}};const o=n(910);t.triggerHover=e=>{e&&e.dispatchEvent(new Event("mouseover",{bubbles:!0,cancelable:!0}))},t.cancelHover=e=>{e&&e.dispatchEvent(new Event("mouseout",{bubbles:!0,cancelable:!0}))};const r={timeout:8e3,fromNode:document,interval:333,retries:void 0};function a(e){const t=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0});e&&e.dispatchEvent(t)}function s(e){const t=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0});e?e.dispatchEvent(t):console.warn(`mouseUpEvent() - ${e} not found`)}}},t={};function n(i){var o=t[i];if(void 0!==o)return o.exports;var r=t[i]={exports:{}};return e[i].call(r.exports,r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(927)})();
//# sourceMappingURL=bundle.js.map