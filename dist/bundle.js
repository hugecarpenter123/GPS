(()=>{"use strict";var e={7:e=>{var t,n="object"==typeof Reflect?Reflect:null,i=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,i){function r(n){e.removeListener(t,o),i(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}p(e,t,o,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&p(e,"error",t,{once:!0})}(e,r)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,i){var r,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),(r=l(e))>0&&s.length>r&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,n){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=u.bind(i);return r.listener=n,i.wrapFn=r,r}function h(e,t,n){var i=e._events;if(void 0===i)return[];var r=i[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):g(r,r.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function g(e,t){for(var n=new Array(t),i=0;i<t;++i)n[i]=e[i];return n}function p(e,t,n,i){if("function"==typeof e.on)i.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(o){i.once&&e.removeEventListener(t,r),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var c=l.length,u=g(l,c);for(n=0;n<c;++n)i(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,d(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,d(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,i,r,o,s;if(a(t),void 0===(i=this._events))return this;if(void 0===(n=i[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,r=o;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(i[e]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,o=Object.keys(n);for(i=0;i<o.length;++i)"removeListener"!==(r=o[i])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},o.prototype.listeners=function(e){return h(this,e,!0)},o.prototype.rawListeners=function(e){return h(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},165:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="build-container" class="hidden">\r\n  <div id="build-options">\r\n  </div>\r\n  <div id="additional-queue">\r\n\r\n  </div>\r\n</div>\r\n<button id="toggle-builder">Toggle builder</button>'},77:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#additional-queue {\r\n  display: flex;\r\n  gap: 8px;\r\n  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);\r\n  border-radius: 4px;\r\n  padding: 4px;\r\n  max-width: 568px;\r\n  width: fit-content;\r\n  overflow-y: auto;\r\n  font-family: Arial, Helvetica, sans-serif;\r\n}\r\n\r\n.queue-item {\r\n  flex-shrink: 0;\r\n  position: relative;\r\n  width: 45px;\r\n  height: 45px;\r\n  background-size: cover;\r\n  background-position: center;\r\n}\r\n\r\n.queue-item .up {\r\n  position: absolute;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  font-weight: bold;\r\n  color: lightgreen;\r\n  text-align: end;\r\n  margin: 2px;\r\n  font-size: 12px;\r\n  background-color: rgba(0, 0, 0, 0.4);\r\n}\r\n\r\n.queue-item .cancel {\r\n  position: absolute;\r\n  top: 0;\r\n  right: 0;\r\n  font-weight: bold;\r\n  color: red;\r\n  cursor: pointer;\r\n  padding: 1px;\r\n  font-size: 10px;\r\n}\r\n\r\n.queue-item .cancel:hover {\r\n  transform: scale(1.4);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\nhidden {\r\n  display: none;\r\n}\r\n\r\n#build-container {\r\n  z-index: 2000;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  gap: 8px;\r\n  position: fixed;\r\n  bottom: 80px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  border: 1px solid darkgoldenrod;\r\n  border-radius: 4px;\r\n  padding: 4px;\r\n  overflow-x: auto;\r\n  max-width: 90%;\r\n  background-color: bisque;\r\n  width: fit-content;\r\n}\r\n\r\n#build-options {\r\n  display: flex;\r\n  gap: 4px;\r\n}\r\n\r\n.build-option {\r\n  position: relative;\r\n  width: 40px;\r\n  height: 40px;\r\n  background-size: cover;\r\n  background-position: center;\r\n  cursor: pointer;\r\n}\r\n\r\n.build-option:hover {\r\n  transform: scale(1.1);\r\n  transition: all 0.2s ease;\r\n}\r\n\r\n.build-options-add {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: 50%;\r\n  transform: translate(50%, -50%);\r\n  font-weight: bold;\r\n  color: white;\r\n  cursor: pointer;\r\n  font-size: 16px;\r\n  user-select: none;\r\n}\r\n\r\n#toggle-builder {\r\n  cursor: pointer;\r\n  position: fixed;\r\n  bottom: 15px;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  font-size: 12px;\r\n  z-index: 1000;\r\n}"},813:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div style="margin-top: 8px;">\r\n  <input id="schedule-date" type="date" />\r\n  <input id="schedule-time" type="text" size="5" placeholder="hh:mm:ss" />\r\n  <button type="button" id="schedule-button">Schedule</button>\r\n  <p id="schedule-error" style="color: red;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;"></p>\r\n  <p id="schedule-info" style="color: green;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;"></p>\r\n</div>'},846:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="table-container" class="hidden">\r\n  <table id="scheduler-lookup-table">\r\n    <thead>\r\n      <tr>\r\n        <th id="operation-type">Operation Type</th>\r\n        <th class="source-city">Source City</th>\r\n        <th class="destination-city">Destination City</th>\r\n        <th class="departure-time">Departure Time</th>\r\n        <th class="arrival-time">Arrival Time</th>\r\n        <th class="actions"></th>\r\n      </tr>\r\n    </thead>\r\n    <tbody>\r\n      <tr>\r\n        <td colspan="6" id="no-schedules">No schedules</td>\r\n      </tr>\r\n    </tbody>\r\n  </table>\r\n</div>\r\n<button id="scheduler-toggle-button">scheduler</button>'},218:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#table-container {\r\n  max-height: 50vh;\r\n  overflow-y: auto;\r\n  border: 1px solid #ddd;\r\n  width: fit-content;\r\n}\r\n\r\n#scheduler-lookup-table {\r\n  font-family: Arial, Helvetica, sans-serif;\r\n  border-collapse: collapse;\r\n  font-size: 18px;\r\n  text-align: left;\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  z-index: 1000;\r\n  background-color: antiquewhite;\r\n}\r\n\r\n#no-schedules {\r\n  text-align: center;\r\n  height: 50px;\r\n}\r\n\r\n.attack {\r\n  font-weight: 600;\r\n  color: #d32f2f;\r\n}\r\n\r\n.support {\r\n  font-weight: 600;\r\n  color: #2979ff;\r\n}\r\n\r\n#scheduler-lookup-table * {\r\n  font-size: 14px;\r\n}\r\n\r\n#scheduler-lookup-table th,\r\n#scheduler-lookup-table td {\r\n  border: 1px solid #ddd;\r\n  padding: 8px;\r\n}\r\n\r\n#scheduler-lookup-table th {\r\n  background-color: #f2f2f2;\r\n  font-weight: bold;\r\n}\r\n\r\n#scheduler-lookup-table td {\r\n  text-wrap: nowrap;\r\n}\r\n\r\n\r\n.cancel-button {\r\n  background-color: #f44336;\r\n  color: white;\r\n  border: none;\r\n  padding: 5px 10px;\r\n  cursor: pointer;\r\n  transition-duration: 150ms;\r\n}\r\n\r\n.cancel-button:hover {\r\n  background-color: #d32f2f;\r\n}\r\n\r\n#scheduler-toggle-button {\r\n  padding: 4px 8px;\r\n  font-size: 12px;\r\n  font-variant: small-caps;\r\n  cursor: pointer;\r\n  border-radius: 20px;\r\n  position: absolute;\r\n  bottom: 220px;\r\n  right: 10px;\r\n  margin: 0;\r\n  z-index: 1000;\r\n  transition-duration: 150ms;\r\n}\r\n\r\n#scheduler-toggle-button:hover {\r\n  background-color: #ddd;\r\n}\r\n\r\n.hidden {\r\n  display: none;\r\n}"},604:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i="#config-popup-container * {\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n  font-family: Arial, Helvetica, sans-serif;\r\n  color: black;\r\n}\r\n\r\n#config-popup-header {\r\n  margin-bottom: 24px;\r\n  text-shadow: 2px 2px 2px gray;\r\n}\r\n\r\n#config-popup-container {\r\n  position: absolute;\r\n  top: 50%;\r\n  right: 50%;\r\n  transform: translate(50%, -50%);\r\n  box-shadow: 0px 3px 8px 0px rgba(157, 157, 157, 0.4);\r\n  border-radius: 4px;\r\n  width: 350px;\r\n  max-width: 80%;\r\n  overflow: hidden;\r\n  background-color: antiquewhite;\r\n  border: 1px solid rgba(165, 125, 11, 1);\r\n  z-index: 100;\r\n  padding: 16px;\r\n}\r\n\r\n.input-wrapper {\r\n  display: grid;\r\n  grid-template-columns: auto 1fr;\r\n  justify-items: start;\r\n  column-gap: 8px;\r\n  row-gap: 8px;\r\n  align-items: center;\r\n  margin-top: 16px;\r\n}\r\n\r\n.input-wrapper label {\r\n  background-color: none;\r\n}\r\n\r\n.expandable-section {\r\n  grid-column-start: 2;\r\n}\r\n\r\n#config-popup-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  border-radius: 4px;\r\n  gap: 8px;\r\n}\r\n\r\n#config-popup-content h1 {\r\n  font-weight: 500;\r\n  font-size: 1.7rem;\r\n  align-self: center;\r\n  margin-bottom: 8px;\r\n}\r\n\r\n.label-chevron {\r\n  display: flex;\r\n  align-items: center;\r\n  gap:8px\r\n}\r\n\r\n\r\n#button-panel {\r\n  align-self: flex-end;\r\n  margin-top: 20px;\r\n}\r\n\r\n#button-panel button {\r\n  padding: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\n#config-popup-container.minimized {\r\n  top: auto;\r\n  bottom: 150px;\r\n  right: 30px;\r\n  width: 40px;\r\n  height: 40px;\r\n  border-radius: 50%;\r\n  box-shadow: none;\r\n}\r\n\r\n\r\n.show-trigger {\r\n  display: none;\r\n}\r\n\r\n#close-popup {\r\n  cursor: pointer;\r\n  position: absolute;\r\n  right: 10px;\r\n  top: 10px;\r\n  transition-duration: 125ms;\r\n  color: tomato;\r\n  text-shadow: 0px 0px 2px black;\r\n}\r\n\r\n#close-popup:hover {\r\n  animation: freak 1s ease-in both infinite;\r\n}\r\n\r\n#config-popup-container.minimized #config-popup-content {\r\n  display: none;\r\n}\r\n\r\n#config-popup-container.minimized #config-popup-header {\r\n  display: none;\r\n}\r\n\r\n#config-popup-container.minimized {\r\n  padding: 0;\r\n}\r\n\r\n#config-popup-container.minimized .show-trigger {\r\n  cursor: pointer;\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-size: 0.7rem;\r\n  font-weight: 600;\r\n  text-shadow: 0px 1px 1px rgba(165, 125, 11, 1);\r\n}\r\n\r\n.section-header {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  gap: 5px;\r\n}\r\n\r\n.section-content {\r\n  display: flex;\r\n  flex-direction: column;\r\n  margin-left: 20px;\r\n}\r\n\r\n.arrow-down {\r\n  cursor: pointer;\r\n}\r\n\r\n.hidden {\r\n  display: none !important;\r\n}\r\n\r\n.rotate {\r\n  transform: rotate(180deg);\r\n}\r\n\r\n@keyframes freak {\r\n  0% {\r\n    transform: scale(1);\r\n  }\r\n\r\n  33.33% {\r\n    transform: scale(0.8);\r\n  }\r\n\r\n  66.66% {\r\n    transform: scale(1.2);\r\n  }\r\n}"},396:(e,t,n)=>{n.r(t),n.d(t,{default:()=>i});const i='<div id="config-popup-container" class="">\r\n  <div id="config-popup-header">\r\n    <h1>GPS config</h1>\r\n    <div id="close-popup">&#10006;</div>\r\n  </div>\r\n  <div id="config-popup-content">\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="city-switch" checked />\r\n      <label for="city-switch">Switch cities automatically</label>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="farm" checked />\r\n      <div class="label-chevron">\r\n        <label for="farm">\r\n          Farm manager\r\n        </label>\r\n        <svg xmlns="http://www.w3.org/2000/svg" class="arrow-down" width="16" height="16" fill="currentColor"\r\n          class="bi bi-chevron-down" viewBox="0 0 16 16">\r\n          <path fill-rule="evenodd"\r\n            d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708" />\r\n        </svg>\r\n      </div>\r\n      <div class="expandable-section hidden">\r\n        <div class="section-header"></div>\r\n        <div class="section-content">\r\n          <div class="input-wapper">\r\n            <label>\r\n              Time interval\r\n            </label>\r\n            <select id="time-interval-select">\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="builder" />\r\n      <label for="builder">Builder</label>\r\n    </div>\r\n    <div class="input-wrapper">\r\n      <input type="checkbox" id="guard" disabled />\r\n      <label for="guard">Guard (in progress)</label>\r\n    </div>\r\n\r\n    <div id="button-panel">\r\n      <button id="submit">Submit</button>\r\n      <button type="reset" id="cancel-all">Cancel all</button>\r\n    </div>\r\n  </div>\r\n  <div class="show-trigger">\r\n    GPS\r\n  </div>\r\n</div>'},773:(e,t)=>{var n;Object.defineProperty(t,"__esModule",{value:!0}),t.FarmTimeInterval=void 0,function(e){e[e.FiveMinutes=3e5]="FiveMinutes",e[e.TenMinutes=6e5]="TenMinutes",e[e.TwentyMinutes=12e5]="TwentyMinutes",e[e.FortyMinutes=24e5]="FortyMinutes",e[e.OneHourAndHalf=54e5]="OneHourAndHalf",e[e.ThreeHours=108e5]="ThreeHours",e[e.FourHours=144e5]="FourHours",e[e.EightHours=288e5]="EightHours"}(n||(t.FarmTimeInterval=n={}));const i={resources:{minPopulationBuffer:100,storeAlmostFullPercentage:.9},farmConfig:{farmInterval:n.FiveMinutes},general:{antyTimingMs:3e3}};t.default=i},927:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(299));(0,n(15).onPageLoad)((()=>i(void 0,void 0,void 0,(function*(){console.log("VERY POLITE GPS v.0.5.0 MVP walikonie special edition (c) 2024"),yield o.default.getInstance()}))))},641:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.callback=null}static getInstance(){return n.instance||(n.instance=new n,n.instance.mountObserver()),n.instance}mountObserver(){const e=new MutationObserver((e=>{e.forEach((e=>{if("childList"===e.type)for(const t of e.addedNodes)if(t instanceof HTMLElement&&"unit_movements"===t.getAttribute("data-commandtype")&&"-1"!=t.getAttribute("data-cancelable")&&this.callback)return this.callback(t.id),void(this.callback=null)}))})),t=document.querySelector("#toolbar_activity_commands_list .content.js-dropdown-item-list");e.observe(t,{childList:!0,subtree:!1})}setCallback(e){this.callback=e}}t.default=n},147:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.buildings=t.buildingsSelectors=void 0;const r=n(15),o=e=>i(void 0,void 0,void 0,(function*(){const t=document.querySelector('[name="city_overview"]');(null==t?void 0:t.classList.contains("checked"))||null==t||t.click();const n=document.querySelector('[class="construction_queue_build_button"] div');n.classList.contains("active")||n.click(),yield(0,r.waitForElement)(e).then((e=>e.click()))}));t.buildingsSelectors={buildButton:".btn_build.build_button",currentLvl:'[class="twa_content js-content-area"] span:nth-of-type(3)',disabled:"disabled"},t.buildings={main:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/main.png)",elementSelector:".city_overview_overlay.main",currentLvlElSelector:'.city_overview_overlay.main [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Senate",buildAction:()=>o(".city_overview_overlay.main .btn_build.build_button")},hide:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/hide.png)",elementSelector:".city_overview_overlay.hide",currentLvlElSelector:'.city_overview_overlay.hide [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Cave",buildAction:()=>o(".city_overview_overlay.hide .btn_build.build_button")},lumber:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/lumber.png)",elementSelector:".city_overview_overlay.lumber",currentLvlElSelector:'.city_overview_overlay.lumber [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Lumber mill",buildAction:()=>o(".city_overview_overlay.lumber .btn_build.build_button")},stoner:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/stoner.png)",elementSelector:".city_overview_overlay.stoner",currentLvlElSelector:'.city_overview_overlay.stoner [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Quarry",buildAction:()=>o(".city_overview_overlay.stoner .btn_build.build_button")},ironer:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/ironer.png)",elementSelector:".city_overview_overlay.ironer",currentLvlElSelector:'.city_overview_overlay.ironer [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Silver mine",buildAction:()=>o(".city_overview_overlay.ironer .btn_build.build_button")},market:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/market.png)",elementSelector:".city_overview_overlay.market",currentLvlElSelector:'.city_overview_overlay.market [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Market",buildAction:()=>o(".city_overview_overlay.market .btn_build.build_button")},docks:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/docks.png)",elementSelector:".city_overview_overlay.docks",currentLvlElSelector:'.city_overview_overlay.docks [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Harbor",buildAction:()=>o(".city_overview_overlay.docks .btn_build.build_button")},barracks:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/barracks.png)",elementSelector:".city_overview_overlay.barracks",currentLvlElSelector:'.city_overview_overlay.barracks [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Barracks",buildAction:()=>o(".city_overview_overlay.barracks .btn_build.build_button")},wall:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/wall.png)",elementSelector:".city_overview_overlay.wall",currentLvlElSelector:'.city_overview_overlay.wall [class="twa_content js-content-area"] span:nth-of-type(3)',name:"City wall",buildAction:()=>o(".city_overview_overlay.wall .btn_build.build_button")},storage:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/storage.png)",elementSelector:".city_overview_overlay.storage",currentLvlElSelector:'.city_overview_overlay.storage [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Warehouse",buildAction:()=>o(".city_overview_overlay.storage .btn_build.build_button")},farm:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/farm.png)",elementSelector:".city_overview_overlay.farm",currentLvlElSelector:'.city_overview_overlay.farm [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Farm",buildAction:()=>o(".city_overview_overlay.farm .btn_build.build_button")},academy:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/academy.png)",elementSelector:".city_overview_overlay.academy",currentLvlElSelector:'.city_overview_overlay.academy [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Academy",buildAction:()=>o(".city_overview_overlay.academy .btn_build.build_button")},temple:{backgroundImageProp:"url(https://gpen.innogamescdn.com/images/game/main/temple.png)",elementSelector:".city_overview_overlay.temple",currentLvlElSelector:'.city_overview_overlay.temple [class="twa_content js-content-area"] span:nth-of-type(3)',name:"Temple",buildAction:()=>o(".city_overview_overlay.temple .btn_build.build_button")}}},233:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=n(910),s=r(n(785)),a=n(15),l=r(n(77)),c=r(n(165)),u=n(147),d=r(n(254));class h{constructor(){this.allowUnsequentialBuilds=!1,this.allowCriticalBuilds=!0,this.observer=null,this.buildSchedule=null,this.speedUpSchedule=null,this.RUN=!1,this.queue=[]}static getInstance(){return h.instance||(h.instance=new h,h.instance.lock=s.default.getInstance(),h.instance.resourceManager=d.default.getInstance(),h.instance.loadQueueFromStorage(),h.instance.addStyle(),h.instance.renderUI()),h.instance}renderUI(){const e=document.createElement("div");e.innerHTML=c.default,document.body.appendChild(e),this.addBuildButtons(),this.initToggleButtonEvents()}initToggleButtonEvents(){document.getElementById(h.toggleBuilderButtonId).addEventListener("click",(()=>{const e=document.getElementById(h.buildContainerId);e.classList.toggle("hidden"),e.classList.contains("hidden")?this.tryExitBuildMode():this.tryGoToBuildMode()}))}writeToStorage(){localStorage.setItem("cityBuilderQueue",JSON.stringify(this.queue))}readFromStorage(){const e=localStorage.getItem("cityBuilderQueue");e&&(this.queue=JSON.parse(e))}addBuildButtons(){const e=document.getElementById(h.buildOptionsContainerId);Object.values(u.buildings).forEach((t=>{const n=document.createElement("div");n.className=h.buildOptionItemClass,n.style.backgroundImage=t.backgroundImageProp,e.appendChild(n);const i=document.createElement("div");i.className=h.buildOptionItemAddClass,i.innerHTML="+",n.appendChild(i),n.addEventListener("click",(()=>{this.onOptionBuildButtonClick(t)}))}))}tryGoToBuildMode(){return i(this,void 0,void 0,(function*(){var e;null===(e=document.querySelector('[name="city_overview"]'))||void 0===e||e.click();const t=yield(0,a.waitForElement)('[class="construction_queue_build_button"] div',2e3);t.classList.contains("active")||t.click()}))}tryExitBuildMode(){const e=document.querySelector('[class="construction_queue_build_button"] div');(null==e?void 0:e.classList.contains("active"))&&e.click()}onOptionBuildButtonClick(e){this.addToQueue(e)}addBuldingToUIQueue(e,t="end"){const n=document.getElementById("additional-queue"),i=document.createElement("div");i.className=h.queueItemClass,i.style.backgroundImage=e.building.backgroundImageProp,i.setAttribute("data-id",e.id),"start"===t?function(){throw new Error("Function not implemented.")}():n.appendChild(i);const r=document.createElement("div");r.className=h.upButtonClass,r.textContent=`+${e.toLvl}`,i.appendChild(r);const o=document.createElement("div");return o.className=h.cancelButtonClass,o.innerHTML="&#x2715;",i.appendChild(o),o.addEventListener("click",(()=>{const t=this.queue.findIndex((t=>t.id===e.id));-1!==t?(0===t?(this.queue.shift(),this.buildSchedule&&(clearInterval(this.buildSchedule),clearTimeout(this.buildSchedule),this.buildSchedule=null),this.revalidateQueueItemLevels(e.building,t),this.tryScheduleNextBuild()):(this.queue.splice(t,1),this.revalidateQueueItemLevels(e.building,t)),i.remove()):console.log("Item not found in queue")})),console.log("queueItemEl",i),i}revalidateQueueItemLevels(e,t){console.log("--------revalidateQueueItemLevels",e,t),this.queue.filter(((n,i)=>i>=t&&n.building.name===e.name)).forEach((e=>{const t=e.toLvl-1,n=`${e.building.name}-${t}`,i=document.querySelector(`[data-id="${e.id}"]`);i&&(i.querySelector(".up").textContent=`+${t}`,i.setAttribute("data-id",n)),e.toLvl=t,e.id=n}))}addToQueue(e){return i(this,void 0,void 0,(function*(){console.log("addToQueue",e),yield this.tryGoToBuildMode();const t=(yield(0,a.waitForElement)(`${e.elementSelector} ${u.buildingsSelectors.currentLvl}`)).textContent,n="max"!==t?Number(t):1/0;if(n===1/0)return;const i=this.queue.filter((t=>t.building.name===e.name)).length+1,r={id:`${e.name}-${n+i}`,building:e,toLvl:n+i};console.log("queueItem",r),this.addBuldingToUIQueue(r),this.queue.push(r),console.log("pushed to queue:",this.queue),this.tryAddToRealQueueOrSchedule()}))}tryAddToRealQueueOrSchedule(){if(console.log("tryAddToRealQueueOrSchedule",this.queue),1===this.queue.length)console.log("queue length is 1, performing build schedule"),this.performBuildSchedule();else if(this.allowUnsequentialBuilds){const e=this.queue[this.queue.length-1];this.tryAddToRealQueue(e)}else console.log("queue length is not 1, but unsequential builds are not allowed, another element waits for its turn")}tryAddToRealQueue(e){return i(this,void 0,void 0,(function*(){console.log("tryAddToRealQueue",e),(yield this.isEmptySlot())&&(yield this.canBuild(e.building))?(console.log("can build, adding to real queue"),yield e.building.buildAction(),this.clearUIQueueItem(e)):console.log("cannot build, waiting for the scheduler to take up this item and handle it")}))}performBuildSchedule(){return i(this,void 0,void 0,(function*(){if(!this.queue.length)return;const e=this.queue[0],t=e.building;console.log("performBuildSchedule, with item:",e),(yield this.isEmptySlot())?(console.log("\t-there is an empty slot, trying to build"),this.checkIfItemCanBeBuiltAndAddDeleteOrSchedule(t,e)):this.setTimeoutForNextSpeedUpAndSchedule()}))}setTimeoutForNextSpeedUpAndSchedule(){return i(this,void 0,void 0,(function*(){const e=yield this.getTimeToCanSpeedUp();e<=0?(console.log("\t-will speed up first build immediately"),yield this.speedUpFirstBuild(),this.performBuildSchedule()):(console.log("\t-speed up will be scheduled at:",(0,o.getTimeInFuture)(e)),this.buildSchedule=setTimeout((()=>i(this,void 0,void 0,(function*(){yield this.speedUpFirstBuild(),this.performBuildSchedule()}))),e))}))}trySpeedUpFirstBuildOrSchedule(){return i(this,void 0,void 0,(function*(){if(console.log("trySpeedUpFirstBuildOrSchedule"),this.speedUpSchedule)console.log("\t-but speedup is already scheduled, do nothing...");else{console.log("\t-speedUpSchedule does not exist, creating new one"),yield(0,o.addDelay)(1e3);const e=yield this.getTimeToCanSpeedUp();if(console.log("\t-timeToSpeedUp:",e),e<=0)console.log("\t-will speed up first build immediately"),yield this.speedUpFirstBuild(),yield(0,o.addDelay)(1e3);else{let t;console.log("\t-speed up will be scheduled");const n=new Promise((n=>i(this,void 0,void 0,(function*(){t=setTimeout((()=>i(this,void 0,void 0,(function*(){yield this.speedUpFirstBuild(),yield(0,o.addDelay)(1e3),n(),console.log("\t\t-speedUpFirstBuild finished, clearing speedUpSchedule"),this.speedUpSchedule=null}))),e)}))));this.speedUpSchedule={timeout:t,promise:n}}}}))}checkIfItemCanBeBuiltAndAddDeleteOrSchedule(e,t){return i(this,arguments,void 0,(function*(e,t,n=!1){console.log("check if can build item:",t);let r=yield this.canBuild(e);if(console.log("\t-canBuild:",r),!0===r)console.log("\t-canBuild is true, building..."),yield e.buildAction(),this.shiftQueueCleanScheduleAndTryNext(t);else if("maxed"===r)console.log("\t-canBuild is maxed, shifting queue"),n||this.shiftQueueCleanScheduleAndTryNext(t);else{const n=yield this.areResourcesStackable(e);if(!0===n)console.log("\t-areResourcesStackable is true, scheduling build"),this.buildSchedule=setInterval((()=>i(this,void 0,void 0,(function*(){!0===(yield this.canBuild(e))&&(console.log("\t\t-canBuild is true, building..."),yield e.buildAction(),this.shiftQueueCleanScheduleAndTryNext(t))}))),3e4);else if("population"===n&&this.allowCriticalBuilds){console.log("\t\t-areResourcesStackable is population, adding farm to queue");const t=u.buildings.farm,n=yield this.getBuildingCurrentLvl(t),i={id:`${t.name}-${n}`,building:e,toLvl:n+1};this.queue.unshift(i),this.addBuldingToUIQueue(i,"start"),this.performBuildSchedule()}else if("storage"===n&&this.allowCriticalBuilds){console.log("\t\t-areResourcesStackable is storage, adding storage to queue");const t=u.buildings.storage,n=yield this.getBuildingCurrentLvl(t),i={id:`${t.name}-${n}`,building:e,toLvl:n+1};this.queue.unshift(i),this.addBuldingToUIQueue(i,"start"),this.performBuildSchedule()}else"alreadyStacked"!==n||(yield this.isQueueEmpty())?(console.log("Item cannot be scheduled, because it has not met requirements"),this.shiftQueueCleanScheduleAndTryNext(t)):(console.log("\t\t-areResourcesStackable is alreadyStacked, scheduling build"),this.setTimeoutForNextSpeedUpAndSchedule())}}))}getBuildingCurrentLvl(e){return i(this,void 0,void 0,(function*(){const t=(yield(0,a.waitForElement)(`${e.elementSelector} ${u.buildingsSelectors.currentLvl}`)).textContent;return"max"!==t?Number(t):1/0}))}clearUIQueueItem(e){const t=document.querySelector(`[data-id="${e.id}"]`);t&&t.remove()}shiftQueueCleanScheduleAndTryNext(e){this.queue.shift(),this.buildSchedule&&(clearInterval(this.buildSchedule),clearTimeout(this.buildSchedule),this.buildSchedule=null),this.clearUIQueueItem(e),this.tryScheduleNextBuild()}tryScheduleNextBuild(){return i(this,void 0,void 0,(function*(){console.log("tryScheduleNextBuild, queue:",this.queue),this.queue.length>0&&(console.log("\t-queue is not empty, performing build schedule"),this.performBuildSchedule())}))}goToCityView(){const e=document.querySelector('[name="city_overview"]');(null==e?void 0:e.classList.contains("checked"))||null==e||e.click()}speedUpFirstBuild(){return i(this,void 0,void 0,(function*(){this.goToCityView();const e=yield(0,a.waitForElement)('[data-order_index="0"] .type_free',2e3).catch((()=>null));if(!e)throw new Error("No free button found");e.click()}))}getFirstElementInTheRealQueue(){return i(this,void 0,void 0,(function*(){return yield(0,a.waitForElement)('[data-order_index="0"]')}))}canBuild(e){return i(this,void 0,void 0,(function*(){yield this.tryGoToBuildMode();const t=yield(0,a.waitForElement)(`${e.elementSelector} ${u.buildingsSelectors.buildButton}`,2e3).catch((()=>null));return t?!t.classList.contains(u.buildingsSelectors.disabled):"maxed"}))}areResourcesStackable(e){return i(this,void 0,void 0,(function*(){console.log("areResourcesStackable"),yield this.tryGoToBuildMode();do{(0,a.triggerHover)(document.querySelector(`${e.elementSelector} ${u.buildingsSelectors.buildButton}`)),yield(0,o.addDelay)(333)}while(!document.querySelector('#popup_content img[src="https://gppl.innogamescdn.com/images/game/res/wood.png"]'));const t=Number((yield(0,a.waitForElement)('#popup_content img[src="https://gppl.innogamescdn.com/images/game/res/wood.png"]',3e3)).nextSibling.textContent),n=Number((yield(0,a.waitForElement)('#popup_content img[src="https://gppl.innogamescdn.com/images/game/res/stone.png"]',0)).nextSibling.textContent),i=Number((yield(0,a.waitForElement)('#popup_content img[src="https://gppl.innogamescdn.com/images/game/res/iron.png"]',0)).nextSibling.textContent),r=Number((yield(0,a.waitForElement)('#popup_content img[src="https://gppl.innogamescdn.com/images/game/res/pop.png"]',0)).nextSibling.textContent);(0,a.cancelHover)(document.querySelector(`${e.elementSelector} ${u.buildingsSelectors.buildButton}`));const s=yield this.resourceManager.getResourcesInfo();return console.log(`Resource requirements:\n      \t- Required population: ${r}\n      \t- Current population: ${this.resourceManager.getPopulation()}\n      \t- Store capacity: ${yield this.resourceManager.getStoreCapacity()}\n      \t- Required wood: ${t}\n      \t- Required stone: ${n}\n      \t- Required iron: ${i}`),console.log("Current resources:",s),r>s.population.amount?"population":[t,n,i].reduce(((e,t)=>t>e?t:e),0)>s.storeMaxSize?"storage":!(t<=s.wood.amount&&n<=s.stone.amount&&i<=s.iron.amount&&r<=s.population.amount)||"alreadyStacked"}))}addStyle(){const e=document.createElement("style");e.textContent=l.default,document.head.appendChild(e)}isEmptySlot(){return i(this,void 0,void 0,(function*(){return this.goToCityView(),yield(0,o.addDelay)(3e3),yield(0,a.waitForElement)(".construction_queue_order_container.instant_buy .js-queue-item.empty_slot",2e3).then((()=>!0)).catch((()=>!1))}))}getTimeToCanSpeedUp(){return i(this,void 0,void 0,(function*(){this.goToCityView(),yield(0,o.addDelay)(1e3);const e=yield(0,a.waitForElement)('[data-order_index="0"] .countdown.js-item-countdown',3e3).catch((()=>null));if(e)return(0,o.textToMs)(e.textContent)-3e5;throw new Error("No item in the queue.")}))}loadQueueFromStorage(){}isQueueEmpty(){return i(this,void 0,void 0,(function*(){return this.goToCityView(),new Promise((e=>setTimeout((()=>null!=e(document.querySelector(".empty_queue"))),0)))}))}start(){this.RUN=!0,document.getElementById(h.toggleBuilderButtonId).classList.remove("hidden")}stop(){console.log("Stopping"),this.RUN=!1,this.buildSchedule=null,document.getElementById(h.toggleBuilderButtonId).classList.add("hidden")}isRunning(){return this.RUN}}h.queueContainerId="additional-queue",h.queueItemClass="queue-item",h.cancelButtonClass="cancel",h.upButtonClass="up",h.buildOptionsContainerId="build-options",h.buildOptionItemClass="build-option",h.buildOptionItemAddClass="build-options-add",h.buildContainerId="build-container",h.toggleBuilderButtonId="toggle-builder",t.default=h},2:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const r=n(15);class o{constructor(){this.RUN=!1,this.cityList=[]}static getInstance(){return i(this,void 0,void 0,(function*(){return o.instance||(o.instance=new o,o.instance.cityList=yield o.instance.initCityList()),o.instance}))}initCityList(){return i(this,void 0,void 0,(function*(){(yield(0,r.waitForElement)(".caption.js-viewport")).click();const e=(yield(0,r.waitForElement)(".group_towns")).querySelectorAll("span.town_name"),t=Array.from(e).map((e=>{const t=e.parentElement.getAttribute("data-townid"),n=Array.from(document.querySelector(`#town_${t}`).classList).find((e=>e.match(/town_\d+_\d+_\d+/))).match(/town_(\d+_\d+)_\d+/)[1];return{name:e.textContent,cityId:t,isleId:n,switchAction:()=>i(this,void 0,void 0,(function*(){try{let t=yield(0,r.waitForElement)(".group_towns",500).catch((()=>null));t||(yield(0,r.waitForElement)(".caption.js-viewport")).click(),t=yield(0,r.waitForElement)(".group_towns",3e3);const n=Array.from(t.querySelectorAll("span.town_name")).find((t=>t.textContent===e.textContent));console.log("switchAction from element:",n),n.click()}catch(e){console.warn("switchAction.catch:",e)}}))}}));return console.log("CitySwitchManager.cityList.initialized:",t),t}))}getCurrentCity(){var e,t;const n=null!==(t=null===(e=document.querySelector("div.town_name"))||void 0===e?void 0:e.textContent)&&void 0!==t?t:"";return console.log("getCurrentCity.name:",n),this.getCityByName(n)}getCityByName(e){return console.log("getCityByName:",this.cityList.find((t=>t.name===e))),this.cityList.find((t=>t.name===e))}getCityList(){return this.cityList}isRunning(){return this.RUN}run(){this.RUN=!0}stop(){this.RUN=!1}}t.default=o},543:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(7)),s=n(773),a=r(n(639)),l=n(910),c=r(n(785)),u=n(15),d=r(n(2));class h extends o.default{constructor(){super(),this.schedulerArray=[],this.previousVillageSelectors=[],this.messageDialogObserver=null,this.RUN=!1,this.scheduleNextFarmingOperationForCity=(e,t)=>{const n={scheduledDate:new Date(Date.now()+e),timeout:null,city:t},r=setTimeout((()=>i(this,void 0,void 0,(function*(){yield t.switchAction(),yield(0,l.addDelay)(100),this.farmVillages(t),this.schedulerArray=this.schedulerArray.filter((e=>e!==n))}))),e);n.timeout=r,this.schedulerArray.push(n),console.log("scheduler:",this.schedulerArray)},this.mountMessageDailogObserver=()=>i(this,void 0,void 0,(function*(){const e=new MutationObserver((e=>i(this,void 0,void 0,(function*(){for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)if(e instanceof HTMLElement&&"window_curtain ui-front show_curtain is_modal_window"===e.getAttribute("class"))return yield(0,l.addDelay)(100),void e.querySelector(".btn_confirm.button_new").click()}))));e.observe(document.body,{childList:!0}),this.messageDialogObserver=e}))}static getInstance(){return i(this,void 0,void 0,(function*(){return h.instance||(h.instance=new h,h.instance.citySwitch=yield d.default.getInstance(),h.instance.configManager=a.default.getInstance(),h.instance.config=h.instance.configManager.getConfig().farmConfig,h.instance.lock=c.default.getInstance()),h.instance}))}start(){return i(this,void 0,void 0,(function*(){this.RUN||(console.log("FarmManager started"),this.RUN=!0,yield this.initFarmAllVillages())}))}farmVillages(e){return i(this,void 0,void 0,(function*(){var t;try{this.lock.acquire(),yield this.farmVillagesFlow(e)}catch(e){console.warn("FarmManager.farmVillages().catch",e)}finally{this.lock.release(),null===(t=this.messageDialogObserver)||void 0===t||t.disconnect(),this.emit("farmingFinished")}}))}farmVillagesFlow(e){return i(this,void 0,void 0,(function*(){(0,l.isMobile)()&&(yield(0,u.waitForElement)('[name="island_view"]').then((e=>null==e?void 0:e.click())),yield(0,l.addDelay)(333));const t=yield(0,u.waitForElements)('a.owned.farm_town[data-same_island="true"]');if(!t||0===t.length)return;const n=Array.from(t).map((e=>`[style="${e.getAttribute("style")}"]`));yield(0,u.performComplexClick)(t[0]);const i=yield this.getUnlockTimeOrNull(yield(0,u.waitForElement)(".farm_towns"));if(i)return yield(0,u.waitForElement)(".btn_wnd.close",1e3).then((e=>e.click())).catch((()=>{})),void this.scheduleNextFarmingOperationForCity(i,e);this.mountMessageDailogObserver();for(const e of n){let t=null,n=null;do{t=yield(0,u.waitForElement)(e),yield(0,u.performComplexClick)(t),yield(0,l.addDelay)(100)}while(!(n=yield(0,u.waitForElements)(".action_card.resources_bpv .card_click_area",333).catch((()=>null))));n[this.getFarmOptionIndex(n.length)].click();const i=yield(0,u.waitForElement)(".btn_wnd.close",1e3).catch((()=>{}));if(null==i||i.click(),!this.RUN)return;yield(0,l.addDelay)(100)}this.scheduleNextFarmingOperationForCity(this.config.farmInterval,e)}))}initFarmAllVillages(){return i(this,void 0,void 0,(function*(){var e;const t=this.citySwitch.getCityList().reduce(((e,t)=>(e.some((e=>e.isleId===t.isleId))||e.push(t),e)),[]);try{this.lock.acquire();for(const e of t)yield e.switchAction(),yield(0,l.addDelay)(100),yield this.farmVillagesFlow(e);1!==t.length&&t[0].switchAction()}catch(e){console.warn("FarmManager.farmVillages().catch",e)}finally{this.lock.release(),null===(e=this.messageDialogObserver)||void 0===e||e.disconnect(),this.emit("farmingFinished")}}))}getUnlockTimeOrNull(e){return i(this,void 0,void 0,(function*(){const t=yield(0,u.waitForElementFromNode)(e,".actions_locked_banner.cooldown",500).catch((()=>null));if(t){const e=t.querySelector(".pb_bpv_unlock_time");return new Promise(((t,n)=>{const i=setInterval((()=>{(null==e?void 0:e.textContent)&&(clearInterval(i),t((0,l.textToMs)(e.textContent)))}),100)}))}return null}))}getFarmOptionIndex(e){if(4===e)switch(this.config.farmInterval){case s.FarmTimeInterval.FiveMinutes:return 0;case s.FarmTimeInterval.TwentyMinutes:return 1;case s.FarmTimeInterval.OneHourAndHalf:return 2;case s.FarmTimeInterval.FourHours:return 3;default:return 0}else switch(this.config.farmInterval){case s.FarmTimeInterval.FiveMinutes:return 0;case s.FarmTimeInterval.TenMinutes:return 4;case s.FarmTimeInterval.TwentyMinutes:return 1;case s.FarmTimeInterval.FortyMinutes:return 5;case s.FarmTimeInterval.OneHourAndHalf:return 2;case s.FarmTimeInterval.ThreeHours:return 6;case s.FarmTimeInterval.FourHours:return 3;case s.FarmTimeInterval.EightHours:return 7;default:return 0}}stop(){this.RUN=!1,console.log("FarmManager stopped"),this.schedulerArray.forEach((e=>{clearTimeout(e.timeout)})),this.schedulerArray=[]}isRunning(){return this.RUN}}t.default=h},299:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(278)),s=r(n(233)),a=r(n(2)),l=r(n(543)),c=r(n(567));class u{constructor(){this.pausedManagersSnapshot={farmManager:!1,switchManager:!1,scheduler:!1,builder:!1}}static getInstance(){return i(this,void 0,void 0,(function*(){return u.instance||(u.instance=new u,u.instance.farmManager=yield l.default.getInstance(),u.instance.switchManager=yield a.default.getInstance(),u.instance.scheduler=yield c.default.getInstance(),u.instance.builder=s.default.getInstance(),u.instance.initConfigDialog()),u.instance}))}runManagersFromConfig(){return i(this,void 0,void 0,(function*(){this.configMenuWindow.isSwitchChecked()?this.switchManager.isRunning()||(console.log("switchManager will be started..."),this.switchManager.run()):this.switchManager.isRunning()&&(console.log("switchManager will be stopped..."),this.switchManager.stop()),this.configMenuWindow.isFarmChecked()?this.farmManager.isRunning()||(console.log("FarmManager will be started..."),yield this.farmManager.start()):this.farmManager.isRunning()&&(console.log("FarmManager will be stopped..."),this.farmManager.stop()),this.configMenuWindow.isBuilderChecked()?this.builder.isRunning()||(console.log("Builder will be started..."),this.builder.start()):this.builder.isRunning()&&(console.log("Builder will be stopped..."),this.builder.stop())}))}initConfigDialog(){return i(this,void 0,void 0,(function*(){this.configMenuWindow=new o.default,this.configMenuWindow.addListener("managersChange",(()=>i(this,void 0,void 0,(function*(){yield this.runManagersFromConfig()})))),this.configMenuWindow.render()}))}run(){this.runManagersFromConfig()}pauseRunningManagers(e){e.includes("farmManager")||this.farmManager.stop(),e.includes("switchManager")||this.switchManager.stop(),e.includes("scheduler")||this.scheduler.stop(),e.includes("builder")||this.builder.stop(),this.pausedManagersSnapshot={farmManager:!this.farmManager.isRunning(),switchManager:!this.switchManager.isRunning(),scheduler:!this.scheduler.isRunning(),builder:!this.builder.isRunning()},console.log("pauseRunningManagers",this.pausedManagersSnapshot)}resumeRunningManagers(e){Object.entries(this.pausedManagersSnapshot).forEach((([t,n])=>{switch(t){case"farmManager":n&&!e.includes("farmManager")&&this.farmManager.start();break;case"switchManager":n&&!e.includes("switchManager")&&this.switchManager.run();break;case"scheduler":n&&!e.includes("scheduler")&&this.scheduler.run();break;case"builder":n&&!e.includes("builder")&&this.builder.start()}})),Object.keys(this.pausedManagersSnapshot).forEach((t=>{e.includes(t)&&(this.pausedManagersSnapshot[t]=!1)}))}stopAll(){this.farmManager.stop(),this.switchManager.stop(),this.scheduler.stop(),this.builder.stop()}}t.default=u},254:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(639)),s=n(910),a=n(15);class l{constructor(){var e,t,n,i,r,s;this.configManager=o.default.getInstance(),this.minPopulationBuffer=null!==(n=null===(t=null===(e=this.configManager.getConfig())||void 0===e?void 0:e.resources)||void 0===t?void 0:t.minPopulationBuffer)&&void 0!==n?n:100,this.storeAlmostFullPercentage=null!==(s=null===(r=null===(i=this.configManager.getConfig())||void 0===i?void 0:i.resources)||void 0===r?void 0:r.storeAlmostFullPercentage)&&void 0!==s?s:.9}static getInstance(){return l.instance||(l.instance=new l),this.instance}start(){return i(this,void 0,void 0,(function*(){}))}stop(){}getStoreCapacity(){return i(this,void 0,void 0,(function*(){var e,t;(0,a.triggerHover)(document.querySelector('[data-type="wood"] .amount.ui-game-selectable'));const n=yield(0,a.waitForElement)(".island_resource_info span:nth-of-type(2)"),i=parseInt((null===(t=null===(e=null==n?void 0:n.textContent)||void 0===e?void 0:e.match(/\d+/))||void 0===t?void 0:t[0])||"0");return(0,a.cancelHover)(document.querySelector('[data-type="wood"] .amount.ui-game-selectable')),i}))}getPopulation(){return Number(document.querySelector('[data-type="population"] .amount.ui-game-selectable').textContent)}getResourcesInfo(){return i(this,void 0,void 0,(function*(){var e;const t=Number((yield(0,a.waitForElement)('[data-type="wood"] .amount.ui-game-selectable')).textContent),n=Number((yield(0,a.waitForElement)('[data-type="stone"] .amount.ui-game-selectable')).textContent),i=Number((yield(0,a.waitForElement)('[data-type="iron"] .amount.ui-game-selectable')).textContent),r=Number((yield(0,a.waitForElement)('[data-type="population"] .amount.ui-game-selectable')).textContent),o=yield(0,a.waitForElement)('[data-type="wood"] .amount.ui-game-selectable');let l=null;do{(0,a.triggerHover)(o),yield(0,s.addDelay)(333)}while(!(l=document.querySelector(".island_resource_info span:nth-of-type(2)")));const c=l.textContent,u=parseInt((null===(e=null==c?void 0:c.match(/\d+/))||void 0===e?void 0:e[0])||"0");return(0,a.cancelHover)(o),{wood:{amount:t,isAlmostFull:t>this.storeAlmostFullPercentage*u,isFull:t===u},stone:{amount:n,isAlmostFull:n>this.storeAlmostFullPercentage*u,isFull:n===u},iron:{amount:i,isAlmostFull:i>this.storeAlmostFullPercentage*u,isFull:i===u},population:{amount:r,isLow:r<this.minPopulationBuffer},storeMaxSize:u}}))}hasEnoughResources(e){const t=Number(document.querySelector('[data-type="wood"] .amount.ui-game-selectable').textContent),n=Number(document.querySelector('[data-type="stone"] .amount.ui-game-selectable').textContent),i=Number(document.querySelector('[data-type="iron"] .amount.ui-game-selectable').textContent);return t>=e.wood&&n>=e.stone&&i>=e.iron}}t.default=l},567:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(n(639)),s=n(910),a=r(n(785)),l=n(15),c=r(n(641)),u=r(n(2)),d=r(n(299)),h=r(n(813)),m=r(n(846)),g=r(n(218));var p;!function(e){e[e.ARMY_ATTACK=0]="ARMY_ATTACK",e[e.ARMY_SUPPORT=1]="ARMY_SUPPORT",e[e.ARMY_WITHDRAW=2]="ARMY_WITHDRAW",e[e.RESOURCE_SHIPMENT=3]="RESOURCE_SHIPMENT"}(p||(p={}));class f{constructor(){this.isLockTakenByScheduler=!1,this.scheduler=[],this._error=null,this._hydrationError=null,this._info=null,this.RUN=!0}privateconstructor(){}static getInstance(){return i(this,void 0,void 0,(function*(){return f.instance||(f.instance=new f,f.instance.lock=a.default.getInstance(),f.instance.armyMovement=c.default.getInstance(),f.instance.masterManager=yield d.default.getInstance(),f.instance.citySwitchManager=yield u.default.getInstance(),f.instance.config=o.default.getInstance().getConfig(),f.instance.addUIExtenstion(),f.instance.addSchedulerListConfigWindow(),f.instance.synchronizeSchedulerWithStorage()),f.instance}))}addUIExtenstion(){return i(this,void 0,void 0,(function*(){yield this.mountCityDialogObserver()}))}run(){return i(this,void 0,void 0,(function*(){this.RUN=!0}))}stop(){return i(this,void 0,void 0,(function*(){this.RUN=!1}))}isRunning(){return this.RUN}undoArmyMovement(e,t){return i(this,void 0,void 0,(function*(){var n;yield e.switchAction(),yield(0,s.addDelay)(100);const i=document.querySelector("#toolbar_activity_commands");(0,l.triggerHover)(i),null===(n=document.querySelector(`#${t}`))||void 0===n||n.click()}))}extendAttackSupportUI(e){return i(this,void 0,void 0,(function*(){const t=e.querySelector(".button_wrapper"),n=document.createElement("div");n.innerHTML=h.default,t.appendChild(n);const r=document.querySelector("#schedule-date");r.value=this.getFormattedInputValueFromDate(new Date),n.querySelector("#schedule-button").addEventListener("click",(()=>i(this,void 0,void 0,(function*(){this.error=null;const t=e.querySelector(".way_duration").textContent.slice(1),n=(0,s.textToMs)(t),o=Array.from(e.querySelectorAll(".unit_input")).map((e=>({name:e.getAttribute("name"),value:e.value}))),a="attack"===e.firstElementChild.getAttribute("data-type")?p.ARMY_ATTACK:p.ARMY_SUPPORT,c=r.value,u=document.querySelector("#schedule-time").value,d=this.getDateFromDateTimeInputValues(c,u),h=new Date(d.getTime()-n),m=this.citySwitchManager.getCurrentCity(),g="#town_"+Array.from(e.classList).find((e=>e.match(/attack_support_tab_target_\d+/))).match(/\d+/)[0];if(!this.canAddSchedulerItem(h))return console.warn("unsafe operation, failed to be scheudled"),void(this.error="Schedule failed. Cannot safely schedule operation.");if(!o.some((e=>e.value)))return void(this.error="Schedule failed. All units are empty.");const v={timeout30s:null,timeout10s:null,timeoutAction:null},y={operationType:a,targetDate:d,actionDate:h,sourceCity:m,targetCityIdSelector:g,data:o,timeoutStructure:v,movementId:null,undoMovementAction:null,cancelSchedule:()=>{v.timeout30s&&clearTimeout(v.timeout30s),v.timeout10s&&clearTimeout(v.timeout10s),v.timeoutAction&&clearTimeout(v.timeoutAction),this.isLockTakenByScheduler&&(this.lock.release(),this.isLockTakenByScheduler=!1),this.scheduler=this.scheduler.filter((e=>e!==y)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.tryRestoreManagers()},postActionCleanup:()=>{setTimeout((()=>{this.scheduler=this.scheduler.filter((e=>e!==y)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler))}),0),this.isLockTakenByScheduler&&this.lock.release(),this.isLockTakenByScheduler=!1,this.tryRestoreManagers()}},b=h.getTime()-(new Date).getTime()-f.TURN_OFF_MANAGERS_TIME_MS;v.timeout30s=setTimeout((()=>{this.masterManager.pauseRunningManagers(["scheduler"]);const e=h.getTime()-(new Date).getTime()-1e4;v.timeout10s=setTimeout((()=>i(this,void 0,void 0,(function*(){var e;try{yield this.lock.acquire(),this.isLockTakenByScheduler=!0,null===(e=document.querySelector(".ui-dialog-titlebar-close"))||void 0===e||e.click(),(0,l.performComplexClick)(yield(0,l.waitForElement)(g)),a===p.ARMY_ATTACK?(yield(0,l.waitForElement)("#attack")).click():(yield(0,l.waitForElement)("#support")).click();for(const e of o){const t=yield(0,l.waitForElement)(`input[name="${e.name}"]`);(0,l.setInputValue)(t,e.value)}}catch(e){return console.error("Error during 10 seconds before action:",e),this.error="Schedule failed. Check console for more details.",void y.cancelSchedule()}v.timeoutAction=setTimeout((()=>i(this,void 0,void 0,(function*(){var e;try{a===p.ARMY_ATTACK?(yield(0,l.waitForElement)("#btn_attack_town")).click():(yield(0,l.waitForElement)(".attack_support_window a .middle")).click(),this.armyMovement.setCallback((e=>{y.movementId=e,y.undoMovementAction=()=>this.undoArmyMovement(y.sourceCity,e)})),null===(e=document.querySelector(".ui-dialog-titlebar-close"))||void 0===e||e.click(),this.error=null}catch(e){console.error("Error during action:",e),this.error="Schedule failed. Check console for more details."}finally{y.postActionCleanup()}}))),h.getTime()-(new Date).getTime())}))),e)}),b),this.scheduler.push(y),this.addSchedulerItemToUI(y),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.info="Operation scheduled",console.log("Scheduler.extendAttackSupportUI.schedulerItem",y)}))))}))}synchronizeSchedulerWithStorage(){JSON.parse(localStorage.getItem("scheduler")||"[]").forEach((e=>this.hydrateSchedulerItem(e))),this.handleIfSchedulerListIsEmpty()}hydrateSchedulerItem(e){if(e.operationType===p.ARMY_ATTACK||e.operationType===p.ARMY_SUPPORT){if(e.actionDate=new Date(e.actionDate),e.targetDate=new Date(e.targetDate),e.sourceCity=this.citySwitchManager.getCityByName(e.sourceCity.name),!this.canAddSchedulerItem(e.actionDate))return console.warn("unsafe operation, failed to be scheudled during hydration"),void(this.hydrationError=`${e.sourceCity.name} ${e.operationType===p.ARMY_ATTACK?"attack":"support"} operation  at '${e.targetDate}' on city "${e.targetCityIdSelector}" failed to be scheduled during hydration.`);e.cancelSchedule=()=>{e.timeoutStructure.timeout30s&&clearTimeout(e.timeoutStructure.timeout30s),e.timeoutStructure.timeout10s&&clearTimeout(e.timeoutStructure.timeout10s),e.timeoutStructure.timeoutAction&&clearTimeout(e.timeoutStructure.timeoutAction),this.isLockTakenByScheduler&&this.lock.release(),this.isLockTakenByScheduler=!1,this.scheduler=this.scheduler.filter((t=>t!==e)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.tryRestoreManagers()},e.postActionCleanup=()=>{setTimeout((()=>{this.scheduler=this.scheduler.filter((t=>t!==e)),localStorage.setItem("scheduler",JSON.stringify(this.scheduler)),this.removeSchedulerItemFromUI(e),this.handleIfSchedulerListIsEmpty()}),0),this.isLockTakenByScheduler&&this.lock.release(),this.isLockTakenByScheduler=!1,this.tryRestoreManagers()};const t=e.actionDate.getTime()-(new Date).getTime()-f.TURN_OFF_MANAGERS_TIME_MS;e.timeoutStructure.timeout30s=setTimeout((()=>{this.masterManager.pauseRunningManagers(["scheduler"]);const t=e.actionDate.getTime()-(new Date).getTime()-1e4;e.timeoutStructure.timeout10s=setTimeout((()=>i(this,void 0,void 0,(function*(){var t;try{yield this.lock.acquire(),this.isLockTakenByScheduler=!0,null===(t=document.querySelector(".ui-dialog-titlebar-close"))||void 0===t||t.click(),(0,l.performComplexClick)(yield(0,l.waitForElement)(e.targetCityIdSelector)),e.operationType===p.ARMY_ATTACK?(yield(0,l.waitForElement)("#attack")).click():(yield(0,l.waitForElement)("#support")).click();for(const t of e.data){const e=yield(0,l.waitForElement)(`input[name="${t.name}"]`);(0,l.setInputValue)(e,t.value)}}catch(t){return console.error("Error during 10 seconds before action:",t),this.error="Schedule failed. Check console for more details.",void e.cancelSchedule()}e.timeoutStructure.timeoutAction=setTimeout((()=>i(this,void 0,void 0,(function*(){var t;try{e.operationType===p.ARMY_ATTACK?(yield(0,l.waitForElement)("#btn_attack_town")).click():(yield(0,l.waitForElement)(".attack_support_window a .middle")).click(),this.armyMovement.setCallback((t=>{e.movementId=t,e.undoMovementAction=()=>this.undoArmyMovement(e.sourceCity,t)})),null===(t=document.querySelector(".ui-dialog-titlebar-close"))||void 0===t||t.click(),this.error=null}catch(e){console.error("Error during action:",e),this.error="Schedule failed. Check console for more details."}finally{e.postActionCleanup()}}))),e.actionDate.getTime()-(new Date).getTime())}))),t)}),t),this.scheduler.push(e),this.addSchedulerItemToUI(e),console.log("Scheduler.hydrateSchedulerItem.item",e)}}set error(e){const t=document.querySelector("#schedule-error");e?t&&(t.textContent=e):t&&(t.textContent=""),this._error=e}set hydrationError(e){this._hydrationError=e}set info(e){const t=document.querySelector("#schedule-info");e?t&&(t.textContent=e,setTimeout((()=>{t.textContent=""}),4e3)):t&&(t.textContent=""),this._info=e}canAddSchedulerItem(e){return e.getTime()-(new Date).getTime()>1e4&&(0===this.scheduler.length||!this.scheduler.some((t=>Math.abs(t.actionDate.getTime()-e.getTime())<1e4?(console.log("Interlacing times:",t.actionDate,e),console.log("\t:",t.actionDate.getTime()-e.getTime(),(t.actionDate.getTime()-e.getTime())/1e3),!0):(console.log("Not interlacing times:",t.actionDate,e),!1))))}tryRestoreManagers(){if(0===this.scheduler.length)console.log("RESTORE MANAGERS"),this.masterManager.resumeRunningManagers(["scheduler"]);else{const e=new Date,t=this.scheduler.reduce(((t,n)=>n.actionDate<e||t&&t<n.actionDate?t:n.actionDate),null);if(t)return void(t.getTime()-(new Date).getTime()>6e4?(console.log("RESTORE MANAGERS"),this.masterManager.resumeRunningManagers(["scheduler"])):console.log("DO NOT RESTORE MANAGERS"));this.masterManager.resumeRunningManagers(["scheduler"])}}getDateFromDateTimeInputValues(e,t){const n=t.match(/(\d{2})\D*(\d{2})\D*(\d{2})/);if(!n||!e.match(/^\d{4}-\d{2}-\d{2}$/))throw new Error("Invalid time format");const[,i,r,o]=n;return new Date(`${e}T${i}:${r}:${o}`)}getFormattedInputValueFromDate(e){return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}mountAttackSupportSubpageObserver(e){const t=new MutationObserver((e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)if(e.nodeType===Node.ELEMENT_NODE&&e.classList.contains("attack_support_window"))return void this.extendAttackSupportUI(e)}));return t.observe(e,{childList:!0,subtree:!0}),()=>t.disconnect()}mountCityDialogObserver(){return i(this,void 0,void 0,(function*(){let e=null;new MutationObserver((t=>{for(const n of t)if("childList"===n.type){for(const t of n.addedNodes)if(t.nodeType===Node.ELEMENT_NODE&&"ui-dialog ui-corner-all ui-widget ui-widget-content ui-front ui-draggable ui-resizable js-window-main-container"===t.getAttribute("class"))return void(e=this.mountAttackSupportSubpageObserver(t));for(const t of n.removedNodes)if(t.nodeType===Node.ELEMENT_NODE&&"dialog"===t.getAttribute("role")&&t.classList.contains("ui-dialog")&&t.classList.contains("js-window-main-container")&&e)return e(),void(e=null)}})).observe(document.body,{childList:!0})}))}addSchedulerListConfigWindow(){const e=document.createElement("style");e.textContent=g.default,document.head.appendChild(e);const t=document.createElement("div");t.innerHTML=m.default,document.body.appendChild(t),this.addSchedulerListConfigListeners()}addSchedulerListConfigListeners(){const e=document.querySelector("#scheduler-toggle-button");null==e||e.addEventListener("click",(()=>{const e=document.querySelector("#table-container");null==e||e.classList.toggle("hidden")}))}addSchedulerItemToUI(e){const t=document.querySelector("#scheduler-lookup-table tbody").insertRow(),n=this.getSchedulerItemId(e);t.setAttribute("data-scheduler-item-id",n);const i=t.insertCell();i.textContent=e.operationType===p.ARMY_ATTACK?"Attack":"Support",i.classList.add(e.operationType===p.ARMY_ATTACK?"attack":"support"),t.insertCell().textContent=e.sourceCity.name,t.insertCell().textContent=e.targetCityIdSelector,t.insertCell().textContent=e.actionDate.toLocaleTimeString(),t.insertCell().textContent=e.targetDate.toLocaleTimeString();const r=t.insertCell(),o=document.createElement("button");o.classList.add("cancel-button"),o.textContent="Cancel",o.addEventListener("click",(()=>{e.cancelSchedule(),this.removeSchedulerItemFromUI(e)})),r.appendChild(o),this.handleIfSchedulerListIsEmpty()}removeSchedulerItemFromUI(e){document.querySelector("#scheduler-lookup-table tbody").querySelector(`[data-scheduler-item-id="${this.getSchedulerItemId(e)}"]`).remove(),this.handleIfSchedulerListIsEmpty()}getSchedulerItemId(e){return e.operationType+e.sourceCity.name+e.targetCityIdSelector+e.targetDate.getTime()+e.actionDate.getTime()}handleIfSchedulerListIsEmpty(){const e=document.querySelector("#no-schedules");0===this.scheduler.length?e.classList.remove("hidden"):e.classList.add("hidden")}}f.MIN_PRECEDENCE_TIME_MS=1e4,f.TURN_OFF_MANAGERS_TIME_MS=3e4,f.PREPARATION_TIME_MS=1e4,t.default=f},278:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(604)),o=i(n(396)),s=i(n(7)),a=i(n(639)),l=n(773);class c extends s.default{constructor(){super(),this.isSwitchChecked=()=>this.switch,this.isFarmChecked=()=>this.farm,this.isBuilderChecked=()=>this.builder,this.isGuardChecked=()=>this.guard,this.getPlunderConfig=()=>{},this.getManagersFlags=()=>({farm:this.farm,builder:this.builder,guard:this.guard}),this.configManager=a.default.getInstance(),this.config=this.configManager.getConfig(),this.switch=!0,this.farm=!0,this.builder=!0,this.guard=!1,this.farmInterval=this.config.farmConfig.farmInterval}initEventListeners(){var e;const t=document.querySelector("#config-popup-container"),n=t.querySelector("#city-switch"),i=t.querySelector("#farm"),r=t.querySelector("#builder"),o=t.querySelector("#guard"),s=t.querySelector("#time-interval-select"),a=t.querySelector(".show-trigger"),l=t.querySelector("#close-popup");if(!t)throw new Error('"#config-popup-container" couldn\'t be found.');l.addEventListener("click",(()=>{t.classList.contains("minimized")||t.classList.add("minimized")})),t.querySelectorAll("#button-panel button").forEach((e=>e.addEventListener("click",(()=>{"reset"===e.type&&(n.checked=!1,this.switch=!1,i.checked=!1,this.farm=!1,r.checked=!1,this.builder=!1,o.checked=!1,this.guard=!1),this.config.farmConfig.farmInterval!==this.farmInterval&&(this.config.farmConfig.farmInterval=this.farmInterval,this.configManager.persistConfig()),t.classList.add("minimized"),this.emit("managersChange")})))),a.addEventListener("click",(()=>{t.classList.contains("minimized")&&t.classList.remove("minimized")})),n.addEventListener("change",(()=>{this.switch=n.checked})),i.addEventListener("change",(()=>{this.farm=i.checked})),r.addEventListener("change",(()=>{this.builder=r.checked})),o.addEventListener("change",(()=>{this.guard=o.checked})),s.addEventListener("change",(()=>{this.farmInterval=Number(s.value)}));const c=null===(e=t.querySelector("#farm"))||void 0===e?void 0:e.parentElement,u=c.querySelector(".expandable-section"),d=c.querySelector(".arrow-down");d.addEventListener("click",(()=>{u.classList.toggle("hidden"),d.classList.toggle("rotate")}))}createInitialElement(){const e=document.createElement("div");e.innerHTML=o.default,e.querySelector("#city-switch").checked=this.switch,e.querySelector("#farm").checked=this.farm,e.querySelector("#builder").checked=this.builder,e.querySelector("#guard").checked=this.guard;const t=e.querySelector("#time-interval-select"),n=Object.values(l.FarmTimeInterval);return n.slice(n.length/2,-1).forEach((e=>{const n=document.createElement("option");n.value=e.toString(),n.textContent=this.mapTimeIntervalKeyToText(e),t.appendChild(n)})),e.querySelector("#time-interval-select").value=l.FarmTimeInterval.FiveMinutes.toString(),e}mapTimeIntervalKeyToText(e){switch(e){case l.FarmTimeInterval.FiveMinutes:return"5m";case l.FarmTimeInterval.TenMinutes:return"10m";case l.FarmTimeInterval.TwentyMinutes:return"20m";case l.FarmTimeInterval.FortyMinutes:return"40m";case l.FarmTimeInterval.OneHourAndHalf:return"1h 30m";case l.FarmTimeInterval.ThreeHours:return"3h";case l.FarmTimeInterval.FourHours:return"4h";case l.FarmTimeInterval.EightHours:return"8h";default:return"Unknown interval"}}addStyle(){const e=document.createElement("style");e.textContent=r.default,document.head.appendChild(e)}render(){this.addStyle();const e=this.createInitialElement();document.body.appendChild(e),this.initEventListeners()}}t.default=c},639:function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(n(773)),o=i(n(16));class s{constructor(){}static getInstance(){return s.instance||(s.instance=new s,s.instance.storageManager=o.default.getInstance(),s.instance.config=s.instance.initConfig()),s.instance}initConfig(){return this.storageManager.readFromLocalStorage("config")||(this.storageManager.writeToLocalStorage("config",r.default),r.default)}getConfig(){return this.config}persistConfig(){this.storageManager.writeToLocalStorage("config",this.config)}getConfigValue(e){return this.config[e]}}t.default=s},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.areGridsEqual=t.msToTimeString=t.formatDateToSimpleString=t.getTimeInFuture=t.addDelay=t.isVisible=t.textToMs=void 0,t.getRandomInt=function(e){return Math.floor(Math.random()*e)},t.areArraysContentsEqual=function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0},t.isMobile=function(){return navigator.userAgentData?navigator.userAgentData.mobile:!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/Android/i))},t.textToMs=e=>{const t=e.split(":").map((e=>parseInt(e)));return 1e3*t[0]*60*60+1e3*t[1]*60+1e3*t[2]},t.isVisible=e=>e.offsetParent,t.addDelay=(e=1e3)=>new Promise((t=>setTimeout(t,e))),t.getTimeInFuture=e=>{const t=new Date,n=new Date(t.getTime()+e);return`${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}:${n.getSeconds().toString().padStart(2,"0")}`},t.formatDateToSimpleString=e=>`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}`,t.msToTimeString=e=>{const t=Math.floor(e/36e5),n=Math.floor(e%36e5/6e4),i=Math.floor(e%6e4/1e3);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${i.toString().padStart(2,"0")}`},t.areGridsEqual=(e,t)=>e[0]===t[0]&&e[1]===t[1]},16:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){}static getInstance(){return n.instance||(n.instance=new n),n.instance}readFromLocalStorage(e){const t=localStorage.getItem(e);return t?JSON.parse(t):null}writeToLocalStorage(e,t){localStorage.setItem(e,JSON.stringify(t))}}t.default=n},785:function(e,t){var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this.isLocked=!1,this.queue=[]}static getInstance(){return this.instance||(this.instance=new i),this.instance}acquire(){return n(this,void 0,void 0,(function*(){if(console.log("try acquiring"),!this.isLocked)return console.log("\tlock is free, acquire Lock"),void(this.isLocked=!0);console.log("\tlock is locked, add to queue"),yield new Promise((e=>{this.queue.push(e)}))}))}release(){if(console.log("release lock()"),this.queue.length>0){const e=this.queue.shift();e&&(console.log("- but next element in the queue takes it turn"),e())}else this.isLocked=!1,console.log("lock released ()")}}i.instance=null,t.default=i},15:function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.cancelHover=t.triggerHover=void 0,t.simulateClick=function(e){if(e){const t=e.getBoundingClientRect(),n=new MouseEvent("click",{clientX:t.left+t.width/2,clientY:t.top+t.height/2,bubbles:!0,cancelable:!0,view:window});e.dispatchEvent(n)}},t.setInputValue=function(e,t){if(e&&"INPUT"===e.tagName){e.value="number"==typeof t?t.toString():t;const n=new Event("input",{bubbles:!0});e.dispatchEvent(n);const i=new Event("change",{bubbles:!0});e.dispatchEvent(i)}else console.warn(`setInputValue(${e.name}) unsuccessful`)},t.waitForElements=function(e,t=8e3){return new Promise(((n,i)=>{const r=document.querySelectorAll(e);if(r.length>0)n(r);else{let r=setTimeout((()=>{o.disconnect(),i(`waitForElements(${e}) - not found within timeout`)}),t);const o=new MutationObserver((()=>{const t=document.querySelectorAll(e);t.length>0&&(o.disconnect(),clearTimeout(r),n(t))}));o.observe(document.body,{childList:!0,subtree:!0})}}))},t.waitForElement=function(e,t=8e3){return new Promise(((n,i)=>{const r=document.querySelector(e);if(r)return n(r);{const r=setTimeout((()=>{o.disconnect(),i(`${e} - not found within timeout`)}),t),o=new MutationObserver((()=>{const t=document.querySelector(e);t&&(o.disconnect(),clearTimeout(r),n(t))}));o.observe(document.body,{childList:!0,subtree:!0})}}))},t.waitForElementFromNode=function(e,t,n=8e3){return new Promise(((i,r)=>{const o=e.querySelector(t);if(o)return i(o);{const o=setTimeout((()=>{s.disconnect(),r(`${t} - not found within timeout`)}),n),s=new MutationObserver((()=>{const n=e.querySelector(t);n&&(s.disconnect(),clearTimeout(o),i(n))}));s.observe(e instanceof Document?e.body:e,{childList:!0,subtree:!0})}}))},t.onPageLoad=function(e){const t=()=>{const t=setTimeout((()=>{clearTimeout(t),setTimeout(e,2e3)}),500)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t()},t.mouseDownEvent=o,t.performComplexClick=function(e){return i(this,void 0,void 0,(function*(){o(e),yield(0,r.addDelay)(100),s(e)}))},t.mouseUpEvent=s;const r=n(910);function o(e){const t=new MouseEvent("mousedown",{bubbles:!0,cancelable:!0,view:window});e&&e.dispatchEvent(t)}function s(e){const t=new MouseEvent("mouseup",{bubbles:!0,cancelable:!0,view:window});e?e.dispatchEvent(t):console.warn(`mouseUpEvent() - ${e} not found`)}t.triggerHover=e=>{e&&e.dispatchEvent(new Event("mouseover",{bubbles:!0,cancelable:!0}))},t.cancelHover=e=>{e&&e.dispatchEvent(new Event("mouseout",{bubbles:!0,cancelable:!0}))}}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(927)})();
//# sourceMappingURL=bundle.js.map