{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack://gps/./node_modules/events/events.js","webpack://gps/./src/config-popup/config-popup.css","webpack://gps/./src/config-popup/config-popup.html","webpack://gps/./src/service/city/builder/builder-prod.html","webpack://gps/./src/service/city/builder/queue.css","webpack://gps/./src/service/master/ui/general-info.css","webpack://gps/./src/service/master/ui/info-template.html","webpack://gps/./src/service/scheduler/button-panel-extension.html","webpack://gps/./src/service/scheduler/scheduler-list-prod.html","webpack://gps/./src/service/scheduler/scheduler-list.css","webpack://gps/./gps.config.ts","webpack://gps/./src/config-popup/config-popup.ts","webpack://gps/./src/main.ts","webpack://gps/./src/service/army/army-movement.ts","webpack://gps/./src/service/city/builder/buildings.ts","webpack://gps/./src/service/city/builder/city-builder.ts","webpack://gps/./src/service/city/city-switch-manager.ts","webpack://gps/./src/service/farm/farm-manager.ts","webpack://gps/./src/service/master/master-manager.ts","webpack://gps/./src/service/master/ui/general-info.ts","webpack://gps/./src/service/resources/resource-manager.ts","webpack://gps/./src/service/scheduler/Scheduler.ts","webpack://gps/./src/utility/config-manager.ts","webpack://gps/./src/utility/plain-utility.ts","webpack://gps/./src/utility/storage-manager.ts","webpack://gps/./src/utility/ui-lock.ts","webpack://gps/./src/utility/ui-utility.ts","webpack://gps/webpack/bootstrap","webpack://gps/webpack/runtime/define property getters","webpack://gps/webpack/runtime/hasOwnProperty shorthand","webpack://gps/webpack/runtime/make namespace object","webpack://gps/webpack/startup"],"sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","export default \"#config-popup-container * {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  box-sizing: border-box;\\r\\n  font-family: Arial, Helvetica, sans-serif;\\r\\n  color: black;\\r\\n}\\r\\n\\r\\n#config-popup-header {\\r\\n  margin-bottom: 24px;\\r\\n  text-shadow: 2px 2px 2px gray;\\r\\n}\\r\\n\\r\\n#config-popup-container {\\r\\n  position: absolute;\\r\\n  top: 50%;\\r\\n  left: 50%;\\r\\n  transform: translate(-50%, -50%);\\r\\n  box-shadow: 0px 3px 8px 0px rgba(157, 157, 157, 0.4);\\r\\n  border-radius: 4px;\\r\\n  width: 350px;\\r\\n  max-width: 80%;\\r\\n  overflow: hidden;\\r\\n  background-color: antiquewhite;\\r\\n  border: 1px solid rgba(165, 125, 11, 1);\\r\\n  z-index: 100;\\r\\n  padding: 16px;\\r\\n}\\r\\n\\r\\n.input-wrapper {\\r\\n  display: grid;\\r\\n  grid-template-columns: auto 1fr;\\r\\n  justify-items: start;\\r\\n  column-gap: 8px;\\r\\n  row-gap: 8px;\\r\\n  align-items: center;\\r\\n  margin-top: 16px;\\r\\n  text-align: start;\\r\\n}\\r\\n\\r\\n.input-wrapper label {\\r\\n  background-color: none;\\r\\n}\\r\\n\\r\\n.expandable-section {\\r\\n  grid-column-start: 2;\\r\\n}\\r\\n\\r\\n#config-popup-content {\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n  border-radius: 4px;\\r\\n  gap: 8px;\\r\\n}\\r\\n\\r\\n#config-popup-content h1 {\\r\\n  font-weight: 500;\\r\\n  font-size: 1.7rem;\\r\\n  align-self: center;\\r\\n  margin-bottom: 8px;\\r\\n}\\r\\n\\r\\n.label-chevron {\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  gap:8px\\r\\n}\\r\\n\\r\\n\\r\\n#button-panel {\\r\\n  align-self: flex-end;\\r\\n  margin-top: 20px;\\r\\n}\\r\\n\\r\\n#button-panel button {\\r\\n  padding: 4px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n#config-popup-container.minimized {\\r\\n  top: auto;\\r\\n  transform: none;\\r\\n  bottom: 50px;\\r\\n  left: 10px;\\r\\n  width: 40px;\\r\\n  height: 40px;\\r\\n  border-radius: 50%;\\r\\n  box-shadow: none;\\r\\n}\\r\\n\\r\\n\\r\\n.show-trigger {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n#close-popup {\\r\\n  cursor: pointer;\\r\\n  position: absolute;\\r\\n  right: 10px;\\r\\n  top: 10px;\\r\\n  transition-duration: 125ms;\\r\\n  color: tomato;\\r\\n  text-shadow: 0px 0px 2px black;\\r\\n}\\r\\n\\r\\n#close-popup:hover {\\r\\n  animation: freak 1s ease-in both infinite;\\r\\n}\\r\\n\\r\\n#config-popup-container.minimized #config-popup-content {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n#config-popup-container.minimized #config-popup-header {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n#config-popup-container.minimized {\\r\\n  padding: 0;\\r\\n}\\r\\n\\r\\n#config-popup-container.minimized .show-trigger {\\r\\n  cursor: pointer;\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n  font-size: 0.7rem;\\r\\n  font-weight: 600;\\r\\n  text-shadow: 0px 1px 1px rgba(165, 125, 11, 1);\\r\\n}\\r\\n\\r\\n.section-header {\\r\\n  display: flex;\\r\\n  flex-direction: row;\\r\\n  align-items: center;\\r\\n  gap: 5px;\\r\\n}\\r\\n\\r\\n.section-content {\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n  gap: 4px;\\r\\n}\\r\\n\\r\\n.isle-container {\\r\\n  display: flex;\\r\\n  margin-left: 16px !important;\\r\\n  gap: 4px;\\r\\n  margin-top: 4px !important;\\r\\n}\\r\\n\\r\\n.arrow-down {\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.hidden {\\r\\n  display: none !important;\\r\\n}\\r\\n\\r\\n.rotate {\\r\\n  transform: rotate(180deg);\\r\\n}\\r\\n\\r\\n@keyframes freak {\\r\\n  0% {\\r\\n    transform: scale(1);\\r\\n  }\\r\\n\\r\\n  33.33% {\\r\\n    transform: scale(0.8);\\r\\n  }\\r\\n\\r\\n  66.66% {\\r\\n    transform: scale(1.2);\\r\\n  }\\r\\n}\";","export default \"<div id=\\\"config-popup-container\\\" class=\\\"\\\">\\r\\n  <div id=\\\"config-popup-header\\\">\\r\\n    <h1>GPS config</h1>\\r\\n    <div id=\\\"close-popup\\\">&#10006;</div>\\r\\n  </div>\\r\\n  <div id=\\\"config-popup-content\\\">\\r\\n    <div class=\\\"input-wrapper\\\">\\r\\n      <input type=\\\"checkbox\\\" id=\\\"city-switch\\\" checked />\\r\\n      <label for=\\\"city-switch\\\">Switch cities automatically</label>\\r\\n    </div>\\r\\n    <div class=\\\"input-wrapper\\\">\\r\\n      <input type=\\\"checkbox\\\" id=\\\"farm\\\" checked />\\r\\n      <div class=\\\"label-chevron\\\">\\r\\n        <label for=\\\"farm\\\">\\r\\n          Farm manager\\r\\n        </label>\\r\\n        <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"arrow-down\\\" width=\\\"16\\\" height=\\\"16\\\" fill=\\\"currentColor\\\"\\r\\n          class=\\\"bi bi-chevron-down\\\" viewBox=\\\"0 0 16 16\\\">\\r\\n          <path fill-rule=\\\"evenodd\\\"\\r\\n            d=\\\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708\\\" />\\r\\n        </svg>\\r\\n      </div>\\r\\n      <div class=\\\"expandable-section hidden\\\">\\r\\n        <div class=\\\"section-header\\\"></div>\\r\\n        <div class=\\\"section-content\\\">\\r\\n          <div class=\\\"input-wapper\\\">\\r\\n            <label>\\r\\n              Time interval\\r\\n            </label>\\r\\n            <select id=\\\"time-interval-select\\\">\\r\\n            </select>\\r\\n          </div>\\r\\n          <div class=\\\"input-wapper\\\">\\r\\n            <input type=\\\"checkbox\\\" id=\\\"humanize-checkbox\\\" />\\r\\n            <label for=\\\"humanize-checkbox\\\">\\r\\n              Humanize\\r\\n            </label>\\r\\n          </div>\\r\\n          <div id=\\\"conflicting-cities-container\\\" class=\\\"hidden\\\">\\r\\n            <div class=\\\"section-header\\\">\\r\\n              <span class=\\\"section-name\\\">Conflicting cities</span>\\r\\n              <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" class=\\\"arrow-down\\\" width=\\\"16\\\" height=\\\"16\\\"\\r\\n                fill=\\\"currentColor\\\" class=\\\"bi bi-chevron-down\\\" viewBox=\\\"0 0 16 16\\\">\\r\\n                <path fill-rule=\\\"evenodd\\\"\\r\\n                  d=\\\"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708\\\" />\\r\\n              </svg>\\r\\n            </div>\\r\\n            <div class=\\\"section-content hidden\\\">\\r\\n              <!-- <div class=\\\"isle-container\\\">\\r\\n                <div class=\\\"isle-header\\\">Isle 1</div>\\r\\n                <select name=\\\"isle1-cities\\\" id=\\\"isle1-cities\\\">\\r\\n                  <option value=\\\"city1\\\">City 1</option>\\r\\n                  <option value=\\\"city2\\\">City 2</option>\\r\\n                </select>\\r\\n              </div> -->\\r\\n            </div>\\r\\n          </div>\\r\\n        </div>\\r\\n      </div>\\r\\n    </div>\\r\\n    <div class=\\\"input-wrapper\\\">\\r\\n      <input type=\\\"checkbox\\\" id=\\\"builder\\\" />\\r\\n      <label for=\\\"builder\\\">Builder</label>\\r\\n    </div>\\r\\n    <div class=\\\"input-wrapper\\\">\\r\\n      <input type=\\\"checkbox\\\" id=\\\"guard\\\" disabled />\\r\\n      <label for=\\\"guard\\\">Guard (in progress)</label>\\r\\n    </div>\\r\\n\\r\\n    <div id=\\\"button-panel\\\">\\r\\n      <button id=\\\"submit\\\">Submit</button>\\r\\n      <button type=\\\"reset\\\" id=\\\"cancel-all\\\">Cancel all</button>\\r\\n    </div>\\r\\n  </div>\\r\\n  <div class=\\\"show-trigger\\\">\\r\\n    GPS\\r\\n  </div>\\r\\n</div>\";","export default \"<div id=\\\"build-container\\\" class=\\\"hidden\\\">\\r\\n  <div id=\\\"build-options\\\">\\r\\n  </div>\\r\\n  <div id=\\\"additional-queue\\\">\\r\\n\\r\\n  </div>\\r\\n</div>\\r\\n<button id=\\\"toggle-builder\\\" class=\\\"hidden\\\">Toggle builder</button>\";","export default \"#additional-queue {\\r\\n  display: flex;\\r\\n  gap: 8px;\\r\\n  box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.5);\\r\\n  border-radius: 4px;\\r\\n  padding: 4px;\\r\\n  max-width: 568px;\\r\\n  width: fit-content;\\r\\n  overflow-y: auto;\\r\\n  font-family: Arial, Helvetica, sans-serif;\\r\\n}\\r\\n\\r\\n.queue-item {\\r\\n  flex-shrink: 0;\\r\\n  position: relative;\\r\\n  width: 45px;\\r\\n  height: 45px;\\r\\n  background-size: cover;\\r\\n  background-position: center;\\r\\n}\\r\\n\\r\\n.queue-item .up {\\r\\n  position: absolute;\\r\\n  bottom: 0;\\r\\n  left: 0;\\r\\n  right: 0;\\r\\n  font-weight: bold;\\r\\n  color: lightgreen;\\r\\n  text-align: end;\\r\\n  margin: 2px;\\r\\n  font-size: 12px;\\r\\n  background-color: rgba(0, 0, 0, 0.4);\\r\\n}\\r\\n\\r\\n.queue-item .cancel {\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  right: 0;\\r\\n  font-weight: bold;\\r\\n  color: red;\\r\\n  cursor: pointer;\\r\\n  padding: 1px;\\r\\n  font-size: 10px;\\r\\n}\\r\\n\\r\\n.queue-item .cancel:hover {\\r\\n  transform: scale(1.4);\\r\\n  transition: all 0.2s ease;\\r\\n}\\r\\n\\r\\nhidden {\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n#build-container {\\r\\n  z-index: 2000;\\r\\n  display: flex;\\r\\n  flex-direction: column;\\r\\n  align-items: center;\\r\\n  gap: 8px;\\r\\n  position: fixed;\\r\\n  bottom: 80px;\\r\\n  left: 50%;\\r\\n  transform: translateX(-50%);\\r\\n  border: 1px solid darkgoldenrod;\\r\\n  border-radius: 4px;\\r\\n  padding: 4px;\\r\\n  overflow-x: auto;\\r\\n  max-width: 90%;\\r\\n  background-color: bisque;\\r\\n  width: fit-content;\\r\\n}\\r\\n\\r\\n#build-options {\\r\\n  display: flex;\\r\\n  gap: 4px;\\r\\n}\\r\\n\\r\\n.build-option {\\r\\n  position: relative;\\r\\n  width: 40px;\\r\\n  height: 40px;\\r\\n  background-size: cover;\\r\\n  background-position: center;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.build-option:hover {\\r\\n  transform: scale(1.1);\\r\\n  transition: all 0.2s ease;\\r\\n}\\r\\n\\r\\n.build-options-add {\\r\\n  position: absolute;\\r\\n  top: 50%;\\r\\n  right: 50%;\\r\\n  transform: translate(50%, -50%);\\r\\n  font-weight: bold;\\r\\n  color: white;\\r\\n  cursor: pointer;\\r\\n  font-size: 16px;\\r\\n  user-select: none;\\r\\n}\\r\\n\\r\\n#toggle-builder {\\r\\n  cursor: pointer;\\r\\n  position: fixed;\\r\\n  bottom: 15px;\\r\\n  left: 50%;\\r\\n  transform: translateX(-50%);\\r\\n  font-size: 12px;\\r\\n  z-index: 1000;\\r\\n  opacity: 0.6;\\r\\n}\\r\\n\\r\\n#toggle-builder:hover {\\r\\n  opacity: 1;\\r\\n}\";","export default \"#info-container {\\r\\n  z-index: 3000 !important;\\r\\n  font-family: 'Roboto', sans-serif;\\r\\n  font-size: 0.9em;\\r\\n  position: absolute;\\r\\n  top: 10%;\\r\\n  left: 50%;  \\r\\n  transform: translateX(-50%);\\r\\n  background-color: rgba(1, 11, 152, 0.6); /* Zmiana na rgba z opacity 0.8 */\\r\\n  color: #fff;\\r\\n  padding: 5px 20px;\\r\\n  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);\\r\\n  display: block;\\r\\n}\\r\\n\\r\\n.info-title {\\r\\n  font-weight: bold;\\r\\n}\\r\\n\\r\\n#info-container.hidden {\\r\\n  display: block;\\r\\n  animation: slideOut 0.4s;\\r\\n  animation-fill-mode: forwards;\\r\\n}\\r\\n\\r\\n@keyframes slideIn {\\r\\n  0% {\\r\\n    opacity: 0;\\r\\n    transform: translateX(-50%) translateY(-100%);\\r\\n  }\\r\\n  80% {\\r\\n    transform: translateX(-50%) translateY(20%);\\r\\n  }\\r\\n  100% {\\r\\n    opacity: 1;\\r\\n    transform: translateX(-50%) translateY(0);\\r\\n  }\\r\\n}\\r\\n\\r\\n@keyframes slideOut {\\r\\n  0% {\\r\\n    display: block;\\r\\n    opacity: 1;\\r\\n  }\\r\\n  100% {\\r\\n    opacity: 0;\\r\\n    display: none;\\r\\n    transform: translateX(0%) translateY(0);\\r\\n  }\\r\\n} \\r\\n\";","export default \"<div id=\\\"info-container\\\" class=\\\"hidden\\\">\\r\\n  <span class=\\\"info-title\\\"></span>\\r\\n  <span class=\\\"info-text\\\"></span>\\r\\n</div>\";","export default \"<div style=\\\"margin-top: 8px;\\\">\\r\\n  <input id=\\\"schedule-date\\\" type=\\\"date\\\" />\\r\\n  <input id=\\\"schedule-time\\\" type=\\\"text\\\" size=\\\"5\\\" placeholder=\\\"hh:mm:ss\\\" />\\r\\n  <button type=\\\"button\\\" id=\\\"schedule-button\\\">Schedule</button>\\r\\n  <p id=\\\"schedule-error\\\" style=\\\"color: red;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;\\\"></p>\\r\\n  <p id=\\\"schedule-info\\\" style=\\\"color: green;font-size: 0.8em; margin: 4px; padding: 0px; font-weight: bold; background-color: white;\\\"></p>\\r\\n</div>\";","export default \"<div id=\\\"table-container\\\" class=\\\"hidden\\\">\\r\\n  <table id=\\\"scheduler-lookup-table\\\">\\r\\n    <thead>\\r\\n      <tr>\\r\\n        <th id=\\\"operation-type\\\">Operation Type</th>\\r\\n        <th class=\\\"source-city\\\">Source City</th>\\r\\n        <th class=\\\"destination-city\\\">Destination City</th>\\r\\n        <th class=\\\"departure-time\\\">Departure Time</th>\\r\\n        <th class=\\\"arrival-time\\\">Arrival Time</th>\\r\\n        <th class=\\\"actions\\\">\\r\\n          <div class=\\\"close-icon\\\">\\r\\n            <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"12\\\" height=\\\"12\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"3\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" style=\\\"display: block;\\\">\\r\\n              <line x1=\\\"1\\\" y1=\\\"1\\\" x2=\\\"23\\\" y2=\\\"23\\\"></line>\\r\\n              <line x1=\\\"23\\\" y1=\\\"1\\\" x2=\\\"1\\\" y2=\\\"23\\\"></line>\\r\\n            </svg>\\r\\n          </div>\\r\\n        </th>\\r\\n      </tr>\\r\\n    </thead>\\r\\n    <tbody>\\r\\n      <tr>\\r\\n        <td colspan=\\\"6\\\" id=\\\"no-schedules\\\">No schedules</td>\\r\\n      </tr>\\r\\n    </tbody>\\r\\n  </table>\\r\\n</div>\\r\\n<button id=\\\"scheduler-toggle-button\\\">scheduler</button>\";","export default \"#table-container {\\r\\n  max-height: 50vh;\\r\\n  overflow-y: auto;\\r\\n  border: 1px solid #ddd;\\r\\n  width: fit-content;\\r\\n}\\r\\n\\r\\n#scheduler-lookup-table {\\r\\n  font-family: Arial, Helvetica, sans-serif;\\r\\n  border-collapse: collapse;\\r\\n  font-size: 18px;\\r\\n  text-align: left;\\r\\n  position: absolute;\\r\\n  top: 50%;\\r\\n  left: 50%;\\r\\n  transform: translate(-50%, -50%);\\r\\n  z-index: 1000;\\r\\n  background-color: antiquewhite;\\r\\n}\\r\\n\\r\\n#no-schedules {\\r\\n  text-align: center;\\r\\n  height: 50px;\\r\\n}\\r\\n\\r\\n.attack {\\r\\n  font-weight: 600;\\r\\n  color: #d32f2f;\\r\\n}\\r\\n\\r\\n.support {\\r\\n  font-weight: 600;\\r\\n  color: #2979ff;\\r\\n}\\r\\n\\r\\n#scheduler-lookup-table * {\\r\\n  font-size: 14px;\\r\\n}\\r\\n\\r\\n#scheduler-lookup-table th,\\r\\n#scheduler-lookup-table td {\\r\\n  border: 1px solid #ddd;\\r\\n  padding: 8px;\\r\\n}\\r\\n\\r\\n#scheduler-lookup-table th {\\r\\n  background-color: #f2f2f2;\\r\\n  font-weight: bold;\\r\\n}\\r\\n\\r\\n#scheduler-lookup-table td {\\r\\n  text-wrap: nowrap;\\r\\n}\\r\\n\\r\\n\\r\\n.cancel-button {\\r\\n  background-color: #f44336;\\r\\n  color: white;\\r\\n  border: none;\\r\\n  padding: 5px 10px;\\r\\n  cursor: pointer;\\r\\n  transition-duration: 150ms;\\r\\n}\\r\\n\\r\\n.cancel-button:hover {\\r\\n  background-color: #d32f2f;\\r\\n}\\r\\n\\r\\n#scheduler-toggle-button {\\r\\n  padding: 4px 8px;\\r\\n  font-size: 12px;\\r\\n  font-variant: small-caps;\\r\\n  cursor: pointer;\\r\\n  border-radius: 20px;\\r\\n  position: absolute;\\r\\n  bottom: 98px;\\r\\n  left: 10px;\\r\\n  margin: 0;\\r\\n  z-index: 1000;\\r\\n  transition-duration: 150ms;\\r\\n}\\r\\n\\r\\n#scheduler-toggle-button:hover {\\r\\n  background-color: #ddd;\\r\\n}\\r\\n\\r\\n.actions {\\r\\n  min-width: 22px;\\r\\n}\\r\\n\\r\\n.close-icon {\\r\\n  position: absolute;\\r\\n  cursor: pointer;\\r\\n  right: 5px;\\r\\n  top: 5px;\\r\\n  color: #000;\\r\\n}\\r\\n\\r\\n.close-icon:hover {\\r\\n  scale: 1.1;\\r\\n  transition-duration: 150ms;\\r\\n}\\r\\n\\r\\n.hidden {\\r\\n  display: none;\\r\\n}\";","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.FarmTimeInterval = void 0;\nvar FarmTimeInterval;\n(function (FarmTimeInterval) {\n    FarmTimeInterval[FarmTimeInterval[\"FirstOption\"] = 300000] = \"FirstOption\";\n    FarmTimeInterval[FarmTimeInterval[\"SecondOption\"] = 1200000] = \"SecondOption\";\n    FarmTimeInterval[FarmTimeInterval[\"ThirdOption\"] = 5400000] = \"ThirdOption\";\n    FarmTimeInterval[FarmTimeInterval[\"FourthOption\"] = 14400000] = \"FourthOption\";\n})(FarmTimeInterval || (exports.FarmTimeInterval = FarmTimeInterval = {}));\nconst config = {\n    resources: {\n        minPopulationBuffer: 100,\n        storeAlmostFullPercentage: 0.9,\n    },\n    farmConfig: {\n        farmInterval: FarmTimeInterval.FirstOption,\n        humanize: false,\n        farmingCities: [],\n    },\n    general: {\n        timeDifferenceBackwards: 12 * 1000,\n        antyTimingMs: 10000,\n        applicationRefreshInterval: 32 * 60 * 1000, // 32 minutes\n        forcedRefresh: false,\n        switch: true,\n        farm: true,\n        builder: true,\n        guard: false,\n    }\n};\nexports.default = config;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_popup_css_1 = __importDefault(require(\"./config-popup.css\"));\nconst config_popup_html_1 = __importDefault(require(\"./config-popup.html\"));\nconst events_1 = __importDefault(require(\"events\"));\nconst config_manager_1 = __importDefault(require(\"../utility/config-manager\"));\nconst gps_config_1 = require(\"../../gps.config\");\nconst city_switch_manager_1 = __importDefault(require(\"../service/city/city-switch-manager\"));\nclass ConfigPopup extends events_1.default {\n    constructor() {\n        super();\n        this.uniquelySelectedFarmingCitiesPerIsle = {};\n        this.isSwitchChecked = () => {\n            return this.switch;\n        };\n        this.isFarmChecked = () => {\n            return this.farm;\n        };\n        this.isBuilderChecked = () => {\n            return this.builder;\n        };\n        this.isGuardChecked = () => {\n            return this.guard;\n        };\n        this.getPlunderConfig = () => {\n        };\n        this.getManagersFlags = () => {\n            return {\n                farm: this.farm,\n                builder: this.builder,\n                guard: this.guard,\n            };\n        };\n        this.configManager = config_manager_1.default.getInstance();\n        this.config = this.configManager.getConfig();\n        this.switch = this.config.general.switch;\n        this.farm = this.config.general.farm;\n        this.builder = this.config.general.builder;\n        this.guard = this.config.general.guard;\n        this.farmInterval = this.config.farmConfig.farmInterval;\n        this.humanize = this.config.farmConfig.humanize;\n    }\n    initEventListeners() {\n        var _a;\n        const container = document.querySelector('#config-popup-container');\n        const switchCheckbox = container.querySelector('#city-switch');\n        const plunderCheckbox = container.querySelector('#farm');\n        const builderCheckbox = container.querySelector('#builder');\n        const guardCheckbox = container.querySelector('#guard');\n        const timeIntervalSelect = container.querySelector('#time-interval-select');\n        const showTrigger = container.querySelector('.show-trigger');\n        const closeTrigger = container.querySelector('#close-popup');\n        const humanizeCheckbox = container.querySelector('#humanize-checkbox');\n        if (!container)\n            throw new Error('\"#config-popup-container\" couldn\\'t be found.');\n        closeTrigger.addEventListener('click', () => {\n            if (!container.classList.contains('minimized'))\n                container.classList.add('minimized');\n        });\n        container.querySelectorAll('#button-panel button').forEach((btn) => btn.addEventListener('click', () => {\n            if (btn.type === 'reset') {\n                switchCheckbox.checked = false;\n                this.switch = false;\n                plunderCheckbox.checked = false;\n                this.farm = false;\n                builderCheckbox.checked = false;\n                this.builder = false;\n                guardCheckbox.checked = false;\n                this.guard = false;\n            }\n            const conflictingCitiesChanged = Object.keys(this.uniquelySelectedFarmingCitiesPerIsle).some(isleId => { var _a; return this.uniquelySelectedFarmingCitiesPerIsle[isleId].name !== ((_a = this.config.farmConfig.farmingCities.find(city => city.isleId === isleId)) === null || _a === void 0 ? void 0 : _a.name); });\n            console.log('conflictingCitiesChanged', conflictingCitiesChanged);\n            // update config related fields and persist them to local storage if changed\n            if (this.config.farmConfig.farmInterval !== this.farmInterval ||\n                this.config.farmConfig.humanize !== this.humanize ||\n                this.config.general.switch !== this.switch ||\n                this.config.general.farm !== this.farm ||\n                this.config.general.builder !== this.builder ||\n                this.config.general.guard !== this.guard ||\n                conflictingCitiesChanged) {\n                // readability comment --------------------------------------------------------------\n                this.config.farmConfig.farmInterval = this.farmInterval;\n                this.config.farmConfig.humanize = this.humanize;\n                this.config.general.switch = this.switch;\n                this.config.general.farm = this.farm;\n                this.config.general.builder = this.builder;\n                this.config.general.guard = this.guard;\n                this.config.farmConfig.farmingCities = Object.values(this.uniquelySelectedFarmingCitiesPerIsle);\n                this.configManager.persistConfig();\n            }\n            if (this.farmInterval === gps_config_1.FarmTimeInterval.FourthOption) {\n                alert('Farmienie ustawione na 4h/8h, odśwież stronę jeżeli to błąd!');\n            }\n            container.classList.add('minimized');\n            this.emit('managersChange');\n        }));\n        showTrigger.addEventListener('click', () => {\n            container.classList.contains('minimized') && container.classList.remove('minimized');\n        });\n        switchCheckbox.addEventListener('change', () => {\n            this.switch = switchCheckbox.checked;\n        });\n        plunderCheckbox.addEventListener('change', () => {\n            this.farm = plunderCheckbox.checked;\n        });\n        builderCheckbox.addEventListener('change', () => {\n            this.builder = builderCheckbox.checked;\n        });\n        guardCheckbox.addEventListener('change', () => {\n            this.guard = guardCheckbox.checked;\n        });\n        timeIntervalSelect.addEventListener('change', () => {\n            this.farmInterval = Number(timeIntervalSelect.value);\n            console.log('this.farmInterval changed to: ', this.farmInterval);\n        });\n        // farm section\n        const farmSection = (_a = container.querySelector('#farm')) === null || _a === void 0 ? void 0 : _a.parentElement;\n        const farmSectionContainer = farmSection.querySelector('.expandable-section');\n        const farmSectionArrow = farmSection.querySelector('.arrow-down');\n        farmSectionArrow.addEventListener('click', () => {\n            farmSectionContainer.classList.toggle('hidden');\n            farmSectionArrow.classList.toggle('rotate');\n        });\n        humanizeCheckbox.addEventListener('change', () => {\n            this.humanize = humanizeCheckbox.checked;\n        });\n        // END farm section\n    }\n    createInitialElements() {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            const container = document.createElement('div');\n            container.innerHTML = config_popup_html_1.default;\n            // get initial data from config and change\n            container.querySelector('#city-switch').checked = this.switch;\n            container.querySelector('#farm').checked = this.farm;\n            container.querySelector('#builder').checked = this.builder;\n            container.querySelector('#guard').checked = this.guard;\n            // farm section\n            const intervalSelectElement = container.querySelector('#time-interval-select');\n            const farmIntervalValuesUnparsed = Object.values(gps_config_1.FarmTimeInterval);\n            const farmIntervalValues = farmIntervalValuesUnparsed.slice((farmIntervalValuesUnparsed.length / 2));\n            farmIntervalValues.forEach((value) => {\n                const option = document.createElement('option');\n                option.value = value.toString();\n                option.textContent = this.mapTimeIntervalKeyToText(value);\n                intervalSelectElement.appendChild(option);\n            });\n            container.querySelector('#time-interval-select').value = (_a = this.config.farmConfig.farmInterval.toString()) !== null && _a !== void 0 ? _a : gps_config_1.FarmTimeInterval.FirstOption.toString();\n            const humanizeCheckbox = container.querySelector('#humanize-checkbox');\n            humanizeCheckbox.checked = this.config.farmConfig.humanize;\n            yield this.createConfictingCitiesSelects(container);\n            // END farm section\n            return container;\n        });\n    }\n    createConfictingCitiesSelects(container) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            const citySwitchManager = yield city_switch_manager_1.default.getInstance();\n            const listOfCities = citySwitchManager.getCityList();\n            const uniqueIsleGrids = Array.from(new Set(listOfCities.map(city => city.isleId)));\n            const arrayOfArraysOfCitiesOnTheSameIsland = uniqueIsleGrids.map(isleId => listOfCities.filter(city => city.isleId === isleId));\n            const areAnyConflicts = arrayOfArraysOfCitiesOnTheSameIsland.some(array => array.length > 1);\n            const conflictingCitiesContainer = container.querySelector('#conflicting-cities-container');\n            const conflictingCitiesArrow = conflictingCitiesContainer.querySelector('.arrow-down');\n            const conflictingCitiesContent = conflictingCitiesContainer.querySelector('.section-content');\n            if (!areAnyConflicts) {\n                conflictingCitiesContainer.classList.add('hidden');\n                /* NOTE:  if there are no conflicts, then all cities are uniquely selected,\n                but it must be explicitly assigned to the class field because based on this, after submitting it will\n                be added to the config and farm manager will use it to know which villages to farm.\n                */\n                this.uniquelySelectedFarmingCitiesPerIsle = listOfCities.reduce((acc, city) => {\n                    acc[city.isleId] = city;\n                    return acc;\n                }, {});\n            }\n            else {\n                conflictingCitiesContainer.classList.remove('hidden');\n                /*\n                 *     <!-- <div class=\"isle-container\">\n                 *         <div class=\"isle-header\">Isle 1</div>\n                 *         <select name=\"isle1-cities\" id=\"isle1-cities\">\n                 *         <option value=\"city1\">City 1</option>\n                 *         <option value=\"city2\">City 2</option>\n                 *       </select>\n                 *     </div> -->\n                 */\n                for (const arrayOfCities of arrayOfArraysOfCitiesOnTheSameIsland) {\n                    if (arrayOfCities.length === 1) {\n                        this.uniquelySelectedFarmingCitiesPerIsle[arrayOfCities[0].isleId] = arrayOfCities[0];\n                        continue;\n                    }\n                    const initialCity = (_a = arrayOfCities.find(city => { var _a; return city.name === ((_a = this.config.farmConfig.farmingCities.find(city => city.isleId === arrayOfCities[0].isleId)) === null || _a === void 0 ? void 0 : _a.name); })) !== null && _a !== void 0 ? _a : arrayOfCities[0];\n                    this.uniquelySelectedFarmingCitiesPerIsle[arrayOfCities[0].isleId] = initialCity;\n                    const isleContainer = document.createElement('div');\n                    isleContainer.className = 'isle-container';\n                    const isleHeader = document.createElement('div');\n                    isleHeader.className = 'isle-header';\n                    isleHeader.textContent = `Isle ${arrayOfCities[0].isleId}`;\n                    isleContainer.appendChild(isleHeader);\n                    const isleCitiesSelect = document.createElement('select');\n                    isleCitiesSelect.name = `isle-${arrayOfCities[0].isleId}-cities`;\n                    isleCitiesSelect.id = `isle-${arrayOfCities[0].isleId}-cities`;\n                    isleContainer.appendChild(isleCitiesSelect);\n                    arrayOfCities.forEach((city) => {\n                        const option = document.createElement('option');\n                        option.value = city.name;\n                        option.textContent = city.name;\n                        isleCitiesSelect.appendChild(option);\n                    });\n                    isleCitiesSelect.value = initialCity.name;\n                    isleCitiesSelect.addEventListener('change', () => {\n                        const selectedCity = arrayOfCities.find(city => city.name === isleCitiesSelect.value);\n                        if (selectedCity) {\n                            this.uniquelySelectedFarmingCitiesPerIsle[arrayOfCities[0].isleId] = selectedCity;\n                            console.log('this.conflictingCities', this.uniquelySelectedFarmingCitiesPerIsle);\n                        }\n                    });\n                    conflictingCitiesContent.appendChild(isleContainer);\n                }\n                ;\n            }\n            conflictingCitiesArrow.addEventListener('click', () => {\n                conflictingCitiesContent.classList.toggle('hidden');\n                conflictingCitiesArrow.classList.toggle('rotate');\n            });\n        });\n    }\n    mapTimeIntervalKeyToText(value) {\n        switch (value) {\n            case gps_config_1.FarmTimeInterval.FirstOption:\n                return \"5m/10m\";\n            case gps_config_1.FarmTimeInterval.SecondOption:\n                return \"20m/40m\";\n            case gps_config_1.FarmTimeInterval.ThirdOption:\n                return \"1h 30m/3h\";\n            case gps_config_1.FarmTimeInterval.FourthOption:\n                return \"4h/8h\";\n            default:\n                return \"Unknown interval\";\n        }\n    }\n    addStyle() {\n        const style = document.createElement('style');\n        style.textContent = config_popup_css_1.default;\n        document.head.appendChild(style);\n    }\n    render() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.addStyle();\n            // utwórz contener, ustaw atrybuty i body\n            const configWindowElement = yield this.createInitialElements();\n            document.body.appendChild(configWindowElement);\n            this.initEventListeners();\n        });\n    }\n    minimize() {\n        const container = document.querySelector('#config-popup-container');\n        container === null || container === void 0 ? void 0 : container.classList.add('minimized');\n    }\n}\nexports.default = ConfigPopup;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst master_manager_1 = __importDefault(require(\"./service/master/master-manager\"));\nconst ui_utility_1 = require(\"./utility/ui-utility\");\nconst main = () => __awaiter(void 0, void 0, void 0, function* () {\n    console.log('VERY POLITE GPS v.0.5.0 MVP walikonie special edition (c) 2024');\n    const currentUrl = window.location.href;\n    if (/.*grepolis.com\\/game\\/.*/.test(currentUrl)) {\n        const masterManager = yield master_manager_1.default.getInstance();\n    }\n    else if (currentUrl.includes('start?nosession')) {\n        setInterval(() => {\n            var _a;\n            GM_setValue('forceRestart', true);\n            console.log('GM_setValue forceRestart, value:', GM_getValue('forceRestart'));\n            (_a = document.querySelector('.world_name.end_game_type_world_wonder')) === null || _a === void 0 ? void 0 : _a.click();\n            // }, 1 * 1000 * 60 * 5);\n        }, 1 * 1000 * 30);\n    }\n});\n(0, ui_utility_1.onPageLoad)(main);\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass ArmyMovement {\n    constructor() {\n        this.callback = null;\n    }\n    static getInstance() {\n        if (!ArmyMovement.instance) {\n            ArmyMovement.instance = new ArmyMovement();\n            ArmyMovement.instance.mountObserver();\n        }\n        return ArmyMovement.instance;\n    }\n    mountObserver() {\n        const observer = new MutationObserver((mutations) => {\n            mutations.forEach((mutation) => {\n                if (mutation.type === 'childList') {\n                    for (const node of mutation.addedNodes) {\n                        if (node instanceof HTMLElement && node.getAttribute('data-commandtype') === 'unit_movements' && node.getAttribute('data-cancelable') != '-1') {\n                            if (this.callback) {\n                                this.callback(node.id);\n                                this.callback = null;\n                                return;\n                            }\n                        }\n                    }\n                }\n            });\n        });\n        const element = document.querySelector('#toolbar_activity_commands_list .content.js-dropdown-item-list');\n        observer.observe(element, {\n            childList: true,\n            subtree: false,\n        });\n    }\n    setCallback(callback) {\n        this.callback = callback;\n    }\n}\nexports.default = ArmyMovement;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.buildings = exports.buildingsSelectors = void 0;\nconst ui_utility_1 = require(\"../../../utility/ui-utility\");\nconst buildActionSafe = (selector) => __awaiter(void 0, void 0, void 0, function* () {\n    const cityViewBtn = document.querySelector('[name=\"city_overview\"]');\n    if (!(cityViewBtn === null || cityViewBtn === void 0 ? void 0 : cityViewBtn.classList.contains('checked'))) {\n        cityViewBtn === null || cityViewBtn === void 0 ? void 0 : cityViewBtn.click();\n    }\n    const buildModeButton = document.querySelector('[class=\"construction_queue_build_button\"] div');\n    if (!buildModeButton.classList.contains('active')) {\n        buildModeButton.click();\n    }\n    yield (0, ui_utility_1.waitForElement)(selector).then((element) => element.click());\n});\nexports.buildingsSelectors = {\n    buildButton: `.btn_build.build_button`,\n    currentLvl: `[class=\"twa_content js-content-area\"] span:nth-of-type(3)`,\n    disabled: 'disabled'\n};\n// .city_overview_overlay.main .btn_build.build_button\nexports.buildings = {\n    main: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/main.png)',\n        elementSelector: '.city_overview_overlay.main',\n        currentLvlElSelector: '.city_overview_overlay.main [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Senate',\n        buildAction: () => buildActionSafe('.city_overview_overlay.main .btn_build.build_button'),\n    },\n    hide: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/hide.png)',\n        elementSelector: '.city_overview_overlay.hide',\n        currentLvlElSelector: '.city_overview_overlay.hide [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Cave',\n        buildAction: () => buildActionSafe('.city_overview_overlay.hide .btn_build.build_button'),\n    },\n    lumber: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/lumber.png)',\n        elementSelector: '.city_overview_overlay.lumber',\n        currentLvlElSelector: '.city_overview_overlay.lumber [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Lumber mill',\n        buildAction: () => buildActionSafe('.city_overview_overlay.lumber .btn_build.build_button'),\n    },\n    stoner: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/stoner.png)',\n        elementSelector: '.city_overview_overlay.stoner',\n        currentLvlElSelector: '.city_overview_overlay.stoner [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Quarry',\n        buildAction: () => buildActionSafe('.city_overview_overlay.stoner .btn_build.build_button'),\n    },\n    ironer: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/ironer.png)',\n        elementSelector: '.city_overview_overlay.ironer',\n        currentLvlElSelector: '.city_overview_overlay.ironer [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Silver mine',\n        buildAction: () => buildActionSafe('.city_overview_overlay.ironer .btn_build.build_button'),\n    },\n    market: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/market.png)',\n        elementSelector: '.city_overview_overlay.market',\n        currentLvlElSelector: '.city_overview_overlay.market [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Market',\n        buildAction: () => buildActionSafe('.city_overview_overlay.market .btn_build.build_button'),\n    },\n    docks: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/docks.png)',\n        elementSelector: '.city_overview_overlay.docks',\n        currentLvlElSelector: '.city_overview_overlay.docks [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Harbor',\n        buildAction: () => buildActionSafe('.city_overview_overlay.docks .btn_build.build_button'),\n    },\n    barracks: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/barracks.png)',\n        elementSelector: '.city_overview_overlay.barracks',\n        currentLvlElSelector: '.city_overview_overlay.barracks [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Barracks',\n        buildAction: () => buildActionSafe('.city_overview_overlay.barracks .btn_build.build_button'),\n    },\n    wall: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/wall.png)',\n        elementSelector: '.city_overview_overlay.wall',\n        currentLvlElSelector: '.city_overview_overlay.wall [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'City wall',\n        buildAction: () => buildActionSafe('.city_overview_overlay.wall .btn_build.build_button'),\n    },\n    storage: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/storage.png)',\n        elementSelector: '.city_overview_overlay.storage',\n        currentLvlElSelector: '.city_overview_overlay.storage [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Warehouse',\n        buildAction: () => buildActionSafe('.city_overview_overlay.storage .btn_build.build_button'),\n    },\n    farm: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/farm.png)',\n        elementSelector: '.city_overview_overlay.farm',\n        currentLvlElSelector: '.city_overview_overlay.farm [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Farm',\n        buildAction: () => buildActionSafe('.city_overview_overlay.farm .btn_build.build_button'),\n    },\n    academy: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/academy.png)',\n        elementSelector: '.city_overview_overlay.academy',\n        currentLvlElSelector: '.city_overview_overlay.academy [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Academy',\n        buildAction: () => buildActionSafe('.city_overview_overlay.academy .btn_build.build_button'),\n    },\n    temple: {\n        backgroundImageProp: 'url(https://gpen.innogamescdn.com/images/game/main/temple.png)',\n        elementSelector: '.city_overview_overlay.temple',\n        currentLvlElSelector: '.city_overview_overlay.temple [class=\"twa_content js-content-area\"] span:nth-of-type(3)',\n        name: 'Temple',\n        buildAction: () => buildActionSafe('.city_overview_overlay.temple .btn_build.build_button'),\n    }\n};\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst plain_utility_1 = require(\"../../../utility/plain-utility\");\nconst ui_lock_1 = __importDefault(require(\"../../../utility/ui-lock\"));\nconst ui_utility_1 = require(\"../../../utility/ui-utility\");\nconst queue_css_1 = __importDefault(require(\"./queue.css\"));\nconst builder_prod_html_1 = __importDefault(require(\"./builder-prod.html\"));\nconst buildings_1 = require(\"./buildings\");\nconst resource_manager_1 = __importDefault(require(\"../../resources/resource-manager\"));\nconst city_switch_manager_1 = __importDefault(require(\"../city-switch-manager\"));\nconst general_info_1 = __importDefault(require(\"../../master/ui/general-info\"));\nclass CityBuilder {\n    constructor() {\n        this.allowUnsequentialBuilds = false;\n        this.allowCriticalBuilds = true;\n        this.RUN = false;\n        this.mainQueue = [];\n    }\n    static getInstance() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!CityBuilder.instance) {\n                CityBuilder.instance = new CityBuilder();\n                CityBuilder.instance.lock = ui_lock_1.default.getInstance();\n                CityBuilder.instance.resourceManager = resource_manager_1.default.getInstance();\n                CityBuilder.instance.citySwitchManager = yield city_switch_manager_1.default.getInstance();\n                CityBuilder.instance.generalInfo = general_info_1.default.getInstance();\n                CityBuilder.instance.addStyle();\n                CityBuilder.instance.renderUI();\n                CityBuilder.instance.loadQueueFromStorage();\n                CityBuilder.instance.listenToCitySwitch();\n            }\n            return CityBuilder.instance;\n        });\n    }\n    renderUI() {\n        const container = document.createElement('div');\n        container.innerHTML = builder_prod_html_1.default;\n        document.body.appendChild(container);\n        this.addBuildButtons();\n        this.initToggleButtonEvents();\n    }\n    initToggleButtonEvents() {\n        const button = document.getElementById(CityBuilder.toggleBuilderButtonId);\n        button.addEventListener('click', () => {\n            const buildContainer = document.getElementById(CityBuilder.buildContainerId);\n            buildContainer.classList.toggle('hidden');\n            if (!buildContainer.classList.contains('hidden')) {\n                this.tryGoToBuildMode('current');\n            }\n            else {\n                this.tryExitBuildMode();\n            }\n        });\n    }\n    listenToCitySwitch() {\n        this.citySwitchManager.on('cityChange', (city) => {\n            const currentCityQueue = this.mainQueue.find(queue => queue.city === city);\n            this.rerenderQueue(currentCityQueue);\n        });\n    }\n    /*\n    <div id=\"build-container\">\n      <div id=\"build-options\">\n        <div class=\"build-option\"\n          style=\"background-image: url(https://gpen.innogamescdn.com/images/game/main/lumber.png)\">\n          <div class=\"build-options-add\">+</div>\n        </div>\n      </div>\n      <div id=\"additional-queue\">\n  \n      </div>\n    </div>\n    <button id=\"show-builder\">Toggle builder</button>\n    */\n    addBuildButtons() {\n        // <div id=\"build-container\">\n        const buildOptions = document.getElementById(CityBuilder.buildOptionsContainerId);\n        // <div class=\"build-option\"\n        Object.values(buildings_1.buildings).forEach(building => {\n            const button = document.createElement('div');\n            button.className = CityBuilder.buildOptionItemClass;\n            button.style.backgroundImage = building.backgroundImageProp;\n            buildOptions.appendChild(button);\n            // <div class=\"build-options-add\">+</div>\n            const addIcon = document.createElement('div');\n            addIcon.className = CityBuilder.buildOptionItemAddClass;\n            addIcon.innerHTML = '+';\n            button.appendChild(addIcon);\n            button.addEventListener('click', () => {\n                this.onOptionBuildButtonClick(building);\n            });\n        });\n    }\n    tryGoToBuildMode(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            if (city !== 'current') {\n                yield city.switchAction();\n            }\n            (_a = document.querySelector('[name=\"city_overview\"]')) === null || _a === void 0 ? void 0 : _a.click();\n            const buildModeButton = yield (0, ui_utility_1.waitForElement)('[class=\"construction_queue_build_button\"] div', 2000);\n            if (!buildModeButton.classList.contains('active')) {\n                buildModeButton.click();\n            }\n        });\n    }\n    tryExitBuildMode() {\n        const buildModeButton = document.querySelector('[class=\"construction_queue_build_button\"] div');\n        if (buildModeButton === null || buildModeButton === void 0 ? void 0 : buildModeButton.classList.contains('active')) {\n            buildModeButton.click();\n        }\n    }\n    onOptionBuildButtonClick(building) {\n        const currentCity = this.citySwitchManager.getCurrentCity();\n        let currentCityQueue = this.mainQueue.find((queueObj) => queueObj.city.name === currentCity.name);\n        if (!currentCityQueue) {\n            currentCityQueue = {\n                city: currentCity,\n                queue: [],\n                schedule: null\n            };\n            this.mainQueue.push(currentCityQueue);\n        }\n        this.addToQueue(building, currentCityQueue);\n    }\n    /**\n     * Tworzy element DOM przedstawiający element kolejki i zwraca go.\n     * @param building\n     * @returns\n     */\n    addBuldingToUIQueue(queueItem, position = 'end', cityQueue) {\n        const additionalQueue = document.getElementById('additional-queue');\n        const queueItemEl = document.createElement('div');\n        queueItemEl.className = CityBuilder.queueItemClass;\n        queueItemEl.style.backgroundImage = queueItem.building.backgroundImageProp;\n        queueItemEl.setAttribute('data-id', queueItem.id);\n        position === 'start' ? this.appendChildAtIndex(additionalQueue, queueItemEl, 0) : additionalQueue.appendChild(queueItemEl);\n        // <div class=\"up\">+1</div>\n        const upButton = document.createElement('div');\n        upButton.className = CityBuilder.upButtonClass;\n        upButton.textContent = `+${queueItem.toLvl}`;\n        queueItemEl.appendChild(upButton);\n        // <div class=\"cancel\">&#x2715;</div>\n        const cancelButton = document.createElement('div');\n        cancelButton.className = CityBuilder.cancelButtonClass;\n        cancelButton.innerHTML = '&#x2715;';\n        queueItemEl.appendChild(cancelButton);\n        cancelButton.addEventListener('click', () => {\n            const index = cityQueue.queue.findIndex(item => item.id === queueItem.id);\n            if (index !== -1) {\n                if (index === 0) {\n                    cityQueue.queue.shift();\n                    if (cityQueue.schedule) {\n                        clearInterval(cityQueue.schedule);\n                        clearTimeout(cityQueue.schedule);\n                        cityQueue.schedule = null;\n                    }\n                    this.revalidateQueueItemLevels(queueItem.building, index, cityQueue);\n                    this.handleBuildSchedule(cityQueue);\n                }\n                else {\n                    cityQueue.queue.splice(index, 1);\n                    this.revalidateQueueItemLevels(queueItem.building, index, cityQueue);\n                }\n                queueItemEl.remove();\n                this.saveQueueToStorage();\n            }\n            else {\n                console.log('Item not found in queue');\n            }\n        });\n        console.log('queueItemEl', queueItemEl);\n        return queueItemEl;\n    }\n    revalidateQueueItemLevels(building, fromIndex, cityQueue) {\n        console.log('--------revalidateQueueItemLevels', building, fromIndex);\n        const itemsToRevalidate = cityQueue.queue.filter((item, index) => index >= fromIndex && item.building.name === building.name);\n        itemsToRevalidate.forEach((item) => {\n            const newToLvl = item.toLvl - 1;\n            const newId = `${item.building.name}-${newToLvl}`;\n            const queueItemEl = document.querySelector(`[data-id=\"${item.id}\"]`);\n            if (queueItemEl) {\n                queueItemEl.querySelector('.up').textContent = `+${newToLvl}`;\n                queueItemEl.setAttribute('data-id', newId);\n            }\n            item.toLvl = newToLvl;\n            item.id = newId;\n        });\n    }\n    addToQueue(building, cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.tryGoToBuildMode('current');\n            let currentLvl;\n            const buildingElement = yield (0, ui_utility_1.waitForElement)(building.elementSelector, 1000).catch(() => null);\n            if (buildingElement) {\n                const buildingcurrentLvlText = yield (0, ui_utility_1.waitForElement)(`${building.elementSelector} ${buildings_1.buildingsSelectors.currentLvl}`, 1000)\n                    .then(el => el.textContent)\n                    .catch(() => null);\n                currentLvl = (buildingcurrentLvlText !== 'max' || buildingcurrentLvlText !== null) ? Number(buildingcurrentLvlText) : Infinity;\n            }\n            else {\n                currentLvl = 0;\n            }\n            if (currentLvl === Infinity) {\n                return;\n            }\n            const lvlCounter = cityQueue.queue.filter(item => item.building.name === building.name).length + 1;\n            const id = `${building.name}-${currentLvl + lvlCounter}`;\n            const queueItem = { id, building, toLvl: currentLvl + lvlCounter };\n            console.log('queueItem', queueItem);\n            this.addBuldingToUIQueue(queueItem, 'end', cityQueue);\n            cityQueue.queue.push(queueItem);\n            this.saveQueueToStorage();\n            console.log('pushed to queue:', JSON.parse(JSON.stringify(cityQueue.queue)));\n            this.buildOrSchedule(cityQueue);\n        });\n    }\n    buildOrSchedule(cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (cityQueue.queue.length === 1) {\n                console.log('\\t-queue has only one item, handling immediately');\n                if (cityQueue.schedule) {\n                    clearInterval(cityQueue.schedule);\n                    clearTimeout(cityQueue.schedule);\n                    cityQueue.schedule = null;\n                }\n                yield this.handleBuildSchedule(cityQueue);\n            }\n            else {\n                console.log('\\t-queue has more than one item, waiting for its turn');\n            }\n        });\n    }\n    performBuildSchedule(cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!cityQueue || !cityQueue.queue.length) {\n                if (!(yield this.isQueueEmpty(cityQueue.city))) {\n                    yield this.setTimeoutForNextSpeedUpAndSchedule(cityQueue);\n                }\n                return;\n            }\n            console.log('performBuildSchedule with queue:', JSON.parse(JSON.stringify(cityQueue.queue)));\n            if (yield this.isEmptySlot(cityQueue.city)) {\n                const item = cityQueue.queue[0];\n                yield this.checkIfItemCanBeBuiltAndAddDeleteOrSchedule(cityQueue, item);\n            }\n            else {\n                yield this.setTimeoutForNextSpeedUpAndSchedule(cityQueue);\n            }\n        });\n    }\n    setTimeoutForNextSpeedUpAndSchedule(cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const timeToSpeedUp = yield this.getTimeToCanSpeedUp(cityQueue.city).catch(() => null);\n            if (timeToSpeedUp === null) {\n                console.log('\\t-timeToSpeedUp is null, performing build schedule');\n                yield this.performBuildSchedule(cityQueue);\n                return;\n            }\n            if (timeToSpeedUp <= 0) {\n                console.log('\\t-will speed up first build immediately');\n                const emptySlots = this.getEmptySlotsCount();\n                yield this.speedUpFirstBuild(cityQueue.city);\n                yield this.untilEmptyslotsAreEqual(emptySlots + 1);\n                yield this.performBuildSchedule(cityQueue);\n            }\n            else {\n                console.log('\\t-speed up will be scheduled at:', (0, plain_utility_1.getTimeInFuture)(timeToSpeedUp));\n                cityQueue.schedule = setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                    try {\n                        console.log('setTimeoutForNextSpeedUpAndSchedule, wait for lock', cityQueue.city.name);\n                        yield this.lock.acquire();\n                        console.log('setTimeoutForNextSpeedUpAndSchedule, take lock', cityQueue.city.name);\n                        const emptySlots = this.getEmptySlotsCount();\n                        yield this.speedUpFirstBuild(cityQueue.city);\n                        yield this.untilEmptyslotsAreEqual(emptySlots + 1);\n                        yield this.performBuildSchedule(cityQueue);\n                    }\n                    catch (e) {\n                        console.warn('CityBuilder.setTimeoutForNextSpeedUpAndSchedule().catch', e);\n                    }\n                    finally {\n                        console.log('setTimeoutForNextSpeedUpAndSchedule, release lock', cityQueue.city.name);\n                        this.lock.release();\n                    }\n                }), timeToSpeedUp);\n            }\n        });\n    }\n    checkIfItemCanBeBuiltAndAddDeleteOrSchedule(cityQueue_1, item_1) {\n        return __awaiter(this, arguments, void 0, function* (cityQueue, item, forced = false) {\n            const building = item.building;\n            console.log('check if can build item:', item);\n            const canBuild = yield this.canBuild(building, cityQueue.city);\n            console.log('\\t-canBuild:', canBuild);\n            if (canBuild === true) {\n                console.log('\\t-canBuild is true, building...');\n                const emptySlots = this.getEmptySlotsCount();\n                yield building.buildAction();\n                yield this.untilEmptyslotsAreEqual(emptySlots - 1);\n                yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n            }\n            else if (canBuild === 'maxed') {\n                console.log('\\t-canBuild is maxed or not possible at the moment, shifting queue');\n                if (forced) {\n                    this.clearUIQueueItem(cityQueue.queue[1]);\n                    cityQueue.queue.splice(1, 1);\n                    yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                }\n                else {\n                    yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                }\n            }\n            else if (canBuild === 'impossible') {\n                if (!(yield this.isQueueEmpty(cityQueue.city))) {\n                    console.log('\\t-canBuild is impossible, but queue is not empty, scheduling build because maybe after that it will be possible');\n                    yield this.setTimeoutForNextSpeedUpAndSchedule(cityQueue);\n                }\n                else {\n                    console.log('\\t-canBuild is impossible, and queue is empty, element must be deleted');\n                    yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                }\n            }\n            else {\n                const resourcesInfo = yield this.areResourcesStackable(building, cityQueue.city);\n                if (resourcesInfo.areStackable === true) {\n                    // const timeToSpeedUp = !(await this.isQueueEmpty(cityQueue.city)) ?\n                    //   await this.getTimeToCanSpeedUp(cityQueue.city).catch(() => null) :\n                    //   null;\n                    // const buildRetryCallback = () => setInterval(async () => {\n                    //   try {\n                    //     console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, wait for lock', cityQueue.city.name);\n                    //     await this.lock.acquire();\n                    //     console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, take lock', cityQueue.city.name);\n                    //     if ((await this.resourceManager.hasEnoughResources(resourcesInfo.requiredResources, cityQueue.city)) && (await this.canBuild(building, cityQueue.city))) {\n                    //       console.log('\\t\\t-canBuild is true, building...');\n                    //       const emptySlots = this.getEmptySlotsCount();\n                    //       await building.buildAction();\n                    //       await this.untilEmptyslotsAreEqual(emptySlots - 1);\n                    //       await this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                    //     }\n                    //   } catch (e) {\n                    //     console.warn('CityBuilder.checkIfItemCanBeBuiltAndAddDeleteOrSchedule().catch', e);\n                    //   } finally {\n                    //     console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, release lock', cityQueue.city.name);\n                    //     this.lock.release();\n                    //   }\n                    // }, CityBuilder.BUILD_RETRY_INTERVAL);\n                    // if (timeToSpeedUp && timeToSpeedUp < CityBuilder.BUILD_RETRY_INTERVAL) {\n                    //   cityQueue.schedule = setTimeout(async () => {\n                    //     try {\n                    //       await this.lock.acquire();\n                    //       await this.speedUpFirstBuild(cityQueue.city);\n                    //       cityQueue.schedule = buildRetryCallback();\n                    //     } catch (e) {\n                    //       console.warn('CityBuilder.checkIfItemCanBeBuiltAndAddDeleteOrSchedule().catch', e);\n                    //     } finally {\n                    //       this.lock.release();\n                    //     }\n                    //   }, timeToSpeedUp);\n                    // }\n                    console.log('\\t-areResourcesStackable is true, scheduling build');\n                    cityQueue.schedule = setInterval(() => __awaiter(this, void 0, void 0, function* () {\n                        try {\n                            console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, wait for lock', cityQueue.city.name);\n                            yield this.lock.acquire();\n                            console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, take lock', cityQueue.city.name);\n                            if ((yield this.resourceManager.hasEnoughResources(resourcesInfo.requiredResources, cityQueue.city)) && (yield this.canBuild(building, cityQueue.city))) {\n                                console.log('\\t\\t-canBuild is true, building...');\n                                const emptySlots = this.getEmptySlotsCount();\n                                yield building.buildAction();\n                                yield this.untilEmptyslotsAreEqual(emptySlots - 1);\n                                yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                            }\n                        }\n                        catch (e) {\n                            console.warn('CityBuilder.checkIfItemCanBeBuiltAndAddDeleteOrSchedule().catch', e);\n                        }\n                        finally {\n                            console.log('checkIfItemCanBeBuiltAndAddDeleteOrSchedule, release lock', cityQueue.city.name);\n                            this.lock.release();\n                        }\n                    }), CityBuilder.BUILD_RETRY_INTERVAL);\n                }\n                else if (resourcesInfo.areStackable === 'population' && this.allowCriticalBuilds) {\n                    console.log('\\t\\t-areResourcesStackable is population, adding farm to queue');\n                    const farm = buildings_1.buildings.farm;\n                    const buildingLvl = yield this.getBuildingCurrentLvl(farm);\n                    const id = `${farm.name}-${buildingLvl}`;\n                    const queueItem = { id, building, toLvl: buildingLvl + 1 };\n                    cityQueue.queue.unshift(queueItem);\n                    this.addBuldingToUIQueue(queueItem, 'start', cityQueue);\n                    yield this.performBuildSchedule(cityQueue);\n                }\n                else if (resourcesInfo.areStackable === 'storage' && this.allowCriticalBuilds) {\n                    console.log('\\t\\t-areResourcesStackable is storage, adding storage to queue');\n                    const storage = buildings_1.buildings.storage;\n                    const buildingLvl = yield this.getBuildingCurrentLvl(storage);\n                    const id = `${storage.name}-${buildingLvl}`;\n                    const queueItem = { id, building, toLvl: buildingLvl + 1 };\n                    cityQueue.queue.unshift(queueItem);\n                    this.addBuldingToUIQueue(queueItem, 'start', cityQueue);\n                    yield this.performBuildSchedule(cityQueue);\n                }\n                else if (resourcesInfo.areStackable === 'alreadyStacked' && !(yield this.isQueueEmpty(cityQueue.city))) {\n                    console.log('\\t\\t-areResourcesStackable is alreadyStacked, scheduling build');\n                    yield this.setTimeoutForNextSpeedUpAndSchedule(cityQueue);\n                }\n                else {\n                    console.log('Item cannot be scheduled, because it has not met requirements');\n                    yield this.shiftQueueCleanScheduleAndTryNext(item, cityQueue);\n                }\n            }\n        });\n    }\n    getBuildingCurrentLvl(building) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const buildingcurrentLvlText = (yield (0, ui_utility_1.waitForElement)(`${building.elementSelector} ${buildings_1.buildingsSelectors.currentLvl}`)).textContent;\n            const currentLvl = buildingcurrentLvlText !== 'max' ? Number(buildingcurrentLvlText) : Infinity;\n            return currentLvl;\n        });\n    }\n    clearUIQueueItem(item) {\n        const queueItemEl = document.querySelector(`[data-id=\"${item.id}\"]`);\n        if (queueItemEl) {\n            queueItemEl.remove();\n        }\n    }\n    getEmptySlotsCount() {\n        return document.querySelectorAll('.construction_queue_order_container.instant_buy .js-queue-item.empty_slot').length;\n    }\n    untilEmptyslotsAreEqual(emptySlots) {\n        return __awaiter(this, void 0, void 0, function* () {\n            return new Promise((res) => {\n                const interval = setInterval(() => {\n                    if (this.getEmptySlotsCount() === emptySlots) {\n                        console.log('\\t-emptyslotsAreEqual:', emptySlots);\n                        clearInterval(interval);\n                        res();\n                    }\n                }, 333);\n            });\n        });\n    }\n    shiftQueueCleanScheduleAndTryNext(item, cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            cityQueue.queue.shift();\n            this.saveQueueToStorage();\n            if (cityQueue.schedule) {\n                clearInterval(cityQueue.schedule);\n                clearTimeout(cityQueue.schedule);\n                cityQueue.schedule = null;\n            }\n            this.clearUIQueueItem(item);\n            yield this.performBuildSchedule(cityQueue);\n        });\n    }\n    goToCityView() {\n        const cityViewBtn = document.querySelector('[name=\"city_overview\"]');\n        cityViewBtn === null || cityViewBtn === void 0 ? void 0 : cityViewBtn.click();\n    }\n    handleBuildSchedule(cityQueue) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                console.log('handleBuildSchedule, wait for lock', cityQueue.city.name);\n                yield this.lock.acquire();\n                this.generalInfo.showInfo('Builder:', `Obsługa kolejki w mieście: ${cityQueue.city.name}`);\n                console.log('handleBuildSchedule, take lock', cityQueue.city.name);\n                yield this.performBuildSchedule(cityQueue);\n            }\n            catch (e) {\n                console.warn('CityBuilder.doQueueOperation().catch', e);\n            }\n            finally {\n                console.log('handleBuildSchedule, release lock', cityQueue.city.name);\n                this.generalInfo.hideInfo();\n                this.lock.release();\n            }\n        });\n    }\n    speedUpFirstBuild(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.tryGoToBuildMode(city);\n            const freeButton = yield (0, ui_utility_1.waitForElement)('[data-order_index=\"0\"] .type_free', 2000).catch(() => null);\n            if (freeButton) {\n                freeButton.click();\n            }\n            else {\n                throw new Error('No free button found');\n            }\n        });\n    }\n    canBuild(building, city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.tryGoToBuildMode(city);\n            const element = yield (0, ui_utility_1.waitForElement)(building.elementSelector, 2000).catch(() => null);\n            if (!element) {\n                return 'impossible';\n            }\n            const buildButton = yield (0, ui_utility_1.waitForElement)(`${building.elementSelector} ${buildings_1.buildingsSelectors.buildButton}`, 1000).catch(() => null);\n            if (!buildButton) {\n                return 'maxed';\n            }\n            const canBuild = !buildButton.classList.contains(buildings_1.buildingsSelectors.disabled);\n            return canBuild;\n        });\n    }\n    areResourcesStackable(building, city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log('areResourcesStackable');\n            yield this.tryGoToBuildMode(city);\n            // const buildButton = await waitForElement(`${building.elementSelector} ${buildingsSelectors.buildButton}`);\n            let counter = 0;\n            do {\n                (0, ui_utility_1.triggerHover)(document.querySelector(`${building.elementSelector} ${buildings_1.buildingsSelectors.buildButton}`));\n                yield (0, plain_utility_1.addDelay)(333);\n                counter++;\n            } while (!(yield (0, ui_utility_1.waitForElement)('#popup_div img[src*=\"images/game/res/wood.png\"]', 500).catch(() => false)) && counter < 4);\n            if (counter === 4) {\n                console.warn('No popup content found, had to try 4 times. Returning false');\n                return { areStackable: false, requiredResources: { wood: 0, stone: 0, iron: 0 } };\n            }\n            console.log('popup_div found !!!');\n            const requiredWood = Number((yield (0, ui_utility_1.waitForElement)('#popup_div img[src*=\"images/game/res/wood.png\"]', 3000)).nextSibling.textContent);\n            const requiredStone = Number((yield (0, ui_utility_1.waitForElement)('#popup_div img[src*=\"images/game/res/stone.png\"]', 0)).nextSibling.textContent);\n            const requiredIron = Number((yield (0, ui_utility_1.waitForElement)('#popup_div img[src*=\"images/game/res/iron.png\"]', 0)).nextSibling.textContent);\n            const requiredPopulation = Number((yield (0, ui_utility_1.waitForElement)('#popup_div img[src*=\"images/game/res/pop.png\"]', 0)).nextSibling.textContent);\n            (0, ui_utility_1.cancelHover)(document.querySelector(`${building.elementSelector} ${buildings_1.buildingsSelectors.buildButton}`));\n            const resourcesInfo = yield this.resourceManager.getResourcesInfo();\n            console.log(`Resource requirements:\r\n      \\t- Required population: ${requiredPopulation}\r\n      \\t- Current population: ${this.resourceManager.getPopulation()}\r\n      \\t- Store capacity: ${yield this.resourceManager.getStoreCapacity()}\r\n      \\t- Required wood: ${requiredWood}\r\n      \\t- Required stone: ${requiredStone}\r\n      \\t- Required iron: ${requiredIron}`);\n            console.log('Current resources:', resourcesInfo);\n            const requiredResources = {\n                wood: requiredWood,\n                stone: requiredStone,\n                iron: requiredIron,\n            };\n            if (requiredPopulation > (resourcesInfo.population.amount)) {\n                return { areStackable: 'population', requiredResources };\n            }\n            if ([requiredWood, requiredStone, requiredIron].reduce((acc, curr) => curr > acc ? curr : acc, 0) > resourcesInfo.storeMaxSize) {\n                return { areStackable: 'storage', requiredResources };\n            }\n            if (requiredWood <= (resourcesInfo).wood.amount &&\n                requiredStone <= (resourcesInfo).stone.amount &&\n                requiredIron <= (resourcesInfo).iron.amount &&\n                requiredPopulation <= (resourcesInfo).population.amount) {\n                return { areStackable: 'alreadyStacked', requiredResources };\n            }\n            return { areStackable: true, requiredResources };\n        });\n    }\n    ;\n    addStyle() {\n        const style = document.createElement('style');\n        style.textContent = queue_css_1.default;\n        document.head.appendChild(style);\n    }\n    isEmptySlot(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.goToCityView();\n            yield city.switchAction();\n            yield (0, plain_utility_1.addDelay)(1000);\n            return yield (0, ui_utility_1.waitForElement)('.construction_queue_order_container.instant_buy .js-queue-item.empty_slot', 1000)\n                .then(() => true)\n                .catch(() => false);\n        });\n    }\n    getTimeToCanSpeedUp(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.goToCityView();\n            yield city.switchAction();\n            yield (0, plain_utility_1.addDelay)(1000);\n            const firstOrder = yield (0, ui_utility_1.waitForElement)('[data-order_index=\"0\"] .countdown.js-item-countdown', 3000).catch(() => null);\n            if (firstOrder) {\n                return (0, plain_utility_1.textToMs)(firstOrder.textContent) - 5 * 60 * 1000;\n            }\n            throw new Error('No item in the queue.');\n        });\n    }\n    loadQueueFromStorage() {\n        this.mainQueue = this.citySwitchManager.getCityList().map((cityInfo) => ({\n            city: cityInfo,\n            queue: [],\n            schedule: null\n        }));\n        const storageQueue = localStorage.getItem('cityBuilderQueue');\n        if (storageQueue) {\n            JSON.parse(storageQueue)\n                .forEach((cityQueue) => {\n                const city = this.citySwitchManager.getCityByName(cityQueue.city.name);\n                if (!city) {\n                    return;\n                }\n                // actual queue\n                const queueItems = cityQueue.queue.map(item => {\n                    const building = Object.values(buildings_1.buildings).find(building => building.name === item.building.name);\n                    return Object.assign(Object.assign({}, item), { building });\n                });\n                this.mainQueue.find(queue => queue.city === city).queue = queueItems;\n            });\n        }\n        const currentCity = this.citySwitchManager.getCurrentCity();\n        const currentCityQueue = this.mainQueue.find(queue => queue.city === currentCity);\n        if (currentCityQueue) {\n            currentCityQueue.queue.forEach(item => {\n                this.addBuldingToUIQueue(item, 'end', currentCityQueue);\n            });\n        }\n    }\n    saveQueueToStorage() {\n        localStorage.setItem('cityBuilderQueue', JSON.stringify(this.mainQueue));\n    }\n    isQueueEmpty(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield city.switchAction();\n            this.goToCityView();\n            return new Promise((res) => setTimeout(() => res(document.querySelector('.empty_queue')) != null, 0));\n        });\n    }\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.RUN = true;\n            document.getElementById(CityBuilder.toggleBuilderButtonId).classList.remove('hidden');\n            for (const cityQueue of this.mainQueue) {\n                yield this.handleBuildSchedule(cityQueue);\n            }\n        });\n    }\n    stop() {\n        console.log('Stopping');\n        this.RUN = false;\n        this.mainQueue.forEach(cityQueue => {\n            if (cityQueue.schedule) {\n                clearInterval(cityQueue.schedule);\n                clearTimeout(cityQueue.schedule);\n                cityQueue.schedule = null;\n            }\n        });\n        document.getElementById(CityBuilder.toggleBuilderButtonId).classList.add('hidden');\n    }\n    isRunning() {\n        return this.RUN;\n    }\n    appendChildAtIndex(additionalQueue, queueItemEl, index) {\n        additionalQueue.insertBefore(queueItemEl, additionalQueue.children[index]);\n    }\n    rerenderQueue(cityQueue) {\n        document.getElementById('additional-queue').innerHTML = '';\n        if (cityQueue) {\n            cityQueue.queue.forEach(item => {\n                this.addBuldingToUIQueue(item, 'end', cityQueue);\n            });\n        }\n    }\n}\nCityBuilder.queueContainerId = 'additional-queue';\nCityBuilder.queueItemClass = 'queue-item';\nCityBuilder.cancelButtonClass = 'cancel';\nCityBuilder.upButtonClass = 'up';\nCityBuilder.buildOptionsContainerId = 'build-options';\nCityBuilder.buildOptionItemClass = 'build-option';\nCityBuilder.buildOptionItemAddClass = 'build-options-add';\nCityBuilder.buildContainerId = 'build-container';\nCityBuilder.toggleBuilderButtonId = 'toggle-builder';\nCityBuilder.BUILD_RETRY_INTERVAL = 10 * 60 * 1000;\nexports.default = CityBuilder;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst events_1 = __importDefault(require(\"events\"));\nconst ui_utility_1 = require(\"../../utility/ui-utility\");\nconst plain_utility_1 = require(\"../../utility/plain-utility\");\nconst general_info_1 = __importDefault(require(\"../master/ui/general-info\"));\nclass CitySwitchManager extends events_1.default {\n    constructor() {\n        super();\n        this.RUN = false;\n        this.cityList = [];\n    }\n    static getInstance() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!CitySwitchManager.instance) {\n                CitySwitchManager.instance = new CitySwitchManager();\n                CitySwitchManager.instance.generalInfo = general_info_1.default.getInstance();\n                CitySwitchManager.instance.cityList = yield CitySwitchManager.instance.initCityList();\n                CitySwitchManager.instance.mountObserver();\n            }\n            return CitySwitchManager.instance;\n        });\n    }\n    mountObserver() {\n        new MutationObserver((mutations) => {\n            for (const mutation of mutations) {\n                if (mutation.addedNodes.length) {\n                    this.emit('cityChange', this.getCurrentCity());\n                    console.log('cityChange:', this.getCurrentCity());\n                }\n            }\n        }).observe(document.querySelector('.town_name_area .town_name.js-rename-caption'), { childList: true });\n    }\n    /**\n     * Method parses list of city, and creates shortcut access.\n     */\n    initCityList() {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a, _b, _c, _d, _e;\n            this.generalInfo.showInfo('City Switch Manager:', 'Inicjalizacja listy miast');\n            const dropdownTrigger = yield (0, ui_utility_1.waitForElement)('.town_groups_dropdown.btn_toggle_town_groups_menu');\n            dropdownTrigger.click();\n            let townListElement;\n            while (!(townListElement = yield (0, ui_utility_1.waitForElement)('.group_towns', 1000).catch(() => null))) {\n                document.querySelector('.btn_toggle_town_groups_menu').click();\n                yield (0, plain_utility_1.addDelay)(100);\n            }\n            const townList = townListElement.querySelectorAll('span.town_name');\n            const cityList = [];\n            for (const town of townList) {\n                console.log('initCityList.town:', town);\n                const cityId = town.parentElement.getAttribute('data-townid');\n                console.log('\\t-cityId:', cityId);\n                yield this.openTownList();\n                console.log('\\t-openTownList');\n                // for (const el of townList) {\n                for (const el of Array.from(yield (0, ui_utility_1.waitForElements)('.group_towns span.town_name', 3000))) {\n                    console.log('\\t\\t-element to match, element searched:', el.textContent, town.textContent);\n                    if (el.textContent === town.textContent) {\n                        console.log('\\t\\t\\t-found matched element:', el, 'click it');\n                        el.click();\n                        break;\n                    }\n                }\n                ;\n                yield (0, plain_utility_1.addDelay)(100);\n                // here switch to city in order to element be in the dom\n                document.querySelector('.btn_jump_to_town.circle_button.jump_to_town').click();\n                console.log('\\t-click', document.querySelector('.btn_jump_to_town.circle_button.jump_to_town'));\n                const isleId = (_e = (_d = (_c = Array.from((_b = (_a = (yield (0, ui_utility_1.waitForElement)(`#town_${cityId}`, 3000))) === null || _a === void 0 ? void 0 : _a.classList) !== null && _b !== void 0 ? _b : [])\n                    .find(cls => cls.match(/town_\\d+_\\d+_\\d+/))) === null || _c === void 0 ? void 0 : _c.match(/town_(\\d+_\\d+)_\\d+/)) === null || _d === void 0 ? void 0 : _d[1]) !== null && _e !== void 0 ? _e : '';\n                const name = town.textContent;\n                cityList.push({\n                    name,\n                    cityId,\n                    isleId,\n                    switchAction: () => __awaiter(this, void 0, void 0, function* () {\n                        try {\n                            if (document.querySelector('div.town_name').textContent !== name) {\n                                let townListElement = document.querySelector('.group_towns');\n                                if (!townListElement) {\n                                    do {\n                                        yield (0, ui_utility_1.waitForElement)('.town_groups_dropdown.btn_toggle_town_groups_menu', 1000).then(el => el.click()).catch(() => null);\n                                        yield (0, plain_utility_1.addDelay)(333);\n                                    } while (!(townListElement = yield (0, ui_utility_1.waitForElement)('.group_towns', 1500).catch(() => null)));\n                                }\n                                const targetTown = Array.from(townListElement.querySelectorAll('span.town_name'))\n                                    .find(el => el.textContent === name);\n                                targetTown.click();\n                                do {\n                                    yield (0, plain_utility_1.addDelay)(100);\n                                } while (document.querySelector('div.town_name').textContent !== name);\n                            }\n                            document.querySelector('.btn_jump_to_town.circle_button.jump_to_town').click();\n                            yield (0, plain_utility_1.addDelay)(100);\n                        }\n                        catch (e) {\n                            console.warn('switchAction.catch:', e);\n                        }\n                    })\n                });\n            }\n            console.log('CitySwitchManager.cityList.initialized:', cityList);\n            yield this.goBackToFirstTown();\n            this.generalInfo.hideInfo();\n            return cityList;\n        });\n    }\n    openTownList() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!(yield (0, ui_utility_1.waitForElement)('.group_towns', 1000).catch(() => null))) {\n                const dropdownTrigger = yield (0, ui_utility_1.waitForElement)('.town_groups_dropdown.btn_toggle_town_groups_menu');\n                dropdownTrigger.click();\n            }\n        });\n    }\n    goBackToFirstTown() {\n        return __awaiter(this, void 0, void 0, function* () {\n            document.querySelector('.btn_next_town.button_arrow.right').click();\n            document.querySelector('.btn_jump_to_town.circle_button.jump_to_town').click();\n        });\n    }\n    clickArrowUntilCityFound(cityName) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const cityWrapper = document.querySelector(`.town_name_area`);\n            const arrowLeft = cityWrapper.querySelector('.btn_prev_town.button_arrow.left');\n            const arrowRight = cityWrapper.querySelector('.btn_next_town.button_arrow.right');\n            do {\n                arrowRight.click();\n                yield (0, plain_utility_1.addDelay)(1500);\n                if (document.querySelector('div.town_name').textContent === cityName) {\n                    return;\n                }\n            } while (arrowRight.classList.contains('disabled'));\n            do {\n                arrowLeft.click();\n                yield (0, plain_utility_1.addDelay)(1500);\n                if (document.querySelector('div.town_name').textContent === cityName) {\n                    return;\n                }\n            } while (!arrowLeft.classList.contains('disabled'));\n        });\n    }\n    getCurrentCity() {\n        var _a, _b;\n        const name = (_b = (_a = document.querySelector('div.town_name')) === null || _a === void 0 ? void 0 : _a.textContent) !== null && _b !== void 0 ? _b : '';\n        return this.getCityByName(name);\n    }\n    getCityByName(name) {\n        return this.cityList.find(city => city.name === name);\n    }\n    getCityList() {\n        return this.cityList;\n    }\n    isRunning() {\n        return this.RUN;\n    }\n    run() {\n        this.RUN = true;\n    }\n    stop() {\n        // TODO: stop potential scheduled switchActions\n        this.RUN = false;\n    }\n}\nexports.default = CitySwitchManager;\nfunction sleep(arg0) {\n    throw new Error(\"Function not implemented.\");\n}\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst events_1 = __importDefault(require(\"events\"));\nconst gps_config_1 = require(\"../../../gps.config\");\nconst config_manager_1 = __importDefault(require(\"../../utility/config-manager\"));\nconst plain_utility_1 = require(\"../../utility/plain-utility\");\nconst ui_lock_1 = __importDefault(require(\"../../utility/ui-lock\"));\nconst ui_utility_1 = require(\"../../utility/ui-utility\");\nconst city_switch_manager_1 = __importDefault(require(\"../city/city-switch-manager\"));\nconst general_info_1 = __importDefault(require(\"../master/ui/general-info\"));\nvar FarmingSolution;\n(function (FarmingSolution) {\n    FarmingSolution[FarmingSolution[\"Captain\"] = 0] = \"Captain\";\n    FarmingSolution[FarmingSolution[\"Manual\"] = 1] = \"Manual\";\n})(FarmingSolution || (FarmingSolution = {}));\nclass FarmManager extends events_1.default {\n    constructor() {\n        super();\n        this.schedulerArray = [];\n        this.captainScheduler = null;\n        this.messageDialogObserver = null;\n        this.humanMessageDialogObserver = null;\n        this.farmSolution = FarmingSolution.Manual;\n        this.RUN = false;\n        this.scheduleNextFarmingOperationForCity = (timeInterval, city) => {\n            const scheduledDate = new Date(Date.now() + timeInterval);\n            const scheduleItem = {\n                scheduledDate,\n                timeout: null,\n                city\n            };\n            const timeout = setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                this.schedulerArray = this.schedulerArray.filter(item => item !== scheduleItem);\n                this.farmVillages(city);\n            }), timeInterval);\n            scheduleItem.timeout = timeout;\n            this.schedulerArray.push(scheduleItem);\n            console.log('scheduler:', this.schedulerArray);\n        };\n        /**\n         * Metoda jest odpowiedzią na blokadę farmienia wynikającą z konieczności potwierdzenia farmienia w przypadku pełengo magazynu.\n         * Metoda obserwuje czy pojawił się popup z promptem do potwierdzenia kontynuacji i klika akceptuj.\n         */\n        this.mountMessageDialogsObservers = (city) => __awaiter(this, void 0, void 0, function* () {\n            if (!this.messageDialogObserver) {\n                const observer = new MutationObserver((mutations) => __awaiter(this, void 0, void 0, function* () {\n                    for (const mutation of mutations) {\n                        if (mutation.type === 'childList') {\n                            for (const node of mutation.addedNodes) {\n                                if (node instanceof HTMLElement && node.getAttribute('class') === 'window_curtain ui-front show_curtain is_modal_window') {\n                                    yield (0, plain_utility_1.addDelay)(100);\n                                    const confirmButton = node.querySelector('.btn_confirm.button_new');\n                                    confirmButton.click();\n                                    return;\n                                }\n                            }\n                        }\n                    }\n                }));\n                this.messageDialogObserver = observer;\n                this.messageDialogObserver.observe(document.body, { childList: true });\n            }\n            if (!this.humanMessageDialogObserver && city) {\n                const observer = new MutationObserver((mutations) => __awaiter(this, void 0, void 0, function* () {\n                    for (const mutation of mutations) {\n                        if (mutation.type === 'childList') {\n                            observer.disconnect();\n                            yield city.switchAction();\n                        }\n                    }\n                }));\n                this.humanMessageDialogObserver = observer;\n                observer.observe(document.querySelector('#human_message'), { childList: true, subtree: true });\n            }\n            this.messageDialogObserver.observe(document.body, { childList: true });\n        });\n        // Private constructor to prevent direct instantiation\n    }\n    static getInstance() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!FarmManager.instance) {\n                FarmManager.instance = new FarmManager();\n                FarmManager.instance.generalInfo = general_info_1.default.getInstance();\n                FarmManager.instance.citySwitch = yield city_switch_manager_1.default.getInstance();\n                FarmManager.instance.config = config_manager_1.default.getInstance().getConfig();\n                FarmManager.instance.lock = ui_lock_1.default.getInstance();\n                yield FarmManager.instance.setFarmSolution();\n            }\n            return FarmManager.instance;\n        });\n    }\n    setFarmSolution() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const captainPresent = yield (0, ui_utility_1.waitForElement)('.advisor_frame.captain .advisor', 4000)\n                .then(el => el.classList.contains('captain_active'))\n                .catch(() => false);\n            this.farmSolution = captainPresent ? FarmingSolution.Captain : FarmingSolution.Manual;\n            // this.farmSolution = FarmingSolution.Manual;\n        });\n    }\n    // public async farmWithCaptain() {\n    //   try {\n    //     await this.lock.acquire('FarmManager.farmWithCaptain()');\n    //     this.generalInfo.showInfo('Farm Manager:', 'Farmienie z kapitanem.');\n    //     console.log('farmWithCaptain at ', new Date());\n    //     this.mountMessageDialogsObservers();\n    //     // opening farm overview\n    //     document.querySelector<HTMLElement>('[name=\"farm_town_overview\"]')!.click();\n    //     this.config.humanize ? await addDelay(getRandomMs(400, 1200)) : addDelay(100);\n    //     // end of opening farm overview\n    //     // checking if there is a cooldown\n    //     let cooldownWrapper = await waitForElementInterval('.ribbon_wrapper', { retries: 4, interval: 400 }).catch(() => {\n    //       throw new Error('cooldownWrapper not found, cannot proceed');\n    //     });\n    //     if (!cooldownWrapper.classList.contains('hidden')) {\n    //       console.log('cooldownWrapper found, not hidden');\n    //       let cooldownText;\n    //       while (!(cooldownText = cooldownWrapper.querySelector('.ribbon_locked .unlock_time')?.textContent)) {\n    //         await addDelay(333);\n    //       }\n    //       const cooldownTimeTextParsed = cooldownText.match(/\\d{2}:\\d{2}:\\d{2}/)?.[0];\n    //       const timeout = calculateTimeToNextOccurrence(cooldownTimeTextParsed!) + 5000;\n    //       const scheduledDate = new Date(Date.now() + timeout);\n    //       console.log('schedule next farming operation for captain on:', scheduledDate);\n    //       const scheduleTimeout = setTimeout(() => {\n    //         console.log('performing scheduled farming operation for captain, at:', formatDateToSimpleString(new Date()));\n    //         this.farmWithCaptain();\n    //       }, timeout);\n    //       this.captainScheduler = {\n    //         scheduledDate,\n    //         timeout: scheduleTimeout\n    //       }\n    //       document.querySelector<HTMLElement>('.ui-dialog-titlebar-close')?.click();\n    //       return;\n    //     }\n    //     // end of checking if there is a cooldown\n    //     // selecting cities\n    //     await waitForElement('#fto_town_wrapper .checkbox.select_all', 2000).then(el => el.click());\n    //     console.log('clicked select all');\n    //     this.config.humanize ? await addDelay(getRandomMs(400, 1200)) : null;\n    //     this.config.farmingCities.forEach(city => {\n    //       for (const cityLabel of document.querySelectorAll<HTMLElement>(`#fto_town_wrapper .gp_town_link`)) {\n    //         if (cityLabel.textContent === city.name) {\n    //           const checbkox = cityLabel.parentElement!.querySelector<HTMLElement>('.checkbox.town_checkbox')!;\n    //           if (!checbkox.classList.contains('checked')) {\n    //             checbkox.click();\n    //             break;\n    //           }\n    //         }\n    //       }\n    //     })\n    //     console.log('select farming cities');\n    //     // end of selecting cities\n    //     //selecting farm option\n    //     console.log('select farm options');\n    //     await addDelay(500);\n    //     const farmOptions = document.querySelectorAll<HTMLElement>('.fto_time_checkbox')!;\n    //     const farmOptionIndex = this.getFarmOptionIndex()!;\n    //     farmOptions[farmOptionIndex].click();\n    //     this.config.humanize ? await addDelay(getRandomMs(400, 1200)) : addDelay(100);\n    //     farmOptions[farmOptionIndex + 4]?.click();\n    //     this.config.humanize ? await addDelay(getRandomMs(400, 1200)) : addDelay(100);\n    //     // end of selecting farm option\n    //     // collecting resources\n    //     console.log('collecting resources');\n    //     document.querySelector<HTMLElement>('#fto_claim_button')!.click();\n    //     this.config.humanize ? await addDelay(getRandomMs(400, 1200)) : addDelay(100);\n    //     // end of collecting resources\n    //     // finding new cooldown\n    //     console.log('finding new cooldown');\n    //     let newCooldownText;\n    //     while (!(newCooldownText = document.querySelector('.ribbon_wrapper .ribbon_locked .unlock_time')?.textContent?.trim())) {\n    //       await addDelay(333);\n    //     }\n    //     // end of finding new cooldown\n    //     // calculating time to next occurrence\n    //     const newCooldownTextParsed = newCooldownText!.match(/\\d{2}:\\d{2}:\\d{2}/)?.[0];\n    //     const timeout = calculateTimeToNextOccurrence(newCooldownTextParsed!) + 5000;\n    //     const scheduledDate = new Date(Date.now() + timeout);\n    //     console.log('schedule next farming operation for captain on:', scheduledDate);\n    //     const scheduleTimeout = setTimeout(() => {\n    //       console.log('performing scheduled farming operation for captain, at:', formatDateToSimpleString(new Date()));\n    //       this.farmWithCaptain();\n    //     }, timeout);\n    //     this.captainScheduler = {\n    //       scheduledDate,\n    //       timeout: scheduleTimeout\n    //     }\n    //     document.querySelector<HTMLElement>('.ui-dialog-titlebar-close')?.click();\n    //   } catch (e) {\n    //     console.warn('FarmManager.farmWithCaptain().catch', e);\n    //   } finally {\n    //     console.log('captain scheduler:', this.captainScheduler);\n    //     this.disconnectObservers();\n    //     this.generalInfo.hideInfo();\n    //     this.lock.release();\n    //   }\n    // }\n    farmWithCaptain() {\n        return __awaiter(this, arguments, void 0, function* (scheduled = false) {\n            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k;\n            try {\n                yield this.lock.acquire('FarmManager.farmWithCaptain()');\n                this.generalInfo.showInfo('Farm Manager:', 'Farmienie z kapitanem.');\n                console.log('farmWithCaptain at ', new Date());\n                this.mountMessageDialogsObservers();\n                // opening farm overview\n                document.querySelector('[name=\"farm_town_overview\"]').click();\n                this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                // end of opening farm overview\n                if (!scheduled) {\n                    // checking if there is a cooldown\n                    let cooldownWrapper = yield (0, ui_utility_1.waitForElementInterval)('.ribbon_wrapper', { retries: 4, interval: 400 }).catch(() => {\n                        throw new Error('cooldownWrapper not found, cannot proceed');\n                    });\n                    if (!cooldownWrapper.classList.contains('hidden')) {\n                        console.log('cooldownWrapper found, not hidden');\n                        let cooldownText;\n                        while (!(cooldownText = (_a = cooldownWrapper.querySelector('.ribbon_locked .unlock_time')) === null || _a === void 0 ? void 0 : _a.textContent)) {\n                            yield (0, plain_utility_1.addDelay)(333);\n                        }\n                        const cooldownTimeTextParsed = (_b = cooldownText.match(/\\d{2}:\\d{2}:\\d{2}/)) === null || _b === void 0 ? void 0 : _b[0];\n                        const timeout = (0, plain_utility_1.calculateTimeToNextOccurrence)(cooldownTimeTextParsed) + this.config.general.timeDifferenceBackwards + 1000;\n                        const scheduledDate = new Date(Date.now() + timeout);\n                        console.log('schedule next farming operation for captain on:', scheduledDate);\n                        const scheduleTimeout = setTimeout(() => {\n                            console.log('performing scheduled farming operation for captain, at:', (0, plain_utility_1.formatDateToSimpleString)(new Date()));\n                            this.farmWithCaptain(true);\n                        }, timeout);\n                        this.captainScheduler = {\n                            scheduledDate,\n                            timeout: scheduleTimeout\n                        };\n                        (_c = document.querySelector('.ui-dialog-titlebar-close')) === null || _c === void 0 ? void 0 : _c.click();\n                        return;\n                    }\n                }\n                // end of checking if there is a cooldown\n                while ((_d = document.querySelector('#fto_town_wrapper .button.button_new')) === null || _d === void 0 ? void 0 : _d.classList.contains('disabled')) {\n                    yield (0, plain_utility_1.addDelay)(500);\n                }\n                // selecting cities\n                console.log('clicked select all');\n                yield (0, ui_utility_1.waitForElementInterval)('#fto_town_wrapper .checkbox.select_all', { retries: 4, interval: 500 })\n                    .then(el => el.click())\n                    .then(() => __awaiter(this, void 0, void 0, function* () {\n                    var _a;\n                    while (!((_a = document.querySelector('#fto_town_wrapper .checkbox.select_all')) === null || _a === void 0 ? void 0 : _a.classList.contains('checked'))) {\n                        yield (0, plain_utility_1.addDelay)(500);\n                    }\n                }));\n                this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : null;\n                const allCityLabels = document.querySelectorAll(`#fto_town_wrapper .gp_town_link`);\n                for (const city of this.config.farmConfig.farmingCities) {\n                    for (const cityLabel of allCityLabels) {\n                        if (cityLabel.textContent === city.name) {\n                            const checbkox = cityLabel.parentElement.querySelector('.checkbox.town_checkbox');\n                            if (!checbkox.classList.contains('checked')) {\n                                console.log('clicking town checkbox', city.name);\n                                checbkox.click();\n                                yield (0, plain_utility_1.addDelay)(100);\n                                break;\n                            }\n                        }\n                    }\n                }\n                // end of selecting cities\n                //selecting farm option\n                console.log('select farm options');\n                yield (0, plain_utility_1.addDelay)(500);\n                const farmOptions = document.querySelectorAll('.fto_time_checkbox');\n                const farmOptionIndex = this.getFarmOptionIndex();\n                !farmOptions[farmOptionIndex].classList.contains('checked') && farmOptions[farmOptionIndex].click();\n                this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                !((_e = farmOptions[farmOptionIndex + 4]) === null || _e === void 0 ? void 0 : _e.classList.contains('checked')) && ((_f = farmOptions[farmOptionIndex + 4]) === null || _f === void 0 ? void 0 : _f.click());\n                this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                // end of selecting farm option\n                // collecting resources\n                console.log('collecting resources');\n                document.querySelector('#fto_claim_button').click();\n                this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                // end of collecting resources\n                // finding new cooldown\n                console.log('finding new cooldown');\n                let newCooldownText;\n                while (!(newCooldownText = (_h = (_g = document.querySelector('.ribbon_wrapper .ribbon_locked .unlock_time')) === null || _g === void 0 ? void 0 : _g.textContent) === null || _h === void 0 ? void 0 : _h.trim())) {\n                    yield (0, plain_utility_1.addDelay)(333);\n                }\n                // end of finding new cooldown\n                // calculating time to next occurrence\n                const newCooldownTextParsed = (_j = newCooldownText.match(/\\d{2}:\\d{2}:\\d{2}/)) === null || _j === void 0 ? void 0 : _j[0];\n                const timeout = (0, plain_utility_1.calculateTimeToNextOccurrence)(newCooldownTextParsed) + this.config.general.timeDifferenceBackwards + 1000;\n                const scheduledDate = new Date(Date.now() + timeout);\n                console.log('schedule next farming operation for captain on:', scheduledDate);\n                const scheduleTimeout = setTimeout(() => {\n                    console.log('performing scheduled farming operation for captain, at:', (0, plain_utility_1.formatDateToSimpleString)(new Date()));\n                    this.farmWithCaptain(true);\n                }, timeout);\n                this.captainScheduler = {\n                    scheduledDate,\n                    timeout: scheduleTimeout\n                };\n                (_k = document.querySelector('.ui-dialog-titlebar-close')) === null || _k === void 0 ? void 0 : _k.click();\n            }\n            catch (e) {\n                console.warn('FarmManager.farmWithCaptain().catch', e, 'will reschedule in 2 minutes');\n                this.captainScheduler = {\n                    timeout: setTimeout(() => {\n                        this.farmWithCaptain();\n                    }, 2 * 60 * 1000),\n                    scheduledDate: new Date(Date.now() + 2 * 60 * 1000)\n                };\n            }\n            finally {\n                console.log('captain scheduler:', this.captainScheduler);\n                this.disconnectObservers();\n                this.generalInfo.hideInfo();\n                this.lock.release();\n            }\n        });\n    }\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.RUN) {\n                console.log('FarmManager started');\n                this.RUN = true;\n                yield this.initFarmAllVillages();\n            }\n        });\n    }\n    /**\n     * Obecna implementacja. Sprawdzenie pierwszej wioski z brzegu, czy posiada czas oczekiwania.\n     * -jeżeli nie, farmienie wszystkich posiadanych wiosek na wyspie (bez względu na stan)\n     * -jeżeli tak (nawet jeżeli pozostałe nie mają czasu oczekiwania), ma miejsce oczekiwanie\n     *\n     * Sposób działania w przypadku wielu miast gracza:\n     * -Wzięcia locka raz na wszystkie miasta\n     * -iteracja przez wszystkie miasta (switchowanie miast)\n     * -farmienie jednym ciągiem tzn traktowanie, że wszystkie miasta mają zawsze ta samą strategię farmienia wiosek i są na tym samym czasie oczekiwania\n     *\n     * Alternatywne podejście\n     * -na każde miasto gracza jest osobny callback\n     *  :w efekcie każde miasto może farmić swoje wioski z potencjalnie innym odsępem czasowym\n     * -wszystkie wioski przypisane od miasta są traktowane jako jeden byt, czyli losowa wioska określa ten sam czas oczekiwania dla wszystkich innych\n     * -sposób przechodzenia między wioskami ten sam: inicjalna funkcja start, która bierze Locka raz na wszystkie iteracje miast\n     *  a potem farmienie przez callbacki\n     */\n    farmVillages(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                console.log('farmVillages, wait for lock', city.name);\n                yield this.lock.acquire();\n                this.generalInfo.showInfo('Farm Manager:', `farmienie w mieście: ${city.name}`);\n                console.log('farmVillages, take lock', city.name);\n                yield this.farmVillagesFlow(city);\n            }\n            catch (e) {\n                console.warn('FarmManager.farmVillages().catch', e);\n            }\n            finally {\n                this.disconnectObservers();\n                console.log('farmVillages, release lock', city.name);\n                this.generalInfo.hideInfo();\n                this.lock.release();\n                this.emit('farmingFinished');\n            }\n        });\n    }\n    /**\n     * Make sure, that if there are 2 or more cities on the same isle not to duplicate farming operation and scheduling.\n     * Although nothing bad or unpredictable will happen, it is a waste of resources.\n     * Solution\n     * :store villages unique selectors, and check if previous ones (on condtition that there is more than 1 village) are not the same.\n     *  -if previous ones are the same, omit\n     *  -else allow normal flow\n     */\n    farmVillagesFlow(city_1) {\n        return __awaiter(this, arguments, void 0, function* (city, forced = false) {\n            var _a;\n            try {\n                console.log('farmVillagesFlow, switch to city', city.name, new Date());\n                yield city.switchAction();\n                let timeout = this.config.farmConfig.farmInterval;\n                this.config.farmConfig.humanize ? (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(333);\n                // Selectors mapping and timeout check\n                const villages = yield (0, ui_utility_1.waitForElementsInterval)('a.owned.farm_town[data-same_island=\"true\"]', { timeout: 3000 }).catch(() => null);\n                console.log('\\t-villages to farm:', villages === null || villages === void 0 ? void 0 : villages.length);\n                if (!villages || villages.length === 0)\n                    return;\n                const villageStyleSelectors = Array.from(villages).map(v => {\n                    return `[style=\"${v.getAttribute('style')}\"]`;\n                });\n                const villagesAmount = villageStyleSelectors.length;\n                this.mountMessageDialogsObservers(city);\n                for (const [i, villageSelector] of villageStyleSelectors.entries()) {\n                    console.log(`\\t-checking village: ${i}, from town: ${city.name}`);\n                    let counter = 0;\n                    do {\n                        console.log('\\t-clicking village element on the map', counter);\n                        yield (0, ui_utility_1.performComplexClick)(document.querySelector(villageSelector));\n                        console.log('\\t-clicked village element on the map', counter);\n                        yield (0, plain_utility_1.addDelay)(100);\n                        if (counter === 3)\n                            throw new Error('Farm villages dialog didn\\'t show up');\n                        counter++;\n                    } while (!(yield (0, ui_utility_1.waitForElementInterval)('.farm_towns', { retries: 3, interval: 500 }).catch(() => false)));\n                    this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                    const farmOptionIndex = this.getFarmOptionIndex();\n                    counter = 0;\n                    do {\n                        console.log('\\t-clicking farm button', counter);\n                        yield (0, ui_utility_1.waitForElements)('.btn_claim_resources.button.button_new', 500)\n                            .then((els) => els[farmOptionIndex].click())\n                            .catch(() => { });\n                        console.log('\\t-clicked farm button', counter);\n                        if (counter === 3)\n                            throw new Error('Farm button not found');\n                        counter++;\n                        yield (0, plain_utility_1.addDelay)(100);\n                    } while (!(yield (0, ui_utility_1.waitForElement)('.actions_locked_banner.cooldown', 1500).catch(() => false)));\n                    this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                    if (i === villagesAmount - 1) {\n                        timeout = (_a = yield this.getUnlockTimeOrNull(yield (0, ui_utility_1.waitForElement)('.farm_towns'), 2000)) !== null && _a !== void 0 ? _a : this.config.farmConfig.farmInterval;\n                    }\n                    console.log('\\t-closing village window');\n                    yield (0, ui_utility_1.waitForElement)('.btn_wnd.close', 2000).then(el => el.click()).catch(() => { });\n                    console.log('\\t-closed village window');\n                    this.config.farmConfig.humanize ? yield (0, plain_utility_1.addDelay)((0, plain_utility_1.getRandomMs)(400, 1200)) : (0, plain_utility_1.addDelay)(100);\n                }\n                this.disconnectObservers();\n                this.scheduleNextFarmingOperationForCity(timeout + 1000, city);\n            }\n            catch (e) {\n                console.warn('FarmManager.farmVillagesFlow().catch', e);\n                yield this.forceRepeatFarming(city);\n            }\n        });\n    }\n    /**\n     * Bierze locka, iteruje przez wszystkie miasta, farmi wszystkie wioski danego miasta, dodaje osobnego callbacka dla każdego miasta.\n     * Po przejściu powraca do pierwszego miasta, zwraca locka, a wioski będą farmione przez osobną metodę: 'farmVillages'.\n     */\n    initFarmAllVillages() {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            if (this.farmSolution === FarmingSolution.Captain) {\n                yield this.farmWithCaptain();\n            }\n            else {\n                const cityList = this.config.farmConfig.farmingCities.map(city => this.citySwitch.getCityList().find(c => c.name === city.name));\n                try {\n                    console.log('initFarmAllVillages, wait for lock', new Date());\n                    yield this.lock.acquire('FarmManager.initFarmAllVillages()');\n                    this.generalInfo.showInfo('Farm Manager:', 'Inicjalizacja/farmienie wszystkich wiosek.');\n                    console.log('initFarmAllVillages, take lock', new Date());\n                    for (const cityInfo of cityList) {\n                        yield this.farmVillagesFlow(cityInfo);\n                    }\n                    if (cityList.length !== 1)\n                        yield cityList[0].switchAction();\n                }\n                catch (e) {\n                    console.warn('FarmManager.initFarmAllVillages().catch', e);\n                }\n                finally {\n                    this.generalInfo.hideInfo();\n                    this.lock.release();\n                    (_a = this.messageDialogObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n                    this.emit('farmingFinished');\n                }\n            }\n        });\n    }\n    forceRepeatFarming(city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield city.switchAction();\n            yield this.farmVillagesFlow(city, true);\n        });\n    }\n    disconnectObservers() {\n        var _a, _b;\n        (_a = this.messageDialogObserver) === null || _a === void 0 ? void 0 : _a.disconnect();\n        (_b = this.humanMessageDialogObserver) === null || _b === void 0 ? void 0 : _b.disconnect();\n    }\n    getUnlockTimeOrNull(window, timeout) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const cooldownBar = yield (0, ui_utility_1.waitForElementFromNode)(window, '.actions_locked_banner.cooldown', timeout !== null && timeout !== void 0 ? timeout : 500).catch(() => null);\n            if (cooldownBar) {\n                const unlcokTimeEl = cooldownBar.querySelector('.pb_bpv_unlock_time');\n                return new Promise((res, rej) => {\n                    let counter = 0;\n                    const getTextInterval = setInterval(() => {\n                        if (unlcokTimeEl === null || unlcokTimeEl === void 0 ? void 0 : unlcokTimeEl.textContent) {\n                            clearInterval(getTextInterval);\n                            console.log('next unlock time:', unlcokTimeEl.textContent);\n                            res((0, plain_utility_1.textToMs)(unlcokTimeEl.textContent));\n                        }\n                        else if (counter === 10) {\n                            clearInterval(getTextInterval);\n                            console.warn('nie znaleziono czasu odblokowania');\n                            res(null);\n                        }\n                        counter++;\n                    }, 100);\n                });\n            }\n            return null;\n        });\n    }\n    /**\n     * Depending on the length of the farm options, it returns the index of the farm option to click.\n     */\n    getFarmOptionIndex() {\n        switch (this.config.farmConfig.farmInterval) {\n            case gps_config_1.FarmTimeInterval.FirstOption:\n                return 0;\n            case gps_config_1.FarmTimeInterval.SecondOption:\n                return 1;\n            case gps_config_1.FarmTimeInterval.ThirdOption:\n                return 2;\n            case gps_config_1.FarmTimeInterval.FourthOption:\n                return 3;\n            default:\n                return 0;\n        }\n    }\n    getFarmOptionTimeRegex() {\n        switch (this.config.farmConfig.farmInterval) {\n            case gps_config_1.FarmTimeInterval.FirstOption:\n                return /(5|10)/;\n            case gps_config_1.FarmTimeInterval.SecondOption:\n                return /^(20|40)/;\n            case gps_config_1.FarmTimeInterval.ThirdOption:\n                return /^(1.*30|3\\D+)/;\n            case gps_config_1.FarmTimeInterval.FourthOption:\n                return /^(4|8)h/;\n            default:\n                return /^(5|10)/;\n        }\n    }\n    getFarmOption() {\n        return Array.from(document.querySelectorAll('.btn_claim_resources.button.button_new'))\n            .find((el) => { var _a; return this.getFarmOptionTimeRegex().test((_a = el.textContent) !== null && _a !== void 0 ? _a : ''); });\n    }\n    stop() {\n        this.RUN = false;\n        console.log('FarmManager stopped');\n        // manual related\n        this.schedulerArray.forEach(item => {\n            clearTimeout(item.timeout);\n        });\n        this.schedulerArray = [];\n        // captain related\n        this.captainScheduler && clearTimeout(this.captainScheduler.timeout);\n        this.captainScheduler = null;\n    }\n    isRunning() {\n        return this.RUN;\n    }\n}\nexports.default = FarmManager;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst gps_config_1 = require(\"../../../gps.config\");\nconst config_popup_1 = __importDefault(require(\"../../config-popup/config-popup\"));\nconst config_manager_1 = __importDefault(require(\"../../utility/config-manager\"));\nconst plain_utility_1 = require(\"../../utility/plain-utility\");\nconst city_builder_1 = __importDefault(require(\"../city/builder/city-builder\"));\nconst city_switch_manager_1 = __importDefault(require(\"../city/city-switch-manager\"));\nconst farm_manager_1 = __importDefault(require(\"../farm/farm-manager\"));\nconst Scheduler_1 = __importDefault(require(\"../scheduler/Scheduler\"));\nconst general_info_1 = __importDefault(require(\"./ui/general-info\"));\nclass MasterManager {\n    constructor() {\n        this.pausedManagersSnapshot = {\n            farmManager: false,\n            switchManager: false,\n            scheduler: false,\n            builder: false,\n        };\n        // Private constructor to prevent direct instantiation\n    }\n    static getInstance() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!MasterManager.instance) {\n                MasterManager.instance = new MasterManager();\n                MasterManager.instance.generalInfo = general_info_1.default.getInstance();\n                MasterManager.instance.config = config_manager_1.default.getInstance().getConfig();\n                MasterManager.instance.switchManager = yield city_switch_manager_1.default.getInstance();\n                MasterManager.instance.farmManager = yield farm_manager_1.default.getInstance();\n                MasterManager.instance.scheduler = yield Scheduler_1.default.getInstance();\n                MasterManager.instance.builder = yield city_builder_1.default.getInstance();\n                MasterManager.instance.initCaptchaPrevention();\n                MasterManager.instance.initRefreshUtility();\n                MasterManager.instance.initConfigDialog();\n            }\n            return MasterManager.instance;\n        });\n    }\n    initRefreshUtility(timeout) {\n        setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n            const scheduler = yield Scheduler_1.default.getInstance();\n            const canRefresh = !scheduler.isRunning() || scheduler.canSafelyRefresh();\n            if (canRefresh) {\n                console.log('canRefresh, will refresh', canRefresh);\n                console.log('timeout ?? this.config.general.applicationRefreshInterval', timeout !== null && timeout !== void 0 ? timeout : this.config.general.applicationRefreshInterval);\n                console.log('this.config.general.applicationRefreshInterval', this.config.general.applicationRefreshInterval);\n                this.config.general.forcedRefresh = true;\n                config_manager_1.default.getInstance().persistConfig();\n                yield (0, plain_utility_1.addDelay)(10000);\n                window.location.reload();\n            }\n            else {\n                console.log('canRefresh', canRefresh);\n                this.initRefreshUtility(5 * 1000 * 60);\n            }\n        }), timeout !== null && timeout !== void 0 ? timeout : (this.config.general.applicationRefreshInterval + (Math.floor(Math.random() * 121) - 60)) * 1000);\n    }\n    // id=\"recaptcha_window\"\n    // document.querySelector('[class=\"recaptcha-checkbox-border\"]')\n    // document.querySelector('#recaptcha_window [class=\"caption js-caption\"]').click()\n    initCaptchaPrevention() {\n        new MutationObserver((mutations) => __awaiter(this, void 0, void 0, function* () {\n            for (const mutation of mutations) {\n                if (mutation.type === 'childList') {\n                    const recaptchaWindow = document.querySelector('#recaptcha_window');\n                    const captchaCurtain = document.querySelector('#captcha_curtain');\n                    if (recaptchaWindow) {\n                        const checkbox = recaptchaWindow.querySelector('[class=\"recaptcha-checkbox-border\"]');\n                        if (checkbox) {\n                            yield (0, plain_utility_1.addDelay)(4000);\n                            checkbox.click();\n                            const caption = recaptchaWindow.querySelector('#recaptcha_window [class=\"caption js-caption\"]');\n                            if (caption) {\n                                yield (0, plain_utility_1.addDelay)(4000);\n                                caption.click();\n                            }\n                        }\n                    }\n                    else if (captchaCurtain) {\n                        const checkbox = captchaCurtain.querySelector('[class=\"captcha-checkbox-border\"]');\n                        if (checkbox) {\n                            yield (0, plain_utility_1.addDelay)(2000);\n                            checkbox.click();\n                            const caption = captchaCurtain.querySelector('#captcha_curtain [class=\"caption js-caption\"]');\n                            if (caption) {\n                                yield (0, plain_utility_1.addDelay)(2000);\n                                caption.click();\n                            }\n                        }\n                    }\n                }\n            }\n        })).observe(document.body, { childList: true });\n    }\n    runManagersFromConfig() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.configMenuWindow.isSwitchChecked()) {\n                if (!this.switchManager.isRunning()) {\n                    console.log('switchManager will be started...');\n                    this.switchManager.run();\n                }\n            }\n            else {\n                if (this.switchManager.isRunning()) {\n                    console.log('switchManager will be stopped...');\n                    this.switchManager.stop();\n                }\n            }\n            if (this.configMenuWindow.isBuilderChecked()) {\n                if (!this.builder.isRunning()) {\n                    console.log('Builder will be started...');\n                    this.builder.start();\n                }\n            }\n            else {\n                if (this.builder.isRunning()) {\n                    console.log('Builder will be stopped...');\n                    this.builder.stop();\n                }\n            }\n            if (this.configMenuWindow.isFarmChecked()) {\n                if (!this.farmManager.isRunning()) {\n                    console.log('FarmManager will be started...');\n                    yield this.farmManager.start();\n                }\n            }\n            else {\n                if (this.farmManager.isRunning()) {\n                    console.log('FarmManager will be stopped...');\n                    this.farmManager.stop();\n                }\n            }\n        });\n    }\n    initConfigDialog() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.configMenuWindow = new config_popup_1.default();\n            this.configMenuWindow.addListener('managersChange', () => __awaiter(this, void 0, void 0, function* () {\n                yield this.runManagersFromConfig();\n            }));\n            yield this.configMenuWindow.render();\n            if (this.config.general.forcedRefresh || GM_getValue('forceRestart')) {\n                console.log('forcedRefresh/forceRestart', this.config.general.forcedRefresh, GM_getValue('forceRestart'));\n                this.config.general.forcedRefresh = false;\n                GM_setValue('forceRestart', false);\n                this.config.farmConfig.farmInterval = gps_config_1.FarmTimeInterval.FirstOption;\n                config_manager_1.default.getInstance().persistConfig();\n                this.configMenuWindow.minimize();\n                yield this.runManagersFromConfig();\n            }\n        });\n    }\n    run() {\n        this.runManagersFromConfig();\n    }\n    pauseRunningManagers(except) {\n        if (!except.includes('farmManager') && this.farmManager.isRunning()) {\n            this.farmManager.stop();\n            this.pausedManagersSnapshot.farmManager = true;\n        }\n        if (!except.includes('switchManager') && this.switchManager.isRunning()) {\n            this.switchManager.stop();\n            this.pausedManagersSnapshot.switchManager = true;\n        }\n        if (!except.includes('scheduler') && this.scheduler.isRunning()) {\n            this.scheduler.stop();\n            this.pausedManagersSnapshot.scheduler = true;\n        }\n        if (!except.includes('builder') && this.builder.isRunning()) {\n            this.builder.stop();\n            this.pausedManagersSnapshot.builder = true;\n        }\n        console.log('pauseRunningManagers', this.pausedManagersSnapshot);\n    }\n    resumeRunningManagers(except) {\n        Object.entries(this.pausedManagersSnapshot).forEach(([key, isPaused]) => {\n            switch (key) {\n                case 'farmManager':\n                    if (isPaused && !except.includes('farmManager')) {\n                        this.farmManager.start();\n                    }\n                    break;\n                case 'switchManager':\n                    if (isPaused && !except.includes('switchManager')) {\n                        this.switchManager.run();\n                    }\n                    break;\n                case 'scheduler':\n                    if (isPaused && !except.includes('scheduler')) {\n                        this.scheduler.run();\n                    }\n                    break;\n                case 'builder':\n                    if (isPaused && !except.includes('builder')) {\n                        this.builder.start();\n                    }\n                    break;\n            }\n        });\n        Object.keys(this.pausedManagersSnapshot).forEach((key) => {\n            if (except.includes(key)) {\n                this.pausedManagersSnapshot[key] = false;\n            }\n        });\n    }\n    forceRefresh() {\n        this.config.general.forcedRefresh = true;\n        config_manager_1.default.getInstance().persistConfig();\n        window.location.reload();\n    }\n    stopAll() {\n        this.farmManager.stop();\n        this.switchManager.stop();\n        this.scheduler.stop();\n        this.builder.stop();\n    }\n}\nexports.default = MasterManager;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst general_info_css_1 = __importDefault(require(\"./general-info.css\"));\nconst info_template_html_1 = __importDefault(require(\"./info-template.html\"));\nclass GeneralInfo {\n    constructor() {\n        this.initInfoContainer();\n    }\n    static getInstance() {\n        if (!GeneralInfo.instance) {\n            GeneralInfo.instance = new GeneralInfo();\n        }\n        return GeneralInfo.instance;\n    }\n    initInfoContainer() {\n        console.log('initInfoContainer');\n        const style = document.createElement('style');\n        style.innerHTML = general_info_css_1.default;\n        document.head.appendChild(style);\n        const infoContainer = document.createElement('div');\n        infoContainer.innerHTML = info_template_html_1.default;\n        document.body.appendChild(infoContainer);\n    }\n    showInfo(title, text) {\n        const infoContainer = document.getElementById('info-container');\n        infoContainer.querySelector('.info-title').textContent = title;\n        infoContainer.querySelector('.info-text').textContent = text;\n        infoContainer.classList.remove('hidden');\n    }\n    hideInfo() {\n        const infoContainer = document.getElementById('info-container');\n        infoContainer.classList.add('hidden');\n    }\n}\nexports.default = GeneralInfo;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_manager_1 = __importDefault(require(\"../../utility/config-manager\"));\nconst plain_utility_1 = require(\"../../utility/plain-utility\");\nconst ui_utility_1 = require(\"../../utility/ui-utility\");\nclass ResourceManager {\n    constructor() {\n        var _a, _b, _c, _d, _e, _f;\n        this.configManager = config_manager_1.default.getInstance();\n        // NOTE: error with fetching this conig data ! probabaly storage sinchronization problem\n        this.minPopulationBuffer = (_c = (_b = (_a = this.configManager.getConfig()) === null || _a === void 0 ? void 0 : _a.resources) === null || _b === void 0 ? void 0 : _b.minPopulationBuffer) !== null && _c !== void 0 ? _c : 100;\n        this.storeAlmostFullPercentage = (_f = (_e = (_d = this.configManager.getConfig()) === null || _d === void 0 ? void 0 : _d.resources) === null || _e === void 0 ? void 0 : _e.storeAlmostFullPercentage) !== null && _f !== void 0 ? _f : 0.9;\n    }\n    static getInstance() {\n        if (!ResourceManager.instance) {\n            ResourceManager.instance = new ResourceManager();\n        }\n        return this.instance;\n    }\n    start() {\n        return __awaiter(this, void 0, void 0, function* () {\n        });\n    }\n    stop() {\n    }\n    getStoreCapacity() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // let maxSizeElement: HTMLDivElement | null = null;\n            // do {\n            //   triggerHover(document.querySelector<HTMLDivElement>('[data-type=\"wood\"] .amount.ui-game-selectable')!);\n            //   await addDelay(100);\n            // } while (!(maxSizeElement = document.querySelector<HTMLDivElement>('.island_resource_info span:nth-of-type(2)')))\n            var _a, _b;\n            (0, ui_utility_1.triggerHover)(document.querySelector('[data-type=\"wood\"] .amount.ui-game-selectable'));\n            const maxSizeText = yield (0, ui_utility_1.waitForElement)('.island_resource_info span:nth-of-type(2)');\n            const storeMaxSize = parseInt(((_b = (_a = maxSizeText === null || maxSizeText === void 0 ? void 0 : maxSizeText.textContent) === null || _a === void 0 ? void 0 : _a.match(/\\d+/)) === null || _b === void 0 ? void 0 : _b[0]) || '0');\n            (0, ui_utility_1.cancelHover)(document.querySelector('[data-type=\"wood\"] .amount.ui-game-selectable'));\n            return storeMaxSize;\n        });\n    }\n    getPopulation() {\n        const population = Number(document.querySelector('[data-type=\"population\"] .amount.ui-game-selectable').textContent);\n        return population;\n    }\n    getResourcesInfo() {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            const wood = Number((yield (0, ui_utility_1.waitForElement)('[data-type=\"wood\"] .amount.ui-game-selectable')).textContent);\n            const stone = Number((yield (0, ui_utility_1.waitForElement)('[data-type=\"stone\"] .amount.ui-game-selectable')).textContent);\n            const iron = Number((yield (0, ui_utility_1.waitForElement)('[data-type=\"iron\"] .amount.ui-game-selectable')).textContent);\n            const population = Number((yield (0, ui_utility_1.waitForElement)('[data-type=\"population\"] .amount.ui-game-selectable')).textContent);\n            const resourceItem = yield (0, ui_utility_1.waitForElement)('[data-type=\"wood\"] .amount.ui-game-selectable');\n            let maxSizeElement = null;\n            do {\n                (0, ui_utility_1.triggerHover)(resourceItem);\n                yield (0, plain_utility_1.addDelay)(333);\n            } while (!(maxSizeElement = document.querySelector('.island_resource_info span:nth-of-type(2)')));\n            const maxSizeText = maxSizeElement.textContent;\n            const storeMaxSize = parseInt(((_a = maxSizeText === null || maxSizeText === void 0 ? void 0 : maxSizeText.match(/\\d+/)) === null || _a === void 0 ? void 0 : _a[0]) || '0');\n            (0, ui_utility_1.cancelHover)(resourceItem);\n            const resourcesInfo = {\n                wood: {\n                    amount: wood,\n                    isAlmostFull: wood > this.storeAlmostFullPercentage * storeMaxSize,\n                    isFull: wood === storeMaxSize,\n                },\n                stone: {\n                    amount: stone,\n                    isAlmostFull: stone > this.storeAlmostFullPercentage * storeMaxSize,\n                    isFull: stone === storeMaxSize,\n                },\n                iron: {\n                    amount: iron,\n                    isAlmostFull: iron > this.storeAlmostFullPercentage * storeMaxSize,\n                    isFull: iron === storeMaxSize,\n                },\n                population: {\n                    amount: population,\n                    isLow: population < this.minPopulationBuffer,\n                },\n                storeMaxSize\n            };\n            return resourcesInfo;\n        });\n    }\n    hasEnoughResources(requiredResources, city) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield city.switchAction();\n            const wood = Number(document.querySelector('[data-type=\"wood\"] .amount.ui-game-selectable').textContent);\n            const stone = Number(document.querySelector('[data-type=\"stone\"] .amount.ui-game-selectable').textContent);\n            const iron = Number(document.querySelector('[data-type=\"iron\"] .amount.ui-game-selectable').textContent);\n            return wood >= requiredResources.wood && stone >= requiredResources.stone && iron >= requiredResources.iron;\n        });\n    }\n}\nexports.default = ResourceManager;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst config_manager_1 = __importDefault(require(\"../../utility/config-manager\"));\nconst plain_utility_1 = require(\"../../utility/plain-utility\");\nconst ui_lock_1 = __importDefault(require(\"../../utility/ui-lock\"));\nconst ui_utility_1 = require(\"../../utility/ui-utility\");\nconst army_movement_1 = __importDefault(require(\"../army/army-movement\"));\nconst city_switch_manager_1 = __importDefault(require(\"../city/city-switch-manager\"));\nconst master_manager_1 = __importDefault(require(\"../master/master-manager\"));\nconst general_info_1 = __importDefault(require(\"../master/ui/general-info\"));\nconst button_panel_extension_html_1 = __importDefault(require(\"./button-panel-extension.html\"));\nconst scheduler_list_prod_html_1 = __importDefault(require(\"./scheduler-list-prod.html\"));\nconst scheduler_list_css_1 = __importDefault(require(\"./scheduler-list.css\"));\nvar OperationType;\n(function (OperationType) {\n    OperationType[OperationType[\"ARMY_ATTACK\"] = 0] = \"ARMY_ATTACK\";\n    OperationType[OperationType[\"ARMY_SUPPORT\"] = 1] = \"ARMY_SUPPORT\";\n    OperationType[OperationType[\"ARMY_WITHDRAW\"] = 2] = \"ARMY_WITHDRAW\";\n    OperationType[OperationType[\"RESOURCE_SHIPMENT\"] = 3] = \"RESOURCE_SHIPMENT\";\n})(OperationType || (OperationType = {}));\nclass Scheduler {\n    constructor() {\n        this.isLockTakenByScheduler = false;\n        this.scheduler = [];\n        this._error = null;\n        this._hydrationError = null;\n        this._info = null;\n        this.RUN = true;\n    }\n    privateconstructor() { }\n    static getInstance() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!Scheduler.instance) {\n                Scheduler.instance = new Scheduler();\n                Scheduler.instance.lock = ui_lock_1.default.getInstance();\n                Scheduler.instance.generalInfo = general_info_1.default.getInstance();\n                Scheduler.instance.armyMovement = army_movement_1.default.getInstance();\n                Scheduler.instance.masterManager = yield master_manager_1.default.getInstance();\n                Scheduler.instance.citySwitchManager = yield city_switch_manager_1.default.getInstance();\n                Scheduler.instance.config = config_manager_1.default.getInstance().getConfig();\n                Scheduler.instance.addUIExtenstion();\n                Scheduler.instance.addSchedulerListConfigWindow();\n                Scheduler.instance.synchronizeSchedulerWithStorage();\n            }\n            return Scheduler.instance;\n        });\n    }\n    addUIExtenstion() {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.mountCityDialogObserver();\n        });\n    }\n    run() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.RUN = true;\n        });\n    }\n    stop() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.RUN = false;\n        });\n    }\n    isRunning() {\n        return this.RUN;\n    }\n    /**\n     * Potrzebny będzie dodatkowy identyfikator ruchu, ponieważ z danego miasta, do danego miasta może miec miejsce wiele ruchów\n     * i wówczas może zostać anulowany zły ruch. Nie jest to zatem bezpieczna metoda na tą chilę.\n     * Możliwe rozwiązania:\n     * -Mozna zamontować obserwera ruchów wojsk, przekażać mu samo usuwającego się callbacka, któyry otrzyma informację o najnowszym ruchu\n     *  np. unikalne [id=\"movement_1820489002\"], które zostanie przypisane do danego obiektu ruchu. Wówczas cancelowanie ruchów, będzie odbywało się\n     *  po tym id. Przed przypisaniem 'movementId' do obiektu schedulera, będzie miało miejsce sprawdzenie czy parametry ataku się zgadzają, na wypadek, gdyby\n     *  najbliższym ruchem się okazała napaść na wioskę (której nie da się anulować bo nie należy do właściciela)\n     */\n    undoArmyMovement(fromTown, id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a;\n            yield fromTown.switchAction();\n            yield (0, plain_utility_1.addDelay)(100);\n            const hoverElement = document.querySelector('#toolbar_activity_commands');\n            (0, ui_utility_1.triggerHover)(hoverElement);\n            (_a = document.querySelector(`#${id}`)) === null || _a === void 0 ? void 0 : _a.click();\n        });\n    }\n    /**\n     * Ma rozpoznawać, czy znajduje się na karcie ATAK/OBRONA\n     * Ma dodać schdule button i inputy do podania czasu wykonania operacji.\n     * Na schedule click:\n     * -zczytać i zapamiętać wartości imputów\n     * -zczytać czas podróży jednostek i obliczyć na podstawie tych danych timeout\n     * -zczytać wioskę źródłową oraz gridy wioski na której operacja ma być wykonana\n     * -dodać obiekt ScheduleItem do listy oraz do LocaleStorage oraz ustawic timeout\n     * -timeout powinien usunąć wszstko co z nim związane powykonaniu operacji\n     */\n    extendAttackSupportUI(node) {\n        return __awaiter(this, void 0, void 0, function* () {\n            // observer mounted, argument is the grand parent of the button panel\n            const buttonWrapper = node.querySelector('.button_wrapper');\n            const div = document.createElement('div');\n            div.innerHTML = button_panel_extension_html_1.default;\n            buttonWrapper.appendChild(div);\n            // Element ready, logic below:\n            const inputDateElement = document.querySelector('#schedule-date');\n            // prefill date input with current date\n            inputDateElement.value = this.getFormattedInputValueFromDate(new Date());\n            const scheduleButton = div.querySelector('#schedule-button');\n            scheduleButton.addEventListener('click', () => __awaiter(this, void 0, void 0, function* () {\n                var _a, _b;\n                this.error = null;\n                // get way duration time\n                const wayDurationText = node.querySelector('.way_duration').textContent.slice(1);\n                const wayDurationMs = (0, plain_utility_1.textToMs)(wayDurationText);\n                // get input data (all unit inputs)\n                const inputData = Array.from(node.querySelectorAll('.unit_input')).map(inputEl => {\n                    return {\n                        name: inputEl.getAttribute('name'),\n                        value: inputEl.value\n                    };\n                });\n                const operationType = node.firstElementChild.getAttribute('data-type') === 'attack' ? OperationType.ARMY_ATTACK : OperationType.ARMY_SUPPORT;\n                const attackTypeSelector = operationType === OperationType.ARMY_ATTACK ?\n                    (`[data-attack='${(_a = document.querySelector('.attack_type.checked')) === null || _a === void 0 ? void 0 : _a.dataset['attack']}']`) : undefined;\n                const inputDateValue = inputDateElement.value;\n                // Wartość z inputu type=\"date\" będzie w formacie \"YYYY-MM-DD\"\n                // Na przykład: \"2023-05-25\" dla 25 maja 2023\n                // #schedule-time      \n                const inputTimeValue = document.querySelector('#schedule-time').value;\n                const targetDate = this.getDateFromDateTimeInputValues(inputDateValue, inputTimeValue);\n                const actionDate = new Date(targetDate.getTime() - wayDurationMs);\n                const sourceCity = this.citySwitchManager.getCurrentCity();\n                // attack_support_tab_target_9542\n                const targetCitySelector = '#town_' + Array.from(node.classList).find(cls => cls.match(/attack_support_tab_target_\\d+/)).match(/\\d+/)[0];\n                if (!this.canAddSchedulerItem(actionDate)) {\n                    console.warn('unsafe operation, failed to be scheudled');\n                    this.error = 'Schedule failed. Cannot safely schedule operation.';\n                    return;\n                }\n                // jezeli inputy nie są wypełnione, nie dodawaj do schedulera\n                if (!inputData.some(data => data.value)) {\n                    this.error = 'Schedule failed. All units are empty.';\n                    return;\n                }\n                document.querySelector('[data-menu_name=\"Info\"]').click();\n                yield (0, plain_utility_1.addDelay)(100);\n                const targetCityName = yield (0, ui_utility_1.waitForElementInterval)('#towninfo_towninfo .game_header.bold', { interval: 500, timeout: 2000 }).then(el => el.textContent.trim());\n                const id = `${operationType}_${sourceCity.name}_${targetCityName}_${actionDate.getTime()}`;\n                yield (0, ui_utility_1.waitForElementInterval)('.info_jump_to_town', { interval: 500, retries: 3 })\n                    .then(el => el.click())\n                    .catch(() => {\n                    this.error = 'Schedule failed. Failed to switch to the city for grids.';\n                    return;\n                });\n                (yield (0, ui_utility_1.waitForElements)('.minimized_windows_area .btn_wnd.close', 2000)).forEach(el => el.click());\n                yield (0, plain_utility_1.addDelay)(500);\n                (_b = document.querySelector('.btn_save_location')) === null || _b === void 0 ? void 0 : _b.click();\n                yield (0, plain_utility_1.addDelay)(100);\n                yield (0, ui_utility_1.waitForElement)('.save_coordinates input', 4000)\n                    .then(el => {\n                    (0, ui_utility_1.setInputValue)(el, id);\n                    el.blur();\n                })\n                    .catch(() => { throw new Error('Failed to save coordinates'); });\n                yield (0, plain_utility_1.addDelay)(100);\n                yield (0, ui_utility_1.waitForElement)('.save_coordinates .btn_confirm', 3000)\n                    .then(el => el.click())\n                    .catch(() => { throw new Error('Failed to confirm saving coordinates'); });\n                const scheduleTimeout = {\n                    timeoutPreparation: null,\n                    timeoutPreAction: null,\n                    timeoutAction: null,\n                };\n                const schedulerItem = {\n                    id: id,\n                    operationType: operationType,\n                    attackTypeSelector: attackTypeSelector,\n                    targetDate: targetDate,\n                    targetCityName: targetCityName,\n                    actionDate: actionDate,\n                    sourceCity: sourceCity,\n                    targetCitySelector: targetCitySelector,\n                    data: inputData,\n                    timeoutStructure: scheduleTimeout,\n                    movementId: null,\n                    undoMovementAction: null,\n                    cancelSchedule: () => __awaiter(this, void 0, void 0, function* () { return yield this.cancelSchedule(schedulerItem); }),\n                    postActionCleanup: () => __awaiter(this, void 0, void 0, function* () { return yield this.postActionCleanup(schedulerItem); }),\n                };\n                this.addActionTimeouts(schedulerItem);\n                this.scheduler.push(schedulerItem);\n                this.addSchedulerItemToUI(schedulerItem);\n                localStorage.setItem('scheduler', JSON.stringify(this.scheduler));\n                this.info = 'Operation scheduled';\n                console.log('Scheduler.extendAttackSupportUI.schedulerItem', schedulerItem);\n            }));\n        });\n    }\n    postActionCleanup(schedulerItem) {\n        return __awaiter(this, void 0, void 0, function* () {\n            setTimeout(() => {\n                this.removeSchedulerItemFromUI(schedulerItem);\n                this.scheduler = this.scheduler.filter((item) => item !== schedulerItem);\n                localStorage.setItem('scheduler', JSON.stringify(this.scheduler));\n            }, 0);\n            if (this.isLockTakenByScheduler)\n                this.lock.release();\n            this.isLockTakenByScheduler = false;\n            this.generalInfo.showInfo('Scheduler:', 'Czyszczenie cache po operacji.');\n            yield this.removeSavedCoords(schedulerItem.id);\n            this.generalInfo.hideInfo();\n            this.tryRestoreManagers();\n        });\n    }\n    cancelSchedule(schedulerItem) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.generalInfo.showInfo('Scheduler:', 'Anulowanie operacji.');\n            const { timeoutStructure } = schedulerItem;\n            if (timeoutStructure.timeoutPreparation)\n                clearTimeout(timeoutStructure.timeoutPreparation);\n            if (timeoutStructure.timeoutPreAction)\n                clearTimeout(timeoutStructure.timeoutPreAction);\n            if (timeoutStructure.timeoutAction)\n                clearTimeout(timeoutStructure.timeoutAction);\n            if (this.isLockTakenByScheduler) {\n                this.lock.release();\n                this.isLockTakenByScheduler = false;\n            }\n            this.scheduler = this.scheduler.filter(item => item !== schedulerItem);\n            localStorage.setItem('scheduler', JSON.stringify(this.scheduler));\n            this.removeSchedulerItemFromUI(schedulerItem);\n            yield this.removeSavedCoords(schedulerItem.id);\n            this.generalInfo.hideInfo();\n            this.tryRestoreManagers();\n        });\n    }\n    removeSavedCoords(id) {\n        return __awaiter(this, void 0, void 0, function* () {\n            var _a, _b;\n            (_b = (_a = Array.from(document.querySelectorAll('.content.js-dropdown-item-list .item.bookmark'))\n                .find(el => { var _a; return ((_a = el.textContent) === null || _a === void 0 ? void 0 : _a.trim()) === id; })) === null || _a === void 0 ? void 0 : _a.querySelector('.remove')) === null || _b === void 0 ? void 0 : _b.click();\n            yield (0, ui_utility_1.waitForElementInterval)('.confirmation .btn_confirm', { interval: 500, timeout: 2000 })\n                .then(el => el.click());\n        });\n    }\n    readCords() {\n        const gridXInput = document.querySelector('.coord.coord_x.js-coord-x input[type=\"text\"]');\n        const gridYInput = document.querySelector('.coord.coord_y.js-coord-y input[type=\"text\"]');\n        return [gridXInput.value, gridYInput.value];\n    }\n    addActionTimeouts(schedulerItem) {\n        const { actionDate, timeoutStructure, targetCitySelector, data: inputData, operationType, attackTypeSelector } = schedulerItem;\n        const preparationTime = actionDate.getTime() - new Date().getTime() - Scheduler.TURN_OFF_MANAGERS_TIME_MS;\n        timeoutStructure.timeoutPreparation = setTimeout(() => {\n            this.generalInfo.showInfo('Scheduler:', 'pauzowanie uruchomionych managarów przed operacją.');\n            // console.log('NOW half minute before action, time is:', formatDateToSimpleString(new Date()))\n            this.masterManager.pauseRunningManagers(['scheduler']);\n            const tenSecondsBeforeAction = actionDate.getTime() - new Date().getTime() - 10 * 1000;\n            timeoutStructure.timeoutPreAction = setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                var _a, _b;\n                try {\n                    // console.log('NOW ten seconds before action, time is:', formatDateToSimpleString(new Date()), 'try take lock')\n                    yield this.lock.acquire();\n                    this.isLockTakenByScheduler = true;\n                    this.generalInfo.showInfo('Scheduler:', 'przygotowanie do operacji.');\n                    yield schedulerItem.sourceCity.switchAction();\n                    // przejdź do współrzędnych\n                    (_a = document.querySelector('.js-coord-button')) === null || _a === void 0 ? void 0 : _a.click();\n                    const dropdownList = yield (0, ui_utility_1.waitForElement)('.content.js-dropdown-item-list', 4000);\n                    const dropdownItem = Array.from(dropdownList.querySelectorAll(`.item.bookmark.option`))\n                        .find(el => { var _a; return ((_a = el.textContent) === null || _a === void 0 ? void 0 : _a.trim()) === schedulerItem.id; });\n                    if (!dropdownItem)\n                        throw new Error('Failed to find dropdown item');\n                    dropdownItem.click();\n                    yield (0, plain_utility_1.addDelay)(400);\n                    // znajdź wioskę i kliknij odpowiednią operację\n                    (_b = document.querySelector('.ui-dialog-titlebar-close')) === null || _b === void 0 ? void 0 : _b.click();\n                    (0, ui_utility_1.performComplexClick)(yield (0, ui_utility_1.waitForElementInterval)(targetCitySelector, { interval: 500, retries: 4 })\n                        .catch(() => { throw new Error('target city not found'); }));\n                    if (operationType === OperationType.ARMY_ATTACK) {\n                        (yield (0, ui_utility_1.waitForElementInterval)('#attack', { interval: 500, timeout: 2000 })).click();\n                        yield (0, ui_utility_1.waitForElementInterval)(attackTypeSelector, { interval: 500, timeout: 2000 }).then(el => el.click());\n                    }\n                    else {\n                        (yield (0, ui_utility_1.waitForElementInterval)('#support', { interval: 500, timeout: 2000 })).click();\n                    }\n                    // wypełnij inputy\n                    for (const data of inputData) {\n                        if (data.value) {\n                            const input = yield (0, ui_utility_1.waitForElementInterval)(`input[name=\"${data.name}\"]`, { interval: 500, timeout: 2000 });\n                            (0, ui_utility_1.setInputValue)(input, data.value);\n                            input.blur();\n                        }\n                    }\n                    ;\n                }\n                catch (error) {\n                    console.error('Error during 10 seconds before action:', error);\n                    this.error = 'Schedule failed. Check console for more details.';\n                    this.generalInfo.hideInfo();\n                    schedulerItem.cancelSchedule();\n                    return;\n                }\n                timeoutStructure.timeoutAction = setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                    var _a;\n                    try {\n                        // console.log('NOW ACTION, time is:', formatDateToSimpleString(new Date()))\n                        // console.log('now time + way duration:', formatDateToSimpleString(new Date(new Date().getTime() + wayDurationMs)))\n                        if (operationType === OperationType.ARMY_ATTACK) {\n                            (yield (0, ui_utility_1.waitForElement)('#btn_attack_town')).click();\n                        }\n                        else {\n                            (yield (0, ui_utility_1.waitForElement)('.attack_support_window a .middle')).click();\n                        }\n                        this.armyMovement.setCallback((id) => {\n                            schedulerItem.movementId = id;\n                            schedulerItem.undoMovementAction = () => this.undoArmyMovement(schedulerItem.sourceCity, id);\n                        });\n                        (_a = document.querySelector('.ui-dialog-titlebar-close')) === null || _a === void 0 ? void 0 : _a.click();\n                        this.error = null;\n                    }\n                    catch (error) {\n                        schedulerItem.cancelSchedule();\n                        console.error('Error during action:', error);\n                        this.error = 'Schedule failed. Check console for more details.';\n                    }\n                    finally {\n                        schedulerItem.postActionCleanup();\n                    }\n                }), actionDate.getTime() - new Date().getTime());\n            }), tenSecondsBeforeAction);\n        }, preparationTime);\n    }\n    goToCoords(coords) {\n        const gridXInput = document.querySelector('.coord.coord_x.js-coord-x input[type=\"text\"]');\n        const gridYInput = document.querySelector('.coord.coord_y.js-coord-y input[type=\"text\"]');\n        (0, ui_utility_1.setInputValue)(gridXInput, coords[0]);\n        (0, ui_utility_1.setInputValue)(gridYInput, coords[1]);\n        document.querySelector('.btn_jump_to_coordination').click();\n    }\n    /*\n    Wczytuje storage, w którym znajduje się niebędne info do wykonania timeoutów z planem operacji.\n    Iteruje po każdym itemie i uzupełnia jego objekt o id timeoutów, oraz funkcję do anulowania operacji.\n    */\n    synchronizeSchedulerWithStorage() {\n        const storageScheduler = JSON.parse(localStorage.getItem('scheduler') || '[]');\n        storageScheduler.forEach(schedulerItem => this.hydrateSchedulerItem(schedulerItem));\n        this.handleIfSchedulerListIsEmpty();\n    }\n    hydrateSchedulerItem(schedulerItem) {\n        if (schedulerItem.operationType === OperationType.ARMY_ATTACK || schedulerItem.operationType === OperationType.ARMY_SUPPORT) {\n            schedulerItem.actionDate = new Date(schedulerItem.actionDate);\n            schedulerItem.targetDate = new Date(schedulerItem.targetDate);\n            schedulerItem.sourceCity = this.citySwitchManager.getCityByName(schedulerItem.sourceCity.name); //TODO: possible erorr\n            if (!this.canAddSchedulerItem(schedulerItem.actionDate)) {\n                console.warn('unsafe operation, failed to be scheudled during hydration');\n                this.hydrationError = `${schedulerItem.sourceCity.name} ${schedulerItem.operationType === OperationType.ARMY_ATTACK ? 'attack' : 'support'} operation  at '${schedulerItem.targetDate}' on city \"${schedulerItem.targetCitySelector}\" failed to be scheduled during hydration.`;\n                return;\n            }\n            schedulerItem.cancelSchedule = () => __awaiter(this, void 0, void 0, function* () { return yield this.cancelSchedule(schedulerItem); });\n            schedulerItem.postActionCleanup = () => __awaiter(this, void 0, void 0, function* () { return yield this.postActionCleanup(schedulerItem); });\n            this.addActionTimeouts(schedulerItem);\n            this.scheduler.push(schedulerItem);\n            this.addSchedulerItemToUI(schedulerItem);\n        }\n    }\n    set error(error) {\n        const errorElement = document.querySelector('#schedule-error');\n        if (error) {\n            if (errorElement) {\n                errorElement.textContent = error;\n            }\n        }\n        else {\n            if (errorElement) {\n                errorElement.textContent = '';\n            }\n        }\n        this._error = error;\n    }\n    set hydrationError(error) {\n        // TODO: add error display container\n        this._hydrationError = error;\n    }\n    set info(info) {\n        const infoElement = document.querySelector('#schedule-info');\n        if (info) {\n            if (infoElement) {\n                infoElement.textContent = info;\n                setTimeout(() => {\n                    infoElement.textContent = '';\n                }, 4000);\n            }\n        }\n        else {\n            if (infoElement) {\n                infoElement.textContent = '';\n            }\n        }\n        this._info = info;\n    }\n    /**\n     * Sprawdza czy można dodać operację do schedulera ze względu na czas do wykonania operacji oraz czas do najbliższej akcji w schedulerze.\n     * Jezeli odstęp czasowy pomiędzy tą operacją a teraz lub najbliższą zaplanowaną operacją jest mniejszy niż 10s zwraca fałsz.\n     */\n    canAddSchedulerItem(actionDate) {\n        // jeżeli czas do wykonbania operacji jest większy niż 10s, sprawdź czy czas do najbliższej akcji jest większy niż 10s\n        if (actionDate.getTime() - new Date().getTime() > 10 * 1000) {\n            // jeżeli scheduler jest pusty, można dodać operację\n            if (this.scheduler.length === 0) {\n                return true;\n            }\n            const hasNoInterlacingTimes = !this.scheduler.some((item) => {\n                if (Math.abs(item.actionDate.getTime() - actionDate.getTime()) < 10 * 1000) {\n                    console.log('Interlacing times:', item.actionDate, actionDate);\n                    console.log('\\t:', item.actionDate.getTime() - actionDate.getTime(), (item.actionDate.getTime() - actionDate.getTime()) / 1000);\n                    return true;\n                }\n                console.log('Not interlacing times:', item.actionDate, actionDate);\n                return false;\n            });\n            return hasNoInterlacingTimes;\n        }\n        // jeżeli czas do wykonbania operacji jest mniejszy niż 10s, nie podejmuj się operacji\n        else {\n            return false;\n        }\n    }\n    /**\n     * Sprawdza czy przywrócenie działania managerów nie koliduje z obecną kolejką schedulera, (minumum 60s do najbliższej akcji)\n     * jeżeli nie koliduje to przywraca działanie managerów.\n     */\n    tryRestoreManagers() {\n        if (this.scheduler.length === 0) {\n            console.log('RESTORE MANAGERS');\n            this.masterManager.resumeRunningManagers(['scheduler']);\n        }\n        else {\n            // znajdź najbliższą akcję w schedulerze\n            const now = new Date();\n            const nextClosestActionTime = this.scheduler.reduce((acc, item) => {\n                if (item.actionDate < now) {\n                    return acc;\n                }\n                if (acc && acc < item.actionDate) {\n                    return acc;\n                }\n                return item.actionDate;\n            }, null);\n            if (nextClosestActionTime) {\n                const timeDiff = nextClosestActionTime.getTime() - new Date().getTime();\n                // jeżeli czas do najbliższej akcji jest większy niż 60s to przywróć działanie managerów\n                if (timeDiff > 60 * 1000) {\n                    console.log('RESTORE MANAGERS');\n                    this.masterManager.resumeRunningManagers(['scheduler']);\n                }\n                else {\n                    console.log('DO NOT RESTORE MANAGERS');\n                }\n                return;\n            }\n            // jeżeli czas Data jest zaprzeszła, przywróć działanie managerów\n            this.masterManager.resumeRunningManagers(['scheduler']);\n        }\n    }\n    getDateFromDateTimeInputValues(inputDateValue, inputTimeValue) {\n        const timeRegex = /(\\d{2})\\D*(\\d{2})\\D*(\\d{2})/;\n        const match = inputTimeValue.match(timeRegex);\n        if (!match || !inputDateValue.match(/^\\d{4}-\\d{2}-\\d{2}$/)) {\n            throw new Error('Invalid time format');\n        }\n        const [, hours, minutes, seconds] = match;\n        const parsedTime = `${hours}:${minutes}:${seconds}`;\n        return new Date(`${inputDateValue}T${parsedTime}`);\n    }\n    getFormattedInputValueFromDate(date) {\n        const year = date.getFullYear();\n        const month = String(date.getMonth() + 1).padStart(2, '0'); // Miesiące są indeksowane od 0\n        const day = String(date.getDate()).padStart(2, '0');\n        return `${year}-${month}-${day}`;\n    }\n    mountAttackSupportSubpageObserver(parentNode) {\n        const observer = new MutationObserver((mutations) => {\n            for (const mutation of mutations) {\n                if (mutation.type === 'childList') {\n                    for (const node of mutation.addedNodes) {\n                        if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('attack_support_window')) {\n                            this.extendAttackSupportUI(node);\n                            return;\n                        }\n                    }\n                }\n            }\n        });\n        observer.observe(parentNode, { childList: true, subtree: true });\n        return () => observer.disconnect();\n    }\n    mountCityDialogObserver() {\n        return __awaiter(this, void 0, void 0, function* () {\n            let unobserveAttackSupportSubpages = null;\n            const observer = new MutationObserver((mutations) => {\n                for (const mutation of mutations) {\n                    if (mutation.type === 'childList') {\n                        for (const node of mutation.addedNodes) {\n                            if (node.nodeType === Node.ELEMENT_NODE &&\n                                node.getAttribute('class') === 'ui-dialog ui-corner-all ui-widget ui-widget-content ui-front ui-draggable ui-resizable js-window-main-container') {\n                                unobserveAttackSupportSubpages = this.mountAttackSupportSubpageObserver(node);\n                                return;\n                            }\n                        }\n                        for (const node of mutation.removedNodes) {\n                            if (node.nodeType === Node.ELEMENT_NODE &&\n                                node.getAttribute('role') === 'dialog' &&\n                                node.classList.contains('ui-dialog') &&\n                                node.classList.contains('js-window-main-container')) {\n                                if (unobserveAttackSupportSubpages) {\n                                    unobserveAttackSupportSubpages();\n                                    unobserveAttackSupportSubpages = null;\n                                    return;\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n            observer.observe(document.body, {\n                childList: true,\n            });\n        });\n    }\n    addSchedulerListConfigWindow() {\n        const style = document.createElement('style');\n        style.textContent = scheduler_list_css_1.default;\n        document.head.appendChild(style);\n        const schedulerListConfigWindow = document.createElement('div');\n        schedulerListConfigWindow.innerHTML = scheduler_list_prod_html_1.default;\n        document.body.appendChild(schedulerListConfigWindow);\n        this.addSchedulerListConfigListeners();\n    }\n    addSchedulerListConfigListeners() {\n        const toggleButton = document.querySelector('#scheduler-toggle-button');\n        const tableContainer = document.querySelector('#table-container');\n        toggleButton === null || toggleButton === void 0 ? void 0 : toggleButton.addEventListener('click', () => {\n            tableContainer === null || tableContainer === void 0 ? void 0 : tableContainer.classList.toggle('hidden');\n        });\n        const closeIcon = document.querySelector('.close-icon');\n        closeIcon === null || closeIcon === void 0 ? void 0 : closeIcon.addEventListener('click', () => {\n            tableContainer === null || tableContainer === void 0 ? void 0 : tableContainer.classList.add('hidden');\n        });\n    }\n    addSchedulerItemToUI(schedulerItem) {\n        const table = document.querySelector('#scheduler-lookup-table tbody');\n        const row = table.insertRow();\n        const id = this.getSchedulerItemId(schedulerItem);\n        row.setAttribute('data-scheduler-item-id', id);\n        const operaitonTypeCell = row.insertCell();\n        operaitonTypeCell.textContent = schedulerItem.operationType === OperationType.ARMY_ATTACK ? 'Attack' : 'Support';\n        operaitonTypeCell.classList.add(schedulerItem.operationType === OperationType.ARMY_ATTACK ? 'attack' : 'support');\n        row.insertCell().textContent = schedulerItem.sourceCity.name;\n        row.insertCell().textContent = schedulerItem.targetCityName;\n        row.insertCell().textContent = schedulerItem.actionDate.toLocaleTimeString();\n        row.insertCell().textContent = schedulerItem.targetDate.toLocaleTimeString();\n        const cancelButtonCell = row.insertCell();\n        const cancelButton = document.createElement('button');\n        cancelButton.classList.add('cancel-button');\n        cancelButton.textContent = 'Cancel';\n        cancelButton.addEventListener('click', () => {\n            schedulerItem.cancelSchedule();\n            this.removeSchedulerItemFromUI(schedulerItem);\n        });\n        cancelButtonCell.appendChild(cancelButton);\n        this.handleIfSchedulerListIsEmpty();\n    }\n    removeSchedulerItemFromUI(schedulerItem) {\n        console.log('removeSchedulerItemFromUI', schedulerItem);\n        const table = document.querySelector('#scheduler-lookup-table tbody');\n        const row = table.querySelector(`[data-scheduler-item-id=\"${this.getSchedulerItemId(schedulerItem)}\"]`);\n        console.log('row', row);\n        row.remove();\n        this.handleIfSchedulerListIsEmpty();\n    }\n    getSchedulerItemId(schedulerItem) {\n        return `${schedulerItem.operationType}_${schedulerItem.sourceCity.name}_${schedulerItem.targetCityName}_${schedulerItem.actionDate.getTime()}`;\n    }\n    handleIfSchedulerListIsEmpty() {\n        const noSchedules = document.querySelector('#no-schedules');\n        if (this.scheduler.length === 0) {\n            noSchedules.classList.remove('hidden');\n        }\n        else {\n            noSchedules.classList.add('hidden');\n        }\n    }\n    canSafelyRefresh() {\n        return this.scheduler.length === 0 || this.scheduler.every((item) => item.actionDate > new Date(new Date().getTime() + 120 * 1000));\n    }\n}\nScheduler.MIN_PRECEDENCE_TIME_MS = 10 * 1000;\nScheduler.TURN_OFF_MANAGERS_TIME_MS = 20 * 1000;\nScheduler.PREPARATION_TIME_MS = 10 * 1000;\nexports.default = Scheduler;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst gps_config_1 = __importDefault(require(\"../../gps.config\"));\nconst storage_manager_1 = __importDefault(require(\"./storage-manager\"));\nclass ConfigManager {\n    constructor() { }\n    static getInstance() {\n        if (!ConfigManager.instance) {\n            ConfigManager.instance = new ConfigManager();\n            ConfigManager.instance.storageManager = storage_manager_1.default.getInstance();\n            ConfigManager.instance.config = ConfigManager.instance.initConfig();\n        }\n        return ConfigManager.instance;\n    }\n    initConfig() {\n        const config = this.storageManager.readFromLocalStorage('config');\n        if (!config || !this.isConfigStructureEqual(config, gps_config_1.default, ['farmingCities'])) {\n            this.storageManager.writeToLocalStorage('config', gps_config_1.default);\n            return gps_config_1.default;\n        }\n        return config;\n    }\n    isConfigStructureEqual(config, gpsConfig, exceptKeys = []) {\n        return Object.keys(config).length === Object.keys(gpsConfig).length &&\n            Object.keys(config).every(key => {\n                if (!(key in gpsConfig)) {\n                    return false;\n                }\n                if (!exceptKeys.includes(key) && typeof config[key] === 'object' && config[key] !== null) {\n                    return this.isConfigStructureEqual(config[key], gpsConfig[key], exceptKeys);\n                }\n                return typeof config[key] === typeof gpsConfig[key];\n            });\n    }\n    getConfig() {\n        return this.config;\n    }\n    persistConfig() {\n        this.storageManager.writeToLocalStorage('config', this.config);\n    }\n    getConfigValue(key) {\n        return this.config[key];\n    }\n}\nexports.default = ConfigManager;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getRandomMs = exports.areGridsEqual = exports.msToTimeString = exports.formatDateToSimpleString = exports.getTimeInFuture = exports.addDelay = exports.isVisible = exports.textToMs = void 0;\nexports.getRandomInt = getRandomInt;\nexports.areArraysContentsEqual = areArraysContentsEqual;\nexports.shuffleArray = shuffleArray;\nexports.isMobile = isMobile;\nexports.calculateTimeToNextOccurrence = calculateTimeToNextOccurrence;\n/**\n * Takes string in format of xx:xx:xx - parses and returns number in miliseconds\n * @param text string in format 00:02:38\n * @returns miliseconds\n */\nconst textToMs = (text) => {\n    const timeArray = text.split(':').map(el => parseInt(el));\n    const timeout = (timeArray[0] * 1000 * 60 * 60) + (timeArray[1] * 1000 * 60) + (timeArray[2] * 1000);\n    return timeout;\n};\nexports.textToMs = textToMs;\nconst isVisible = (element) => {\n    return element.offsetParent;\n};\nexports.isVisible = isVisible;\nconst addDelay = (time = 1000) => {\n    return new Promise(resolve => setTimeout(resolve, time));\n};\nexports.addDelay = addDelay;\nconst getTimeInFuture = (timeMs) => {\n    const now = new Date();\n    const futureDate = new Date(now.getTime() + timeMs);\n    return `${futureDate.getHours().toString().padStart(2, '0')}:${futureDate.getMinutes().toString().padStart(2, '0')}:${futureDate.getSeconds().toString().padStart(2, '0')}`;\n};\nexports.getTimeInFuture = getTimeInFuture;\nconst formatDateToSimpleString = (date) => {\n    return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}:${date.getSeconds().toString().padStart(2, '0')}`;\n};\nexports.formatDateToSimpleString = formatDateToSimpleString;\nconst msToTimeString = (ms) => {\n    const hours = Math.floor(ms / (1000 * 60 * 60));\n    const minutes = Math.floor((ms % (1000 * 60 * 60)) / (1000 * 60));\n    const seconds = Math.floor((ms % (1000 * 60)) / 1000);\n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n};\nexports.msToTimeString = msToTimeString;\nfunction getRandomInt(max) {\n    return Math.floor(Math.random() * max);\n}\nconst areGridsEqual = (grid1, grid2) => {\n    return grid1[0] === grid2[0] && grid1[1] === grid2[1];\n};\nexports.areGridsEqual = areGridsEqual;\nfunction areArraysContentsEqual(arr1, arr2) {\n    if (arr1.length !== arr2.length)\n        return false;\n    for (let i = 0; i < arr1.length; i++) {\n        if (arr1[i] !== arr2[i])\n            return false;\n    }\n    return true;\n}\nfunction shuffleArray(array) {\n    for (let i = array.length - 1; i > 0; i--) {\n        const j = Math.floor(Math.random() * (i + 1));\n        [array[i], array[j]] = [array[j], array[i]];\n    }\n}\nfunction isMobile() {\n    if (navigator.userAgentData) {\n        return navigator.userAgentData.mobile;\n    }\n    else {\n        if (navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPad/i) || navigator.userAgent.match(/Android/i))\n            return true;\n        return false;\n    }\n}\nconst getRandomMs = (min, max) => {\n    return Math.floor(Math.random() * (max - min + 1) + min);\n};\nexports.getRandomMs = getRandomMs;\nfunction calculateTimeToNextOccurrence(timeString) {\n    console.log('timeString to calculate: ', timeString);\n    const [hours, minutes, seconds] = timeString.split(':').map(Number);\n    const now = new Date();\n    const targetTime = new Date(now);\n    targetTime.setHours(hours, minutes, seconds, 0);\n    // If the target time is earlier than or equal to the current time, assume it's for the next day\n    if (targetTime <= now) {\n        targetTime.setDate(targetTime.getDate() + 1);\n    }\n    return targetTime.getTime() - now.getTime();\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nclass StorageManager {\n    constructor() { }\n    static getInstance() {\n        if (!StorageManager.instance) {\n            StorageManager.instance = new StorageManager();\n        }\n        return StorageManager.instance;\n    }\n    readFromLocalStorage(key) {\n        const item = localStorage.getItem(key);\n        return item ? JSON.parse(item) : null;\n    }\n    writeToLocalStorage(key, value) {\n        localStorage.setItem(key, JSON.stringify(value));\n    }\n}\nexports.default = StorageManager;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst plain_utility_1 = require(\"./plain-utility\");\nclass Lock {\n    constructor() {\n        this.isLocked = false;\n        this.lockedBy = null;\n        this.lockedAt = null;\n        this.lockCheckInterval = null;\n        this.queue = [];\n    }\n    static getInstance() {\n        if (!this.instance) {\n            this.instance = new Lock();\n            this.instance.setLockCheckInterval();\n        }\n        return this.instance;\n    }\n    setLockCheckInterval() {\n        this.lockCheckInterval = setInterval(() => {\n            if (this.lockedAt && (Date.now() - this.lockedAt > 1000 * 60 * 5)) {\n                console.warn(`Lock: lock is taken for too long by \"${this.lockedBy}\", releasing...`);\n                // TODO: or consider restarting all managers\n                this.release();\n            }\n        }, 1000 * 60 * 5);\n    }\n    acquire(lockTaker) {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log(`Lock: try acquiring${lockTaker ? '\\n\\t-by: ' + lockTaker : ''}\\n\\t-at ${(0, plain_utility_1.formatDateToSimpleString)(new Date())}`);\n            if (!this.isLocked) {\n                console.log('\\t-lock is free, acquire Lock');\n                this.isLocked = true;\n                this.lockedBy = lockTaker !== null && lockTaker !== void 0 ? lockTaker : null;\n                this.lockedAt = Date.now();\n                return;\n            }\n            // console.log(`\\t-lock is locked, add${lockTaker ? ' \"' +lockTaker + '\"' : ''} to queue`, this.queue.length)\n            console.log(`\\t-lock is taken, add to queue, length before adding: ${this.queue.length}`);\n            yield new Promise((resolve) => {\n                this.queue.push(resolve);\n            });\n        });\n    }\n    release() {\n        console.log(`Lock: release lock${this.lockedBy ? `\\n\\t-by: \"${this.lockedBy}\"` : ''}\\n\\t-at ${(0, plain_utility_1.formatDateToSimpleString)(new Date())}`);\n        // Release the next waiting task in the queue\n        if (this.queue.length > 0) {\n            const nextResolve = this.queue.shift();\n            if (nextResolve) {\n                console.log('\\t-next element in the queue takes the lock');\n                nextResolve();\n            }\n        }\n        else {\n            this.lockedBy = null;\n            this.lockedAt = null;\n            this.isLocked = false;\n            console.log(`Lock: lock released at ${(0, plain_utility_1.formatDateToSimpleString)(new Date())}`);\n        }\n    }\n    isTaken() {\n        return this.isLocked;\n    }\n}\nLock.instance = null;\nexports.default = Lock;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.cancelHover = exports.triggerHover = void 0;\nexports.simulateClick = simulateClick;\nexports.setInputValue = setInputValue;\nexports.waitForElements = waitForElements;\nexports.waitForElement = waitForElement;\nexports.waitForElementInterval = waitForElementInterval;\nexports.waitForElementsInterval = waitForElementsInterval;\nexports.waitForElementFromNode = waitForElementFromNode;\nexports.onPageLoad = onPageLoad;\nexports.mouseDownEvent = mouseDownEvent;\nexports.performComplexClick = performComplexClick;\nexports.mouseUpEvent = mouseUpEvent;\nexports.triggerKeydown = triggerKeydown;\nexports.triggerPaste = triggerPaste;\nexports.performComplexInput = performComplexInput;\nconst plain_utility_1 = require(\"./plain-utility\");\nfunction simulateClick(element) {\n    if (element) {\n        const rect = element.getBoundingClientRect();\n        const event = new MouseEvent('click', {\n            clientX: rect.left + rect.width / 2,\n            clientY: rect.top + rect.height / 2,\n            bubbles: true,\n            cancelable: true,\n            view: window\n        });\n        element.dispatchEvent(event);\n    }\n}\nconst triggerHover = (element) => {\n    element && element.dispatchEvent(new Event('mouseover', {\n        bubbles: true,\n        cancelable: true,\n    }));\n};\nexports.triggerHover = triggerHover;\nconst cancelHover = (element) => {\n    element && element.dispatchEvent(new Event('mouseout', {\n        bubbles: true,\n        cancelable: true,\n    }));\n};\nexports.cancelHover = cancelHover;\nfunction appendChildAtIndex(parent, newChild, index) {\n    const children = parent.children;\n    if (index >= children.length) {\n        parent.appendChild(newChild);\n    }\n    else {\n        parent.insertBefore(newChild, children[index]);\n    }\n}\n// Funkcja do ustawienia wartości i wywołania zdarzeń\nfunction setInputValue(inputElement, value) {\n    // Sprawdzenie, czy element jest rzeczywiście <input>\n    if (inputElement && inputElement.tagName === 'INPUT') {\n        // Ustawienie wartości inputu\n        inputElement.value = typeof value === \"number\" ? value.toString() : value;\n        // Tworzenie zdarzenia input\n        const inputEvent = new Event('input', { bubbles: true });\n        inputElement.dispatchEvent(inputEvent);\n        // Tworzenie zdarzenia change\n        const changeEvent = new Event('change', { bubbles: true });\n        inputElement.dispatchEvent(changeEvent);\n    }\n    else {\n        console.warn(`setInputValue(${inputElement.name}) unsuccessful`);\n    }\n}\nfunction waitForElements(selector, timeoutMs = 8000) {\n    return new Promise((resolve, reject) => {\n        // Funkcja do aktualizacji wyników\n        const elements = document.querySelectorAll(selector);\n        if (elements.length > 0) {\n            resolve(elements);\n        }\n        else {\n            // Ustawienie observera do monitorowania DOM\n            let timeout = setTimeout(() => {\n                observer.disconnect();\n                reject(`waitForElements(${selector}) - not found within timeout`);\n            }, timeoutMs);\n            const observer = new MutationObserver((mutations) => {\n                for (const mutation of mutations) {\n                    if (mutation.type === 'childList') {\n                        const elements = document.querySelectorAll(selector);\n                        if (elements.length > 0) {\n                            observer.disconnect();\n                            clearTimeout(timeout);\n                            resolve(elements);\n                        }\n                    }\n                }\n            });\n            observer.observe(document.body, { childList: true, subtree: true });\n        }\n    });\n}\nfunction waitForElement(selector, timeout = 8000) {\n    return new Promise((resolve, reject) => {\n        const element = document.querySelector(selector);\n        if (element) {\n            return resolve(element);\n        }\n        else {\n            const timeoutId = setTimeout(() => {\n                observer.disconnect();\n                reject(`${selector} - not found within timeout`);\n            }, timeout);\n            const observer = new MutationObserver((mutations) => {\n                for (const mutation of mutations) {\n                    if (mutation.type === 'childList') {\n                        for (const node of mutation.addedNodes) {\n                            if (node.nodeType === Node.ELEMENT_NODE && node.matches(selector)) {\n                                observer.disconnect();\n                                clearTimeout(timeout);\n                                resolve(node);\n                            }\n                        }\n                    }\n                }\n            });\n            // Rozpoczęcie obserwacji\n            observer.observe(document.body, { childList: true, subtree: true });\n        }\n    });\n}\nconst WaitForElementOptionsDefaults = {\n    timeout: 8000,\n    fromNode: document,\n    interval: 333,\n    retries: undefined,\n};\nfunction waitForElementInterval(selector, options = WaitForElementOptionsDefaults) {\n    const { timeout = 8000, fromNode = document, interval = 333, retries } = options;\n    return new Promise((resolve, reject) => {\n        const element = fromNode.querySelector(selector);\n        if (element) {\n            resolve(element);\n        }\n        else {\n            const timeoutId = retries ? setTimeout(() => {\n                clearInterval(observer);\n                reject(`${selector} - not found within timeout`);\n            }, timeout)\n                : undefined;\n            let retryCount = 0;\n            const observer = setInterval(() => {\n                retryCount++;\n                const element = fromNode.querySelector(selector);\n                if (element) {\n                    clearInterval(observer);\n                    clearTimeout(timeoutId);\n                    resolve(element);\n                }\n                else if (retries && retryCount >= retries) {\n                    clearInterval(observer);\n                    reject(`${selector} - not found within timeout`);\n                }\n            }, interval);\n        }\n    });\n}\nfunction waitForElementsInterval(selector, options = WaitForElementOptionsDefaults) {\n    const { timeout = 8000, fromNode = document, interval = 333, retries } = options;\n    return new Promise((resolve, reject) => {\n        const elements = fromNode.querySelectorAll(selector);\n        if (elements.length > 0) {\n            resolve(elements);\n        }\n        else {\n            const timeoutId = retries ? setTimeout(() => {\n                clearInterval(observer);\n                reject(`${selector} - not found within timeout`);\n            }, timeout)\n                : undefined;\n            let retryCount = 0;\n            const observer = setInterval(() => {\n                retryCount++;\n                const elements = fromNode.querySelectorAll(selector);\n                if (elements.length > 0) {\n                    clearInterval(observer);\n                    clearTimeout(timeoutId);\n                    resolve(elements);\n                }\n                else if (retries && retryCount >= retries) {\n                    clearInterval(observer);\n                    reject(`${selector} - not found within timeout`);\n                }\n            }, interval);\n        }\n    });\n}\nfunction waitForElementFromNode(parentNode, selector, timeout = 8000) {\n    return new Promise((resolve, reject) => {\n        const element = parentNode.querySelector(selector);\n        // Jeśli element już istnieje to zostaje zwrócony odrazu\n        if (element) {\n            // console.log(`${selector} - FOUND, resolve:`, element);\n            return resolve(element);\n        }\n        else {\n            // console.log(`${selector} - not found, mount observer`);\n            // Inicjalizacja timeoutu\n            const timeoutId = setTimeout(() => {\n                observer.disconnect();\n                reject(`${selector} - not found within timeout`);\n            }, timeout);\n            // Inicjalizacja MutationObserver\n            const observer = new MutationObserver((mutations) => {\n                for (const mutation of mutations) {\n                    if (mutation.type === 'childList') {\n                        for (const node of mutation.addedNodes) {\n                            if (node.nodeType === Node.ELEMENT_NODE && node.matches(selector)) {\n                                observer.disconnect();\n                                clearTimeout(timeoutId);\n                                resolve(node);\n                            }\n                        }\n                    }\n                }\n            });\n            // Rozpoczęcie obserwacji\n            observer.observe(parentNode instanceof Document ? parentNode.body : parentNode, { childList: true, subtree: true });\n        }\n    });\n}\n/** Function that waits for DOM to load then applies main loop. */\nfunction onPageLoad(callback) {\n    const initWrapper = () => {\n        // const lodadingContainer = document.querySelector('#screen-loading');\n        const timeout = setTimeout(() => {\n            clearTimeout(timeout);\n            setTimeout(callback, 2000);\n        }, 500);\n    };\n    if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', initWrapper);\n    }\n    else {\n        initWrapper();\n    }\n}\nfunction simulateKeyPress(key) {\n    // Tworzenie zdarzenia keydown\n    const keydownEvent = new KeyboardEvent('keydown', {\n        key: key,\n        code: `Key${key.toUpperCase()}`, // Zakładając, że używasz klawisza alfanumerycznego\n        keyCode: key.charCodeAt(0), // Kod klawisza w starszych przeglądarkach\n        which: key.charCodeAt(0),\n        bubbles: true,\n        cancelable: true\n    });\n    // Tworzenie zdarzenia keyup\n    const keyupEvent = new KeyboardEvent('keyup', {\n        key: key,\n        code: `Key${key.toUpperCase()}`,\n        keyCode: key.charCodeAt(0),\n        which: key.charCodeAt(0),\n        bubbles: true,\n        cancelable: true\n    });\n    // Wywoływanie zdarzeń na całym dokumencie\n    document.dispatchEvent(keydownEvent);\n    setTimeout(() => {\n        document.dispatchEvent(keyupEvent);\n    }, 100); // Czas trwania wciśnięcia klawisza, w milisekundach\n}\nfunction mouseDownEvent(element) {\n    const mouseDownEvent = new MouseEvent('mousedown', {\n        bubbles: true,\n        cancelable: true,\n        view: window\n    });\n    if (element) {\n        element.dispatchEvent(mouseDownEvent);\n    }\n}\nfunction performComplexClick(element) {\n    return __awaiter(this, void 0, void 0, function* () {\n        mouseDownEvent(element);\n        yield (0, plain_utility_1.addDelay)(50);\n        mouseUpEvent(element);\n    });\n}\nfunction mouseUpEvent(element) {\n    const mouseUpEvent = new MouseEvent('mouseup', {\n        bubbles: true,\n        cancelable: true,\n        view: window\n    });\n    if (element) {\n        element.dispatchEvent(mouseUpEvent);\n    }\n    else {\n        console.warn(`mouseUpEvent() - ${element} not found`);\n    }\n}\nfunction triggerKeydown(element, key) {\n    const event = new KeyboardEvent('keydown', {\n        key: key,\n        bubbles: true,\n        cancelable: true\n    });\n    element.dispatchEvent(event);\n}\nfunction triggerPaste(element, pasteData) {\n    const event = new ClipboardEvent('paste', {\n        bubbles: true,\n        cancelable: true,\n        clipboardData: new DataTransfer()\n    });\n    if (event.clipboardData) {\n        event.clipboardData.setData('text/plain', pasteData);\n        element.dispatchEvent(event);\n    }\n    else {\n        console.warn('triggerPaste() - clipboardData is null');\n    }\n}\nfunction performComplexInput(inputElement, value) {\n    // Focus event\n    inputElement.focus();\n    const focusEvent = new Event('focus', { bubbles: true, cancelable: true });\n    inputElement.dispatchEvent(focusEvent);\n    // Simulate typing each character\n    for (let char of value) {\n        // Keydown event\n        const keydownEvent = new KeyboardEvent('keydown', {\n            key: char,\n            bubbles: true,\n            cancelable: true\n        });\n        inputElement.dispatchEvent(keydownEvent);\n        // Keypress event\n        const keypressEvent = new KeyboardEvent('keypress', {\n            key: char,\n            bubbles: true,\n            cancelable: true\n        });\n        inputElement.dispatchEvent(keypressEvent);\n        // Input event\n        inputElement.value += char; // Update the input's value\n        const inputEvent = new Event('input', { bubbles: true, cancelable: true });\n        inputElement.dispatchEvent(inputEvent);\n        // Keyup event\n        const keyupEvent = new KeyboardEvent('keyup', {\n            key: char,\n            bubbles: true,\n            cancelable: true\n        });\n        inputElement.dispatchEvent(keyupEvent);\n    }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(927);\n"],"names":["ReflectOwnKeys","R","Reflect","ReflectApply","apply","target","receiver","args","Function","prototype","call","ownKeys","Object","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","Number","isNaN","value","EventEmitter","init","this","module","exports","once","emitter","name","Promise","resolve","reject","errorListener","err","removeListener","resolver","slice","arguments","eventTargetAgnosticAddListener","handler","on","addErrorHandlerIfEventEmitter","_events","undefined","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","TypeError","_getMaxListeners","that","_addListener","type","prepend","m","events","existing","warning","create","newListener","emit","unshift","push","length","warned","w","Error","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","bind","_listeners","unwrap","evlistener","arr","ret","Array","i","unwrapListeners","arrayClone","listenerCount","n","copy","flags","addEventListener","wrapListener","arg","removeEventListener","defineProperty","enumerable","get","set","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","pop","spliceOne","off","removeAllListeners","key","keys","rawListeners","eventNames","FarmTimeInterval","config","resources","minPopulationBuffer","storeAlmostFullPercentage","farmConfig","farmInterval","FirstOption","humanize","farmingCities","general","timeDifferenceBackwards","antyTimingMs","applicationRefreshInterval","forcedRefresh","switch","farm","builder","guard","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","next","e","rejected","result","done","then","__importDefault","mod","__esModule","config_popup_css_1","config_popup_html_1","events_1","config_manager_1","gps_config_1","city_switch_manager_1","ConfigPopup","default","constructor","super","uniquelySelectedFarmingCitiesPerIsle","isSwitchChecked","isFarmChecked","isBuilderChecked","isGuardChecked","getPlunderConfig","getManagersFlags","configManager","getInstance","getConfig","initEventListeners","_a","container","document","querySelector","switchCheckbox","plunderCheckbox","builderCheckbox","guardCheckbox","timeIntervalSelect","showTrigger","closeTrigger","humanizeCheckbox","classList","contains","add","querySelectorAll","forEach","btn","checked","conflictingCitiesChanged","some","isleId","find","city","log","values","persistConfig","FourthOption","alert","remove","farmSection","parentElement","farmSectionContainer","farmSectionArrow","toggle","createInitialElements","createElement","innerHTML","intervalSelectElement","farmIntervalValuesUnparsed","option","toString","textContent","mapTimeIntervalKeyToText","appendChild","createConfictingCitiesSelects","listOfCities","getCityList","arrayOfArraysOfCitiesOnTheSameIsland","from","Set","map","filter","areAnyConflicts","array","conflictingCitiesContainer","conflictingCitiesArrow","conflictingCitiesContent","arrayOfCities","initialCity","isleContainer","className","isleHeader","isleCitiesSelect","id","selectedCity","reduce","acc","SecondOption","ThirdOption","addStyle","style","head","render","configWindowElement","body","minimize","master_manager_1","onPageLoad","currentUrl","window","location","href","test","includes","setInterval","GM_setValue","GM_getValue","click","ArmyMovement","callback","instance","mountObserver","observer","MutationObserver","mutations","mutation","node","addedNodes","HTMLElement","getAttribute","element","observe","childList","subtree","setCallback","buildings","buildingsSelectors","ui_utility_1","buildActionSafe","selector","cityViewBtn","buildModeButton","waitForElement","buildButton","currentLvl","disabled","main","backgroundImageProp","elementSelector","currentLvlElSelector","buildAction","hide","lumber","stoner","ironer","market","docks","barracks","wall","storage","academy","temple","plain_utility_1","ui_lock_1","queue_css_1","builder_prod_html_1","buildings_1","resource_manager_1","general_info_1","CityBuilder","allowUnsequentialBuilds","allowCriticalBuilds","RUN","mainQueue","lock","resourceManager","citySwitchManager","generalInfo","renderUI","loadQueueFromStorage","listenToCitySwitch","addBuildButtons","initToggleButtonEvents","getElementById","toggleBuilderButtonId","buildContainer","buildContainerId","tryExitBuildMode","tryGoToBuildMode","currentCityQueue","queue","rerenderQueue","buildOptions","buildOptionsContainerId","building","button","buildOptionItemClass","backgroundImage","addIcon","buildOptionItemAddClass","onOptionBuildButtonClick","switchAction","currentCity","getCurrentCity","queueObj","schedule","addToQueue","addBuldingToUIQueue","queueItem","cityQueue","additionalQueue","queueItemEl","queueItemClass","setAttribute","appendChildAtIndex","upButton","upButtonClass","toLvl","cancelButton","cancelButtonClass","findIndex","item","clearInterval","clearTimeout","revalidateQueueItemLevels","handleBuildSchedule","splice","saveQueueToStorage","fromIndex","newToLvl","newId","catch","buildingcurrentLvlText","el","Infinity","lvlCounter","JSON","parse","stringify","buildOrSchedule","performBuildSchedule","isEmptySlot","checkIfItemCanBeBuiltAndAddDeleteOrSchedule","setTimeoutForNextSpeedUpAndSchedule","isQueueEmpty","timeToSpeedUp","getTimeToCanSpeedUp","emptySlots","getEmptySlotsCount","speedUpFirstBuild","untilEmptyslotsAreEqual","getTimeInFuture","setTimeout","acquire","release","cityQueue_1","item_1","forced","canBuild","shiftQueueCleanScheduleAndTryNext","clearUIQueueItem","resourcesInfo","areResourcesStackable","areStackable","hasEnoughResources","requiredResources","BUILD_RETRY_INTERVAL","buildingLvl","getBuildingCurrentLvl","res","interval","goToCityView","showInfo","hideInfo","freeButton","counter","triggerHover","addDelay","wood","stone","iron","requiredWood","nextSibling","requiredStone","requiredIron","requiredPopulation","cancelHover","getResourcesInfo","getPopulation","getStoreCapacity","population","curr","storeMaxSize","amount","firstOrder","textToMs","cityInfo","storageQueue","localStorage","getItem","getCityByName","queueItems","assign","setItem","start","stop","isRunning","insertBefore","children","queueContainerId","CitySwitchManager","cityList","initCityList","_b","_c","_d","_e","townListElement","townList","town","cityId","openTownList","waitForElements","cls","match","goBackToFirstTown","clickArrowUntilCityFound","cityName","cityWrapper","arrowLeft","arrowRight","run","FarmingSolution","FarmManager","schedulerArray","captainScheduler","messageDialogObserver","humanMessageDialogObserver","farmSolution","Manual","scheduleNextFarmingOperationForCity","timeInterval","scheduleItem","scheduledDate","Date","now","timeout","farmVillages","mountMessageDialogsObservers","disconnect","citySwitch","setFarmSolution","captainPresent","Captain","farmWithCaptain","scheduled","_f","_g","_h","_j","_k","getRandomMs","cooldownWrapper","waitForElementInterval","retries","cooldownText","cooldownTimeTextParsed","calculateTimeToNextOccurrence","scheduleTimeout","formatDateToSimpleString","allCityLabels","cityLabel","checbkox","farmOptions","farmOptionIndex","getFarmOptionIndex","newCooldownText","trim","newCooldownTextParsed","disconnectObservers","initFarmAllVillages","farmVillagesFlow","city_1","villages","waitForElementsInterval","villageStyleSelectors","v","villagesAmount","villageSelector","entries","performComplexClick","els","getUnlockTimeOrNull","forceRepeatFarming","c","cooldownBar","waitForElementFromNode","unlcokTimeEl","rej","getTextInterval","getFarmOptionTimeRegex","getFarmOption","config_popup_1","city_builder_1","farm_manager_1","Scheduler_1","MasterManager","pausedManagersSnapshot","farmManager","switchManager","scheduler","initCaptchaPrevention","initRefreshUtility","initConfigDialog","canRefresh","canSafelyRefresh","reload","Math","floor","random","recaptchaWindow","captchaCurtain","checkbox","caption","runManagersFromConfig","configMenuWindow","pauseRunningManagers","except","resumeRunningManagers","isPaused","forceRefresh","stopAll","general_info_css_1","info_template_html_1","GeneralInfo","initInfoContainer","infoContainer","title","text","ResourceManager","maxSizeText","parseInt","resourceItem","maxSizeElement","isAlmostFull","isFull","isLow","army_movement_1","button_panel_extension_html_1","scheduler_list_prod_html_1","scheduler_list_css_1","OperationType","Scheduler","isLockTakenByScheduler","_error","_hydrationError","_info","privateconstructor","armyMovement","masterManager","addUIExtenstion","addSchedulerListConfigWindow","synchronizeSchedulerWithStorage","mountCityDialogObserver","undoArmyMovement","fromTown","hoverElement","extendAttackSupportUI","buttonWrapper","div","inputDateElement","getFormattedInputValueFromDate","wayDurationText","wayDurationMs","inputData","inputEl","operationType","firstElementChild","ARMY_ATTACK","ARMY_SUPPORT","attackTypeSelector","dataset","inputDateValue","inputTimeValue","targetDate","getDateFromDateTimeInputValues","actionDate","getTime","sourceCity","targetCitySelector","canAddSchedulerItem","data","targetCityName","setInputValue","blur","schedulerItem","timeoutStructure","timeoutPreparation","timeoutPreAction","timeoutAction","movementId","undoMovementAction","cancelSchedule","postActionCleanup","addActionTimeouts","addSchedulerItemToUI","info","removeSchedulerItemFromUI","removeSavedCoords","tryRestoreManagers","readCords","gridXInput","gridYInput","preparationTime","TURN_OFF_MANAGERS_TIME_MS","tenSecondsBeforeAction","dropdownList","dropdownItem","input","goToCoords","coords","hydrateSchedulerItem","handleIfSchedulerListIsEmpty","hydrationError","errorElement","infoElement","abs","nextClosestActionTime","hours","minutes","seconds","date","getFullYear","getMonth","padStart","getDate","mountAttackSupportSubpageObserver","parentNode","nodeType","Node","ELEMENT_NODE","unobserveAttackSupportSubpages","removedNodes","schedulerListConfigWindow","addSchedulerListConfigListeners","toggleButton","tableContainer","closeIcon","row","insertRow","getSchedulerItemId","operaitonTypeCell","insertCell","toLocaleTimeString","cancelButtonCell","noSchedules","every","MIN_PRECEDENCE_TIME_MS","PREPARATION_TIME_MS","storage_manager_1","ConfigManager","storageManager","initConfig","readFromLocalStorage","isConfigStructureEqual","writeToLocalStorage","gpsConfig","exceptKeys","getConfigValue","areGridsEqual","msToTimeString","isVisible","getRandomInt","max","areArraysContentsEqual","arr1","arr2","shuffleArray","j","isMobile","navigator","userAgentData","mobile","userAgent","timeString","split","targetTime","setHours","setDate","timeArray","offsetParent","time","timeMs","futureDate","getHours","getMinutes","getSeconds","ms","grid1","grid2","min","StorageManager","Lock","isLocked","lockedBy","lockedAt","lockCheckInterval","setLockCheckInterval","lockTaker","nextResolve","isTaken","simulateClick","rect","getBoundingClientRect","event","MouseEvent","clientX","left","width","clientY","top","height","bubbles","cancelable","view","dispatchEvent","inputElement","tagName","inputEvent","Event","changeEvent","timeoutMs","elements","matches","options","WaitForElementOptionsDefaults","fromNode","timeoutId","retryCount","Document","initWrapper","readyState","mouseDownEvent","mouseUpEvent","triggerKeydown","KeyboardEvent","triggerPaste","pasteData","ClipboardEvent","clipboardData","DataTransfer","setData","performComplexInput","focus","focusEvent","char","keydownEvent","keypressEvent","keyupEvent","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","o","obj","prop","hasOwnProperty","r","Symbol","toStringTag"],"sourceRoot":""}